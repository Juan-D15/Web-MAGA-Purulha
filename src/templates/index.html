{% extends 'base.html' %}
{% load static %}
{% block title %}Gestión de Eventos — Purulhá{% endblock %}
{% block extra_css %}
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet"href="{% static 'css/styles.css' %}?v=13">
  <link rel="stylesheet" href="{% static 'css/login-modal.css' %}">
  <link rel="stylesheet" href="{% static 'css/gestioneseventos.css' %}?v=74">
  <style>
    /* Tooltip de regiones (copiado de mapa-completo) */
    .region-tooltip { position: absolute; background: linear-gradient(135deg, #0772d2, #0a5f9f); color: #fff; padding: 8px 16px; border-radius: 8px; font-size: 14px; font-weight: 700; box-shadow: 0 8px 24px rgba(7,114,210,.4); border: 1px solid rgba(255,255,255,.2); backdrop-filter: blur(12px); pointer-events: none; z-index: 1000; opacity: 0; transform: translateY(8px) scale(.95); transition: all .3s cubic-bezier(.4,0,.2,1); white-space: nowrap; }
    .region-tooltip.visible { opacity: 1; transform: translateY(0) scale(1); }
    .region-tooltip::after { content: ''; position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left:6px solid transparent; border-right:6px solid transparent; border-top:6px solid #0772d2; }

    /* ===== Calendario ===== */
    .calendar-section{padding:40px 0;border-top:1px solid var(--border, #ffffff1f);background: radial-gradient(900px 400px at 90% 10%, #ffffff0a 0%, transparent 60%)}
    .calendar__inner{max-width:1320px;margin:0 auto;padding:0 22px}
    .calendar__header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:18px}
    .calendar__title h2{margin:0;font-weight:800;color:#eef5ff;letter-spacing:.02em}
    .calendar__subtitle{margin:4px 0 0 0;color:#a8b2c2;font-weight:600;letter-spacing:.04em}
    .calendar__nav{display:flex;align-items:center;gap:10px}
    .calendar__current{min-width:180px;text-align:center;font-weight:800;color:#eef5ff;background:linear-gradient(180deg,#2b3748 0%,#243043 100%);border:1px solid #ffffff1f;padding:8px 14px;border-radius:12px}
    .cal-btn{width:40px;height:40px;border-radius:10px;border:1px solid #ffffff1f;background:transparent;color:#dfe9f7;cursor:pointer;display:grid;place-items:center;transition:all .18s ease}
    .cal-btn:hover{background:#ffffff12}
    .cal-add-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;background:linear-gradient(135deg,#12b76a,#079455);border:1px solid #ffffff1f;color:#fff;font-weight:800;cursor:pointer}

    .calendar{border:1px solid #ffffff1f;border-radius:16px;background:linear-gradient(180deg,#2f3a4c 0%,#2a3343 100%);box-shadow:0 10px 30px rgba(0,0,0,.35);overflow:hidden}
    .calendar__weekdays{display:grid;grid-template-columns:repeat(7,1fr);border-bottom:1px solid #ffffff1a;background:linear-gradient(180deg,#2b3748 0%,#243043 100%)}
    .calendar__weekdays div{padding:12px 10px;text-align:center;font-weight:800;color:#dfe9f7;letter-spacing:.06em;text-transform:uppercase}
    .calendar__grid{display:grid;grid-template-columns:repeat(7,1fr);gap:0}
    .cal-cell{position:relative;min-height:110px;border-right:1px solid #ffffff12;border-bottom:1px solid #ffffff12;padding:10px;cursor:pointer;background:transparent;transition:background .15s ease}
    .cal-cell:hover{background:#ffffff0d}
    .cal-cell.is-today{outline:2px solid #0772d2;outline-offset:-2px}
    .cal-cell__date{font-weight:800;color:#eef5ff}
    .cal-cell__events{margin-top:6px;display:flex;flex-direction:column;gap:6px;max-height:70px;overflow:auto}
    .cal-pill{display:inline-flex;align-items:center;gap:6px;max-width:100%;padding:6px 8px;border-radius:8px;background:#1d2531;border:1px solid #ffffff1f;color:#dfe9f7;font-size:12px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .cal-pill__text{display:inline-block}
    .cal-pill__short{display:none}
    .cal-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0} .cal-dot--event{background:#12b76a} .cal-dot--update{background:#ffc107} .cal-dot--finish{background:#ff5d5d}
    .cal-dot--reminder{background:#9b59b6} .cal-dot--reminder-past{background:#6c757d}
    .cal-dot--avance{background:#ffc107}
    .cal-pill--event{border-left:3px solid #12b76a}
    .cal-pill--reminder-item{border-left:3px solid #9b59b6}
    .cal-pill--avance{border-left:3px solid #ffc107}
    .cal-pill--mine{background:linear-gradient(135deg,#0a5f9f,#0772d2);border-color:#2aa0ff;color:#fff}
    .cal-pill--reminder-past{opacity:0.7}

    /* Modal día */
    .cal-modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;z-index:120}
    .cal-modal.open{display:block}
    .cal-modal__panel{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:min(92vw,860px);max-height:85vh;overflow-y:auto;overflow-x:hidden;border:1px solid #ffffff1f;border-radius:16px;background:linear-gradient(180deg,#2f3a4c 0%,#2a3343 100%);box-shadow:0 10px 30px rgba(0,0,0,.35);box-sizing:border-box}
    .cal-modal__body{max-height:calc(85vh - 120px);overflow-y:auto;overflow-x:hidden!important;padding:16px;margin:0!important;box-sizing:border-box!important;width:100%!important;max-width:100%!important}
    .cal-modal__header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #ffffff1a;background:linear-gradient(180deg,#2b3748 0%,#243043 100%);box-sizing:border-box}
    .cal-modal__title{margin:0;font-weight:800;color:#eef5ff}
    .cal-modal__close{width:40px;height:40px;border-radius:10px;border:1px solid #ffffff1f;background:transparent;color:#fff;cursor:pointer}
    /* Sobrescribir estilos de event-card del carrusel para el modal */
    .cal-modal__body .event-card,
    .cal-modal .event-card{
      position:relative!important;
      width:100%!important;
      max-width:100%!important;
      height:auto!important;
      opacity:1!important;
      transform:none!important;
      z-index:auto!important;
      display:block!important;
      margin:0 0 12px 0!important;
      margin-left:0!important;
      margin-right:0!important;
      padding:14px!important;
      border:1px solid #ffffff1f!important;
      border-radius:12px!important;
      background:#1d2531!important;
      box-sizing:border-box!important;
      overflow-wrap:break-word!important;
      word-wrap:break-word!important;
      word-break:break-word!important;
      left:auto!important;
      right:auto!important;
      top:auto!important;
      bottom:auto!important;
      overflow:visible!important;
      visibility:visible!important;
    }
    /* Estilos específicos para recordatorios - asegurar visibilidad básica */
    .cal-modal__body .event-card[data-reminder-id]{
      overflow:visible!important;
      visibility:visible!important;
    }
    .cal-modal__body .event-card[data-reminder-id] .reminder-card-content{
      position:relative!important;
      z-index:1!important;
    }
    .cal-modal__body .event-card[data-reminder-id] .reminder-card-info{
      position:relative!important;
      z-index:2!important;
    }
    .cal-modal__body .event-card[data-reminder-id] .reminder-delete-btn,
    .cal-modal__body .event-card[data-reminder-id] .btn-danger{
      position:relative!important;
      z-index:3!important;
    }
    .event-card__title{margin:0 0 6px 0;font-weight:800;color:#eef5ff;word-wrap:break-word;overflow-wrap:break-word}
    .event-card__meta{font-size:12px;color:#a8b2c2;margin-bottom:8px;word-wrap:break-word;overflow-wrap:break-word}
    .event-card__desc{font-size:13px;color:#dfe9f7;word-wrap:break-word;overflow-wrap:break-word;white-space:pre-wrap}
    .modal-section{position:relative;width:100%!important;max-width:100%!important;margin:0!important;padding:0!important;box-sizing:border-box!important}
    
    /* Estilos específicos para recordatorios en desktop */
    @media (min-width:769px){
      /* Asegurar que las tarjetas de recordatorio se muestren correctamente */
      .cal-modal__body .event-card[data-reminder-id]{
        display:block!important;
        visibility:visible!important;
        opacity:1!important;
      }
      /* Contenedor del contenido interno - layout horizontal */
      .cal-modal__body .event-card[data-reminder-id] .reminder-card-content{
        display:flex!important;
        flex-direction:row!important;
        align-items:flex-start!important;
        justify-content:space-between!important;
        gap:12px!important;
        width:100%!important;
        box-sizing:border-box!important;
      }
      /* Información del recordatorio (izquierda) - debe ocupar el espacio disponible */
      .cal-modal__body .event-card[data-reminder-id] .reminder-card-info{
        flex:1 1 auto!important;
        min-width:0!important;
        max-width:calc(100% - 120px)!important;
        display:flex!important;
        flex-direction:column!important;
        gap:6px!important;
        overflow:visible!important;
        visibility:visible!important;
      }
      /* Meta información (hora, evento, badge) - en línea horizontal */
      .cal-modal__body .event-card[data-reminder-id] .reminder-meta,
      .cal-modal__body .event-card[data-reminder-id] .event-card__meta.reminder-meta{
        display:flex!important;
        flex-direction:row!important;
        align-items:center!important;
        flex-wrap:wrap!important;
        gap:8px!important;
        margin-bottom:0!important;
        line-height:1.4!important;
        white-space:normal!important;
        width:100%!important;
        visibility:visible!important;
        opacity:1!important;
      }
      /* Spans dentro de meta información */
      .cal-modal__body .event-card[data-reminder-id] .reminder-meta > span,
      .cal-modal__body .event-card[data-reminder-id] .event-card__meta.reminder-meta > span{
        display:inline-block!important;
        white-space:nowrap!important;
        word-break:normal!important;
        line-height:1.4!important;
        visibility:visible!important;
        opacity:1!important;
      }
      /* Badge de "Pasado" */
      .cal-modal__body .event-card[data-reminder-id] .past-badge{
        display:inline-block!important;
        white-space:nowrap!important;
        vertical-align:middle!important;
        visibility:visible!important;
        opacity:1!important;
      }
      /* Descripción del recordatorio - debe ser visible */
      .cal-modal__body .event-card[data-reminder-id] .event-card__desc{
        display:block!important;
        visibility:visible!important;
        opacity:1!important;
        margin-top:0!important;
        line-height:1.5!important;
        white-space:normal!important;
        word-break:break-word!important;
        overflow-wrap:break-word!important;
        width:100%!important;
      }
      /* Información de involucrados y creador - debe ser visible */
      .cal-modal__body .event-card[data-reminder-id] .event-card__meta:not(.reminder-meta){
        display:block!important;
        visibility:visible!important;
        opacity:1!important;
        margin-top:0!important;
        line-height:1.4!important;
        white-space:normal!important;
        word-break:break-word!important;
        width:100%!important;
      }
      /* Botón de eliminar - a la derecha, no debe ocupar todo el espacio */
      .cal-modal__body .event-card[data-reminder-id] .reminder-delete-btn,
      .cal-modal__body .event-card[data-reminder-id] .btn-danger{
        flex-shrink:0!important;
        flex-grow:0!important;
        align-self:flex-start!important;
        margin-top:0!important;
        white-space:nowrap!important;
        padding:8px 14px!important;
        font-size:0.875rem!important;
        min-width:auto!important;
        max-width:110px!important;
        height:auto!important;
        visibility:visible!important;
        opacity:1!important;
      }
    }
    
    /* Responsive para modal del día */
    @media (max-width:768px){
      .cal-modal__panel{width:100vw!important;max-width:100vw!important;height:100vh!important;max-height:100vh!important;border-radius:0!important;top:0!important;left:0!important;transform:none!important;right:0!important;bottom:0!important}
      .cal-modal__body{padding:4px!important;max-height:calc(100vh - 70px)!important;width:100%!important;max-width:100%!important;margin:0!important;box-sizing:border-box!important}
      .cal-modal__header{padding:10px 8px!important;width:100%!important;box-sizing:border-box!important}
      .cal-modal__body .event-card,
      .cal-modal .event-card{
        padding:10px!important;
        margin-bottom:8px!important;
        margin-left:0!important;
        margin-right:0!important;
        width:100%!important;
        max-width:100%!important;
      }
      .modal-section{width:100%!important;max-width:100%!important;margin:0!important;padding:0!important;box-sizing:border-box!important}
      .event-card__title{font-size:14px!important}
      .event-card__meta{font-size:11px!important}
      .event-card__desc{font-size:12px!important}
      /* Botón de eliminar en recordatorios - responsive */
      .cal-modal__body .event-card .btn-danger,
      .cal-modal .event-card .btn-danger{
        padding:6px 10px!important;
        font-size:0.75rem!important;
        min-width:auto!important;
        width:auto!important;
        max-width:none!important;
        white-space:nowrap!important;
        flex-shrink:0!important;
        flex-grow:0!important;
      }
    }

    /* Modal recordatorio */
    .reminder-modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;z-index:130}
    .reminder-modal.open{display:block}
    .reminder__panel{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:min(92vw,680px);max-height:75vh;overflow:auto;border:1px solid #ffffff1f;border-radius:16px;background:linear-gradient(180deg,#2f3a4c 0%,#2a3343 100%);box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .reminder__header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #ffffff1a;background:linear-gradient(180deg,#2b3748 0%,#243043 100%)}
    .reminder__title{margin:0;font-weight:800;color:#eef5ff;font-size:1.1rem}
    .reminder__close{width:36px;height:36px;border-radius:8px;border:1px solid #ffffff1f;background:transparent;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:20px}
    .reminder__close:hover{background:#ffffff12}
    .reminder__body{padding:16px;display:grid;gap:10px;max-height:calc(75vh - 120px);overflow-y:auto}
    .form-row{display:grid;gap:6px}
    .form-row.two{grid-template-columns:1fr 1fr;gap:10px}
    .form-label{color:#dfe9f7;font-weight:700;font-size:0.9rem}
    .form-input,.form-select,.form-textarea{background:#1d2531;border:1px solid #ffffff1f;color:#eef5ff;border-radius:8px;padding:8px 10px;font-size:0.9rem}
    .form-textarea{min-height:70px;resize:vertical}
    /* Checklist de colaboradores */
    .collaborators-checklist{max-height:180px;overflow-y:auto;background:#1d2531;border:1px solid #ffffff1f;border-radius:8px;padding:8px;display:grid;gap:6px}
    .collaborator-checkbox{display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:6px;cursor:pointer;transition:background .15s ease}
    .collaborator-checkbox:hover{background:#ffffff08}
    .collaborator-checkbox input[type="checkbox"]{width:18px;height:18px;cursor:pointer;accent-color:#12b76a}
    .collaborator-checkbox label{cursor:pointer;color:#dfe9f7;font-size:0.9rem;flex:1}
    .form-actions{display:flex;justify-content:flex-end;gap:10px;margin-top:8px;padding-top:12px;border-top:1px solid #ffffff1a}
    .btn-primary{background:linear-gradient(135deg,#12b76a,#079455);border:1px solid #ffffff1f;color:#fff;font-weight:800;padding:10px 14px;border-radius:10px;cursor:pointer;font-size:.9rem}
    .btn-secondary{background:transparent;border:1px solid #ffffff1f;color:#dfe9f7;font-weight:800;padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn-danger{background:linear-gradient(135deg,#d72d2d,#b42318);border:1px solid #ffffff1f;color:#fff;font-weight:800;padding:8px 12px;border-radius:8px;cursor:pointer}

    /* Responsive calendar */
    @media(max-width:900px){
      .calendar__current{min-width:auto}
      .calendar__header{flex-direction:column;align-items:flex-start}
      .calendar__weekdays div{font-size:12px;padding:10px 6px}
      .cal-cell{min-height:92px}
    }
    @media(max-width:600px){
      .calendar__grid{grid-template-columns:repeat(7,1fr)}
      .cal-cell__events{max-height:56px}
      .calendar__title h2{font-size:1.1rem}
      .cal-add-btn{width:100%;justify-content:center}
      .cal-pill__text{display:none}
      .cal-pill__short{display:inline-block}
      .cal-pill{padding:4px 6px;font-size:11px}
    }
  </style>
{% endblock %}

{% block nav_inicio %}active{% endblock %}

{% block content %}
  <!-- ======= HERO / MAPA ======= -->
  <main class="hero" id="inicio">
    <div class="hero__inner">
      <section class="map-card" aria-label="Mapa de Purulhá">
        <div class="interactive-map">
          <svg
             version="1.1"
             id="svg1"
             width="1920"
             height="1080"
             viewBox="0 0 1920 1080"
             sodipodi:docname="mapa_regionizado_numerizado.svg"
             inkscape:version="1.4.2 (f4327f4, 2025-05-13)"
             xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
             xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
             xmlns="http://www.w3.org/2000/svg"
             xmlns:svg="http://www.w3.org/2000/svg"
             class="map-svg">
            <defs id="defs1" />
            <sodipodi:namedview
               id="namedview1"
               pagecolor="#ffffff"
               bordercolor="#000000"
               borderopacity="0.25"
               inkscape:showpageshadow="2"
               inkscape:pageopacity="0.0"
               inkscape:pagecheckerboard="0"
               inkscape:deskcolor="#d1d1d1"
               inkscape:zoom="0.59192565"
               inkscape:cx="968.02698"
               inkscape:cy="414.74803"
               inkscape:window-width="1920"
               inkscape:window-height="991"
               inkscape:window-x="-9"
               inkscape:window-y="-9"
               inkscape:window-maximized="1"
               inkscape:current-layer="g59" />
            <g inkscape:groupmode="layer" inkscape:label="Image" id="g1">
              <g id="g27" inkscape:label="g2">
                <path
                   style="fill:#0772d2"
                   d="m 334.67075,435.10237 c -2.82244,-0.59946 -5.66729,-2.62606 -10.81989,-7.70783 -13.64443,-13.45688 -20.26735,-24.2953 -26.44553,-43.27816 -6.34867,-19.50672 -7.3282,-20.18909 -28.60829,-19.92949 L 254.5,364.3613 240.07217,359.682 c -15.54379,-5.04124 -20.39418,-5.71391 -26.59224,-3.68795 C 199.32589,360.6206 191,369.51138 191,379.99918 c 0,5.55581 -7.57853,15.08416 -20.06987,25.23348 -8.70837,7.07562 -24.38777,12.03395 -32.95952,10.42285 -5.81394,-1.09275 -14.87627,-7.16108 -30.63546,-20.51414 C 99.129555,388.18862 90.634812,381.33365 88.457944,379.90811 84.460748,377.29051 77.428445,374.69876 71,373.47399 65.483776,372.42302 44.94244,361.18637 40.208565,356.63027 L 35.91713,352.5 l -9.091531,-0.35446 -9.091532,-0.35446 0.525188,-11.64554 c 0.80095,-17.76031 2.798792,-25.50922 10.756841,-41.72194 6.903999,-14.06533 9.998561,-18.34558 15.213227,-21.04219 C 47.58961,275.64374 69.37457,270.37146 77,269.45043 c 8.177676,-0.98774 22.325787,-5.22352 23.7171,-7.10064 0.66941,-0.90313 2.20052,-4.6138 3.40249,-8.24593 5.91262,-17.86694 12.5637,-28.79759 19.61042,-32.22852 4.64454,-2.26135 5.65249,-2.33267 38.32674,-2.71192 40.05988,-0.46498 64.72228,0.82988 82.25626,4.31871 6.95979,1.38483 13.78369,2.51787 15.16423,2.51787 1.70672,0 5.09459,2.32037 10.58542,7.25 4.44145,3.9875 10.7486,8.825 14.01589,10.75 3.26729,1.925 9.36682,5.85222 13.55451,8.72716 8.14481,5.59159 13.79274,7.60068 35.86694,12.75864 6.6,1.54219 13.27608,3.25936 14.83574,3.81593 l 2.83574,1.01194 -0.70371,7.09317 c -0.38705,3.90124 -1.55063,8.76273 -2.58575,10.80332 -1.03511,2.04059 -1.88034,4.74059 -1.87828,6 0.007,4.09709 3.76198,8.80035 8.77293,10.98754 2.59783,1.13391 4.89466,2.21213 5.10406,2.39604 0.2094,0.18391 -0.63036,2.82556 -1.86614,5.87032 C 355.9599,318.52649 355.4991,319 352.62725,319 c -8.48614,0 -16.19538,5.44704 -17.2763,12.20675 -0.334,2.0887 -2.34128,6.09968 -4.50161,8.99517 -2.14435,2.87409 -4.54702,7.40834 -5.33927,10.07612 -0.79224,2.66777 -2.58111,6.20611 -3.97526,7.86296 -4.14974,4.93168 -3.16786,7.2623 3.9638,9.40862 2.65059,0.79771 7.0237,1.45038 9.71802,1.45038 5.5628,0 17.318,2.32494 39.78337,7.86834 15.49192,3.82268 21.63694,6.21354 27.75,10.79677 l 3.25,2.43667 v 14.86508 14.86508 l -3.75,2.87219 c -2.0625,1.5797 -5.62668,4.07519 -7.9204,5.54553 -2.29371,1.47035 -4.46154,3.59068 -4.81738,4.71185 -0.60016,1.89092 -1.45654,2.03875 -11.82961,2.04215 -6.15043,0.002 -17.48261,0.20804 -25.18261,0.45783 -7.7,0.2498 -15.72316,0.0882 -17.82925,-0.35912 z"
                   id="path18"
                   inkscape:label="r2"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:53.5949px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;stroke-width:2.00981;pointer-events:none"
                   x="169.42657"
                   y="340.26562"
                   id="text26"
                   inkscape:label="numero2"
                   transform="scale(1.0728721,0.93207755)"><tspan
                     sodipodi:role="line"
                     id="tspan26"
                     x="169.42657"
                     y="340.26562"
                     style="stroke-width:2.00981">2</tspan></text>
              </g>
              <g id="g45" inkscape:label="g4">
                <path
                   style="fill:#0772d2"
                   d="m 443.0793,312.41315 c -3.52329,-3.07277 -7.56998,-6.03686 -8.99264,-6.58686 -5.73225,-2.2161 -55.6088,-4.9199 -69.21137,-3.75194 -3.46961,0.29791 -11.62511,-3.71073 -12.37846,-6.08434 -0.32753,-1.03195 0.27047,-3.58936 1.32889,-5.68314 1.17622,-2.32681 2.19754,-7.152 2.62695,-12.41088 0.6615,-8.10137 0.56657,-8.75716 -1.62506,-11.22549 -1.46986,-1.65544 -4.17016,-3.03266 -7.32761,-3.73726 -4.49426,-1.00293 -26.5689,-6.60509 -35.5,-9.00929 -1.925,-0.5182 -7.325,-3.64212 -12,-6.94205 -4.675,-3.29992 -10.525,-6.95606 -13,-8.12475 -2.475,-1.16869 -6.5442,-3.97715 -9.04267,-6.24102 -2.49846,-2.26387 -5.87346,-5.08744 -7.5,-6.27459 l -2.95733,-2.15845 4,-1.67594 c 2.2,-0.92177 9.85,-4.31494 17,-7.54037 22.8641,-10.31423 39.27811,-14.70115 63.66869,-17.0165 9.45848,-0.89788 13.48729,-0.91725 15.89922,-0.0764 1.77679,0.61939 6.9045,1.12617 11.39489,1.12617 9.09999,0 26.36754,2.08438 37.0372,4.47079 29.54658,6.60849 40.00639,8.06921 68,9.49626 11,0.56076 25.4,1.93838 32,3.06139 7.28051,1.2388 20.6524,2.40269 34,2.95938 12.1,0.50465 26.95,1.60506 33,2.44534 6.05,0.84029 16.46187,1.53658 23.13748,1.54732 l 12.13748,0.0195 2.48904,6.25 c 1.36897,3.4375 3.92571,10.82091 5.68164,16.40757 1.75594,5.58667 3.94901,10.81635 4.87349,11.62152 0.92448,0.80518 4.15587,2.26023 7.18087,3.23345 3.025,0.97322 8.55838,3.15831 12.29641,4.85575 6.3995,2.90603 6.77909,3.26279 6.5,6.10899 L 657.5,274.5 l -16,0.83877 c -15.6577,0.82082 -16.11767,0.90937 -21.5,4.13864 C 612.46964,283.99545 602.33959,289 600.72468,289 c -0.73279,0 -2.88312,-1.61339 -4.77851,-3.58532 -4.72272,-4.91341 -8.38924,-6.68053 -12.26916,-5.91325 -8.82002,1.74421 -17.76502,3.77976 -22.94898,5.22233 -5.65912,1.5748 -5.81158,1.56368 -7.79787,-0.56835 -2.47609,-2.65778 -3.04291,-2.39521 -12.43016,5.75795 -4.09326,3.55514 -7.93431,6.08118 -9.25,6.08319 -2.50989,0.004 -6.25,3.24182 -6.25,5.4109 0,1.5156 -2.51085,1.88904 -23,3.42078 -6.325,0.47285 -13.075,1.53345 -15,2.35689 -1.925,0.82345 -8,2.041 -13.5,2.70569 -15.84136,1.91446 -16.36244,2.04952 -19.9034,5.15851 -1.84834,1.62288 -3.52954,2.95068 -3.73597,2.95068 -0.20644,0 -3.25804,-2.51408 -6.78133,-5.58685 z"
                   id="path23"
                   inkscape:label="r4"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="454.45105"
                   y="271.68271"
                   id="text27"
                   inkscape:label="numero4"><tspan
                     sodipodi:role="line"
                     id="tspan27"
                     x="454.45105"
                     y="271.68271">4</tspan></text>
              </g>
              <g id="g44" inkscape:label="g1">
                <path
                   style="fill:#0772d2"
                   d="M 407.46402,383.96025 C 403.97824,380.1085 391.6478,375.00328 377.43518,371.52727 353.98625,365.79233 340.09105,363 335.00179,363 c -8.25053,0 -9.53935,-1.22985 -6.00179,-5.72713 1.1,-1.39842 2,-3.53364 2,-4.74494 0,-1.21129 1.73398,-4.6381 3.85328,-7.61514 2.11931,-2.97703 4.61289,-7.72237 5.54131,-10.54518 2.22056,-6.75159 4.39071,-8.56625 10.84528,-9.06878 9.40664,-0.73236 9.23359,-0.60795 12.37175,-8.89402 3.48272,-9.19586 4.70962,-9.90498 15.38838,-8.89419 4.125,0.39045 8.85,0.69855 10.5,0.68468 10.22316,-0.086 39.5084,2.25124 42.247,3.37169 4.56998,1.86972 12.253,8.51731 12.253,10.60167 0,0.95983 -3.13085,4.27475 -6.95745,7.3665 -7.31301,5.90864 -8.50699,7.76618 -7.51988,11.69913 0.42021,1.67425 -0.55444,4.66083 -3.20961,9.83505 -3.71762,7.24467 -3.81195,7.69347 -3.76862,17.93066 0.0267,6.29578 0.53224,11.38409 1.26272,12.70801 1.04404,1.89224 0.93982,2.35703 -0.72871,3.25 -1.07083,0.5731 -4.60681,1.04199 -7.85772,1.04199 -4.67916,0 -6.29539,-0.42501 -7.75671,-2.03975 z"
                   id="path20"
                   inkscape:label="r1"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="391.61325"
                   y="355.56689"
                   id="text27-8"
                   inkscape:label="numero1"><tspan
                     sodipodi:role="line"
                     id="tspan27-2"
                     x="391.61325"
                     y="355.56689">1</tspan></text>
              </g>
              <g id="g46" inkscape:label="g3">
                <path
                   style="fill:#0772d2"
                   d="m 429,443.04285 c -1.925,-0.39993 -7.775,-2.12698 -13,-3.8379 -5.225,-1.71091 -11.93669,-3.46945 -14.91486,-3.90785 l -5.41486,-0.7971 5.91486,-4.14112 c 10.09047,-7.06455 9.84515,-6.51784 10.41486,-23.20961 l 0.5,-14.64927 5,-0.57203 c 7.23435,-0.82764 13.2096,-2.7288 13.85394,-4.40794 0.30777,-0.80205 -0.35444,-4.05966 -1.47158,-7.23915 -1.58905,-4.52259 -1.94142,-7.52219 -1.61889,-13.78088 0.35669,-6.92127 0.86499,-8.74162 3.76965,-13.5 2.43161,-3.98343 3.37247,-6.72539 3.41213,-9.94403 0.054,-4.38639 0.20185,-4.57444 11.39684,-14.5 9.3622,-8.30059 12.0679,-10.17 15.5,-10.70924 2.28685,-0.35929 8.43291,-1.32837 13.65791,-2.1535 5.225,-0.82513 11.17305,-2.21866 13.21788,-3.09674 C 492.36642,311.24448 508,310.18243 508,311.32055 c 0,0.1763 -0.9,4.53205 -2,9.67945 -2.30824,10.80129 -2.46336,13.5956 -0.8114,14.61656 0.65373,0.40403 11.80674,0.62985 24.78446,0.50182 25.25767,-0.24917 26.75781,-0.0284 32.82978,4.83136 2.03344,1.62749 5.80645,3.88816 8.38448,5.02373 l 4.68731,2.06466 16.58983,-2.51797 c 9.1244,-1.38488 18.71511,-2.46185 21.31268,-2.39326 2.59757,0.0686 8.54786,-0.80448 13.22286,-1.94015 4.675,-1.13567 10.56978,-2.35822 13.0995,-2.71678 l 4.5995,-0.65192 1.22948,5.34097 c 1.85556,8.0607 2.34941,12.59764 1.66716,15.31596 -0.34769,1.38528 -3.58741,4.85605 -7.43316,7.96328 -3.74927,3.02927 -7.29224,6.55113 -7.87327,7.82634 -1.46242,3.20966 0.0537,11.9276 2.69574,15.50118 1.26281,1.70804 2.3491,5.0707 2.68292,8.30514 l 0.56094,5.43503 -15.8644,-0.3084 C 613.63898,403.02793 601.325,402.22072 595,401.40374 c -36.22484,-4.67901 -58.62887,-6.37413 -88.69859,-6.71104 l -17.19858,-0.1927 -5.15036,5 c -2.8327,2.75 -9.47689,11.075 -14.76487,18.5 -10.53814,14.79689 -17.15483,22.41457 -21.35646,24.58732 -2.87808,1.48831 -12.7147,1.72626 -18.83114,0.45553 z"
                   id="path15"
                   inkscape:label="r3"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="515.12726"
                   y="378.65567"
                   id="text28"
                   inkscape:label="numero3"><tspan
                     sodipodi:role="line"
                     id="tspan28"
                     x="515.12726"
                     y="378.65567">3</tspan></text>
              </g>
              <g id="g47" inkscape:label="g5">
                <path
                   style="fill:#0772d2"
                   d="m 572.25497,340.02916 c -2.33477,-1.05981 -5.93477,-3.26239 -8,-4.89463 -5.68122,-4.49009 -9.75544,-5.12285 -33.02402,-5.12895 L 509.9619,330 l 0.5017,-2.25 c 0.27593,-1.2375 1.19689,-5.36881 2.04656,-9.18069 0.84968,-3.81188 2.03759,-7.52438 2.6398,-8.25 C 515.82652,309.5041 518.46338,309 522.05102,309 528.19737,309 531,307.45089 531,304.05357 c 0,-1.16485 0.97388,-2.00226 2.75,-2.36461 1.5125,-0.30858 5.37047,-2.90521 8.57327,-5.7703 5.66713,-5.06957 5.91912,-5.17983 9.39767,-4.11223 2.81649,0.8644 4.32339,0.78406 7.10677,-0.37891 3.42746,-1.43209 12.1117,-3.56154 22.9692,-5.63225 l 5.29691,-1.01022 5.9504,5.67572 c 4.85019,4.6263 6.36691,5.54622 8.20309,4.97534 3.25942,-1.01337 19.78567,-9.35391 22.91082,-11.56273 2.23409,-1.57903 5.31913,-1.98368 19.33913,-2.53661 11.6913,-0.4611 17.07388,-1.05077 17.99446,-1.97134 1.92814,-1.92815 2.91508,-10.73681 1.49935,-13.38212 -1.24301,-2.32258 -10.26245,-6.82286 -20.92687,-10.44152 -3.53969,-1.20109 -6.74159,-2.82685 -7.11532,-3.6128 -1.77274,-3.72802 -9.53198,-29.06862 -9.00119,-29.39666 1.42688,-0.88186 55.15437,-1.58572 61.11036,-0.80058 6.56935,0.866 23.83827,-0.25084 47.24231,-3.05531 9.27979,-1.11198 11.09131,-1.0904 12.86693,0.15329 1.74934,1.22528 1.9731,2.12936 1.45769,5.88967 -0.33488,2.4432 -0.17082,5.26069 0.36458,6.26109 1.03714,1.93792 8.82695,5.01951 12.68858,5.01951 2.75421,0 3.01085,1.89725 0.57186,4.22747 -0.9625,0.91958 -2.27615,2.18093 -2.91923,2.80301 -0.64308,0.62208 -2.55558,2.4101 -4.25,3.97337 -3.48278,3.21319 -3.83401,5.10005 -1.40208,7.53199 1.75895,1.75894 6.85764,1.66581 17.4733,-0.31917 l 4.65199,-0.86985 0.48064,7.57659 c 0.26436,4.16712 0.79574,8.53095 1.18086,9.69739 0.56627,1.71512 0.21167,2.24341 -1.85377,2.76181 -3.13039,0.78568 -4.98654,3.98781 -4.17828,7.20817 0.33568,1.33747 3.47974,4.66485 7.08503,7.49814 3.56485,2.8015 6.48154,5.4414 6.48154,5.86644 0,1.10986 -8.10083,2.06317 -12.10388,1.42439 -2.49969,-0.39889 -5.24381,0.29223 -10.39612,2.61832 -4.98709,2.25149 -9.52095,3.42319 -15.76672,4.07466 -4.8217,0.50292 -10.38916,1.5923 -12.37213,2.42084 -1.98297,0.82854 -6.13794,1.51717 -9.23327,1.53029 -7.42249,0.0315 -13.27335,1.45459 -14.8511,3.6123 C 709.49915,310.69964 709,314.43508 709,319.19113 709,326.69416 708.9091,327 706.67814,327 c -1.27702,0 -4.47793,-0.73465 -7.11313,-1.63255 -4.39691,-1.49818 -5.46102,-1.50294 -12.92814,-0.0578 -4.47528,0.86609 -11.73687,1.56083 -16.13687,1.54386 -5.65968,-0.0218 -10.48659,0.6981 -16.5,2.46096 -4.675,1.3705 -11.875,2.99686 -16,3.61414 -4.125,0.61727 -9.79651,1.77925 -12.60336,2.58217 -2.80684,0.80292 -7.30684,1.42746 -10,1.38787 -2.69315,-0.0396 -12.4496,1.09201 -21.68099,2.51469 -9.2314,1.42268 -16.8814,2.57681 -17,2.56473 -0.11861,-0.0121 -2.12591,-0.88908 -4.46068,-1.94888 z"
                   id="path22"
                   inkscape:label="r5"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="684.47937"
                   y="288.49957"
                   id="text44"
                   inkscape:label="numero5"><tspan
                     sodipodi:role="line"
                     id="tspan44"
                     x="684.47937"
                     y="288.49957">5</tspan></text>
              </g>
              <g id="g48" inkscape:label="g6">
                <path
                   style="fill:#0772d2"
                   d="m 824.57627,410.48092 c -1.05806,-0.80051 -3.53306,-1.73532 -5.5,-2.07734 -1.96695,-0.34203 -6.95127,-2.41877 -11.07627,-4.61499 -8.88624,-4.73117 -17.16885,-7.35754 -25.76231,-8.16909 -5.86322,-0.55372 -12.79486,-3.17731 -16.23769,-6.1459 -1.63168,-1.40692 -24.63333,-11.15387 -29.5,-12.50062 -8.38172,-2.31947 -11.22891,-2.79983 -13.67512,-2.30719 -9.44004,1.90112 -14.74505,-7.00174 -9.81186,-16.46626 1.82484,-3.50104 2.0148,-5.78531 2.03206,-24.43611 C 715.06678,310.33175 714.34539,312 724.45606,312 c 3.46087,0 8.26156,-0.70486 10.66821,-1.56635 2.40665,-0.86149 8.32724,-1.98427 13.15686,-2.49506 6.06632,-0.64158 10.70379,-1.81918 15,-3.80898 5.0147,-2.32256 7.57881,-2.87593 13.24221,-2.85788 4.98992,0.0159 8.39181,-0.58295 11.75,-2.06844 6.63043,-2.93296 6.28964,-4.87073 -2.02334,-11.50509 -9.48485,-7.5696 -9.99302,-8.2996 -6.29271,-9.03966 3.64164,-0.72833 4.66284,-3.76243 3.12746,-9.29205 -0.59048,-2.12657 -1.083,-7.46649 -1.09449,-11.86649 -0.0285,-10.89666 -0.21196,-11.10103 -8.64915,-9.63234 -3.76261,0.65497 -8.07785,1.45501 -9.58942,1.77785 -2.65394,0.56684 -2.59803,0.42331 1.62845,-4.1799 7.84476,-8.54401 7.78856,-13.72692 -0.16229,-14.96683 -2.04482,-0.31889 -5.29285,-0.99649 -7.21785,-1.50578 -3.49942,-0.92585 -3.50001,-0.92699 -3.53382,-6.8864 l -0.0338,-5.96041 5.53382,-0.59544 c 8.3466,-0.89811 63.82908,-2.52378 86.6233,-2.53812 23.39142,-0.0147 20.78853,-1.51541 24.35365,14.04117 2.2478,9.8084 5.91112,24.41454 14.0317,55.9462 2.62045,10.175 5.0828,20.75 5.4719,23.5 0.76955,5.43892 5.24146,21.9303 6.71137,24.75 2.45356,4.70665 8.47933,-0.41028 17.79617,-15.11209 l 3.39807,-5.36209 14.57383,0.6794 c 8.01561,0.37367 18.39883,1.12232 23.07383,1.66368 4.675,0.54136 15.25,1.62699 23.5,2.41252 8.25,0.78553 19.275,2.19124 24.49998,3.12381 14.965,2.67098 20.5318,2.29627 36,-2.42319 7.425,-2.26543 15.3,-4.43227 17.5,-4.8152 2.2,-0.38293 9.1666,-1.98337 15.4813,-3.55654 6.3148,-1.57316 12.6148,-2.87557 14,-2.89423 1.3853,-0.0187 4.3187,-0.90339 6.5187,-1.96607 5.0002,-2.41527 14.7012,-2.58862 26.5,-0.47353 12.8177,2.29774 49.7004,6.49329 65.3805,7.43729 16.5789,0.99811 15.2185,0.056 27.7918,19.24689 16.4785,25.15141 17.9689,27.72808 17.6416,30.49948 -0.2963,2.50771 -1.2415,2.94911 -16.8139,7.85154 -9.075,2.85695 -24.3638,8.13718 -33.9751,11.73384 l -17.4752,6.5394 -1.8346,4.31986 c -4.1002,9.65437 -6.7585,9.9559 -19.7665,2.24215 -11.2098,-6.6475 -12.7656,-7.30822 -19.9486,-8.47188 -3.025,-0.49006 -7.975,-1.62065 -11,-2.51242 -9.0909,-2.67998 -13.9674,-3.19089 -21.4134,-2.24344 -3.8976,0.49594 -18.1116,1.22326 -31.5866,1.61626 -23.8706,0.6962 -24.6413,0.78373 -30,3.40692 -3.025,1.4808 -7.8846,3.1683 -10.7992,3.75 -7.6833,1.53345 -22.85866,1.29145 -28.62042,-0.45641 -6.39451,-1.93981 -21.96922,-1.98383 -31.58036,-0.0893 -4.125,0.81312 -13.35,3.04372 -20.5,4.95689 -13.27962,3.5533 -19.69913,4.6773 -53,9.27987 -10.45,1.44431 -23.275,3.72021 -28.5,5.05755 -8.93388,2.28663 -24.28671,5.34319 -26.5,5.27583 -0.55,-0.0167 -1.86568,-0.6854 -2.92373,-1.48591 z"
                   id="path19"
                   inkscape:label="r6"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="947.52307"
                   y="366.28131"
                   id="text33"
                   inkscape:label="numero6"><tspan
                     sodipodi:role="line"
                     id="tspan33"
                     x="947.52307"
                     y="366.28131">6</tspan></text>
              </g>
              <g id="g49" inkscape:label="g7">
                <path
                   style="fill:#0772d2"
                   d="m 702.59997,582.52237 c -4.12416,-1.46972 -4.55838,-1.90721 -7.60049,-7.65773 -4.13283,-7.81232 -11.86145,-37.34665 -16.91362,-64.63412 -2.93176,-15.83484 -8.10266,-31.2001 -16.59443,-49.31015 -4.0179,-8.5688 -8.29898,-18.9188 -9.51353,-23 -1.21455,-4.0812 -3.66527,-10.34537 -5.44605,-13.92037 -4.14893,-8.32918 -4.81941,-12.04992 -3.43732,-19.07497 1.31653,-6.6918 -0.0628,-15.15165 -3.00012,-18.40091 -1.0064,-1.11326 -2.09484,-3.76574 -2.41876,-5.8944 -0.63443,-4.16917 -0.12593,-4.85999 8.91913,-12.11721 2.04791,-1.64311 4.55018,-4.34311 5.5606,-6 2.26588,-3.71554 2.4324,-11.86151 0.34462,-16.85827 -0.825,-1.9745 -1.5,-4.91956 -1.5,-6.54457 0,-2.46032 0.54367,-3.12286 3.25,-3.96064 6.1847,-1.91454 10.28886,-2.48669 19.25,-2.6836 4.95,-0.10877 11.925,-0.76981 15.5,-1.46897 5.88302,-1.15055 7.11698,-1.07928 13,0.75082 l 6.5,2.02203 -0.0576,10.36535 c -0.0434,7.80787 -0.53001,11.52366 -1.97221,15.05998 -1.70279,4.17528 -1.77284,5.22626 -0.63317,9.5 2.37094,8.89096 7.41384,11.85393 21.66299,12.72813 4.14795,0.25448 9.03718,1.32002 12,2.61524 2.75,1.20219 8.7479,3.71453 13.32867,5.583 4.58077,1.86847 9.77999,4.50419 11.55382,5.85716 4.84133,3.69266 9.60816,5.37094 17.23665,6.06859 9.00165,0.82323 12.27074,1.79812 21.88086,6.52523 4.4,2.1643 11.59083,5.31127 15.97962,6.99325 l 7.97963,3.05814 9.02037,-1.62823 c 4.96121,-0.89553 11.27038,-2.29541 14.02038,-3.11085 6.70202,-1.98732 23.11687,-4.88359 39,-6.88126 25.35124,-3.18849 40.47543,-6.13157 56.5,-10.99457 12.24116,-3.71485 33.50522,-4.69981 42.5,-1.96861 10.59783,3.21795 31.01209,1.27216 41.23679,-3.93047 4.5093,-2.29449 6.0691,-2.46264 29.2632,-3.15476 33.7522,-1.00718 43.9231,-0.96888 48,0.18073 l 3.5,0.98694 -9,4.17615 c -4.95,2.29688 -9.675,4.63604 -10.5,5.19812 -0.825,0.56209 -4.2,2.235 -7.5,3.71757 -3.3,1.48257 -8.925,4.25161 -12.5,6.15342 -3.575,1.9018 -8.75,4.56392 -11.5,5.91582 -2.75,1.35189 -6.35,3.4446 -8,4.65047 -1.65,1.20586 -5.925,3.88798 -9.5,5.96025 -10.1867,5.90478 -20.7697,13.62986 -42,30.6578 -7.18822,5.76538 -17.83904,13.33261 -24.40296,17.3379 -1.70337,1.03939 -5.61237,3.60501 -8.68667,5.70138 -3.07431,2.09638 -7.81483,4.68867 -10.53449,5.76067 -2.71967,1.07199 -7.85433,3.52052 -11.41036,5.44117 -3.55603,1.92066 -8.17835,4.03371 -10.27182,4.69568 -2.09346,0.66196 -7.71828,3.1997 -12.49959,5.63942 -4.78131,2.43972 -11.66755,5.32163 -15.30276,6.40424 -4.82175,1.43598 -9.69048,4.15316 -18.00041,10.0458 C 865.79846,531.45324 828.06725,547 811.41821,547 c -5.69492,0 -6.73398,-0.37365 -13.71872,-4.93334 -10.03477,-6.55077 -13.7983,-7.56831 -19.12682,-5.17128 -4.34199,1.95324 -14.18264,11.78912 -24.19389,24.18215 -9.2549,11.45674 -13.6892,14.62757 -26.67352,19.0734 -12.13682,4.15566 -18.43043,4.75015 -25.10529,2.37144 z"
                   id="path13"
                   inkscape:label="r7"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="768"
                   y="484.5"
                   id="text32"
                   inkscape:label="numero7"><tspan
                     sodipodi:role="line"
                     id="tspan32"
                     x="768"
                     y="484.5">7</tspan></text>
              </g>
              <g id="g50" inkscape:label="g8">
                <path
                   style="fill:#0772d2"
                   d="m 1263.2115,351.12178 c -0.6488,-0.40686 -0.712,-10.80717 -0.1827,-30.08919 0.5022,-18.29425 0.4495,-30.13883 -0.1388,-31.23819 -0.5213,-0.97393 -1.9472,-1.97833 -3.1689,-2.23199 -1.2216,-0.25367 -5.5961,-1.13672 -9.7211,-1.96234 -4.125,-0.82562 -14.025,-2.91551 -22,-4.6442 -26.7658,-5.80186 -26.9794,-5.83357 -28.5718,-4.24121 -1.0939,1.09387 -1.4282,4.52974 -1.4282,14.6775 v 13.24931 l -8.75,-0.37922 c -12.9888,-0.56292 -54.1553,-5.07768 -66.6749,-7.31228 -13.8461,-2.47138 -21.273,-2.46578 -30.0751,0.0227 -6.4714,1.82954 -24.4158,6.17557 -37.5,9.0823 -3.025,0.67203 -10.45,2.73289 -16.5,4.57971 -15.581,4.75624 -17.7762,4.87859 -35.5,1.97862 -8.525,-1.39487 -20.9,-3.01043 -27.5,-3.59013 -6.6,-0.5797 -15.6,-1.45198 -20,-1.93838 -4.4,-0.4864 -14.80753,-1.20943 -23.12785,-1.60672 -17.51927,-0.83654 -15.23722,-1.90009 -24.81819,11.56648 l -5.94604,8.35747 -1.25105,-2.95099 c -0.68808,-1.62305 -1.95711,-6.326 -2.82007,-10.451 -3.83356,-18.32471 -5.98542,-27.38505 -9.50014,-40 -2.06871,-7.425 -4.99131,-18.675 -6.49465,-25 -1.50333,-6.325 -3.99915,-16.62769 -5.54626,-22.89487 l -2.81291,-11.39488 11.931,0.67428 c 6.56205,0.37085 17.77326,1.77516 24.91381,3.12068 14.11901,2.6605 38.40008,4.46487 60.47235,4.49379 15.24721,0.02 52.5146,2.36604 64.5,4.06042 4.125,0.58315 13.2404,2.15834 20.2565,3.50043 14.7297,2.81758 23.6656,3.0601 33.8461,0.91856 16.4777,-3.46618 37.1188,-8.83413 48.0552,-12.49727 6.4117,-2.14763 17.3669,-4.85684 24.3448,-6.02047 6.9779,-1.16362 17.4451,-3.69112 23.2605,-5.61665 5.8155,-1.92553 15.5603,-4.56618 21.6552,-5.86811 6.0949,-1.30193 13.9389,-3.5384 17.4309,-4.96992 14.1086,-5.78363 43.0572,-5.97229 65.1508,-0.42459 10.7499,2.6993 15.2239,3.2559 31.9552,3.97549 11.4033,0.49044 22.3708,0.45766 26.5,-0.0792 3.8746,-0.50377 7.3395,-0.92983 7.6996,-0.94681 0.3602,-0.017 0.4201,1.71961 0.1331,3.85909 -0.5905,4.40261 1.4747,11.57864 5.8513,20.33151 2.4186,4.83712 2.8608,6.9344 2.8608,13.5685 0,8.19779 1.9325,16.60956 4.9877,21.71002 0.9883,1.65 2.7424,6.78623 3.8979,11.41384 1.1555,4.62761 2.7618,9.14408 3.5695,10.0366 3.1679,3.50046 4.5449,8.9593 4.5449,18.01744 V 305 h -3.8743 c -4.5446,0 -11.7621,2.36098 -14.3347,4.68913 -0.9945,0.90006 -2.3049,3.47571 -2.9119,5.72367 -3.0552,11.31496 -4.0237,12.05489 -16.8791,12.89654 -5.225,0.34209 -11.525,1.29977 -14,2.12818 -2.475,0.82842 -7.2713,1.93724 -10.6585,2.46405 -6.1256,0.95272 -12.2012,4.00407 -15.6464,7.8581 -1.2982,1.45227 -3.673,2.21915 -8.4593,2.73172 -3.66,0.39195 -10.4978,2.07967 -15.1951,3.75048 -10.3483,3.68078 -14.5171,4.70263 -15.8292,3.87991 z"
                   id="path21"
                   inkscape:label="r8"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="1132.785"
                   y="267.28635"
                   id="text34"
                   inkscape:label="numero8"><tspan
                     sodipodi:role="line"
                     id="tspan34"
                     x="1132.785"
                     y="267.28635">8</tspan></text>
              </g>
              <g id="g51" inkscape:label="g9">
                <path
                   style="fill:#0772d2"
                   d="m 1408.153,316.5555 c -2.3908,-0.77097 -6.9205,-3.20699 -10.0659,-5.41338 -3.1454,-2.20639 -6.8715,-4.30089 -8.2802,-4.65444 -2.5227,-0.63318 -2.5676,-0.81046 -2.9916,-11.81525 -0.4076,-10.57821 -0.622,-11.51814 -4.0315,-17.67243 -1.9806,-3.575 -4.3363,-9.425 -5.2348,-13 -0.8985,-3.575 -2.8057,-8.975 -4.2383,-12 -2.0774,-4.38675 -2.751,-7.72651 -3.3278,-16.5 -0.6559,-9.97492 -1.0848,-11.74552 -4.6031,-19 -3.2396,-6.67989 -3.8768,-9.02059 -3.8616,-14.18487 0.01,-3.40168 0.3549,-6.52159 0.7665,-6.93313 0.4115,-0.41154 7.1533,-1.07554 14.9818,-1.47556 10.072,-0.51465 21.5352,-2.0753 39.2075,-5.3379 C 1462.2611,180.11549 1489.9651,177 1519.3452,177 c 11.3753,0 13.6645,0.2755 16.6704,2.0063 8.3294,4.79602 7.5739,4.77392 15.7435,0.46037 4.132,-2.18167 13.7515,-7.86261 21.3768,-12.62432 L 1587,158.1847 l 0.073,5.65765 c 0.1462,11.32859 1.3555,16.26991 4.6674,19.07167 9.1756,7.7622 22.462,13.47514 34.134,14.67703 3.0941,0.3186 7.3222,1.21596 9.3958,1.99412 2.0737,0.77815 6.4969,1.41483 9.8295,1.41483 4.0222,0 8.1336,0.80852 12.2297,2.40502 3.3939,1.32276 8.4206,2.69647 11.1706,3.05269 8.8701,1.14899 14.3888,3.42652 16.04,6.61961 0.8259,1.59711 2.6173,3.63484 3.9808,4.52827 4.0846,2.67636 3.1484,4.86076 -3.1098,7.25563 -3.0739,1.17633 -6.2552,2.13878 -7.0695,2.13878 -0.8143,0 -4.7118,1.31667 -8.661,2.92594 -3.9493,1.60927 -10.5555,3.39517 -14.6805,3.96867 -4.125,0.57349 -11.7454,2.19044 -16.9343,3.59321 -9.1055,2.4616 -9.6033,2.49435 -14.2839,0.93972 -6.8056,-2.26048 -12.8195,-0.68501 -21.0064,5.50308 -7.5751,5.72574 -9.5461,6.81213 -15.6453,8.62337 -2.592,0.76974 -6.9441,2.99712 -9.6714,4.94973 -2.7273,1.95261 -7.4337,4.26459 -10.4587,5.13773 -3.025,0.87315 -7.0571,2.77352 -8.9602,4.22305 -1.9031,1.44952 -7.5106,4.92519 -12.4611,7.7237 -10.7361,6.06908 -14.3301,10.07688 -15.463,17.24338 -1.2446,7.8734 -7.176,13.07751 -19.5708,17.17099 -6.7606,2.23275 -7.3198,2.26146 -20,1.0267 -7.1747,-0.69866 -17.1159,-1.46979 -22.0915,-1.71362 -8.9023,-0.43627 -9.1575,-0.38389 -16,3.28463 -6.6534,3.56712 -7.5143,3.76026 -19.9534,4.47635 -7.15,0.4116 -14.575,1.00313 -16.5,1.31451 -1.925,0.31137 -5.4561,-0.0647 -7.847,-0.83564 z"
                   id="path24"
                   inkscape:label="r9"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="1487.7527"
                   y="254.55844"
                   id="text41"
                   inkscape:label="numero9"><tspan
                     sodipodi:role="line"
                     id="tspan41"
                     x="1487.7527"
                     y="254.55844">9</tspan></text>
              </g>
              <g id="g52" inkscape:label="g10">
                <path
                   style="fill:#0772d2"
                   d="m 1233,438.09645 c 0,-1.54009 14.0541,-27.54372 15.8042,-29.24184 1.6799,-1.62997 23.7089,-7.09454 34.012,-8.4371 2.9239,-0.381 5.9614,-1.33795 6.75,-2.12655 1.1634,-1.16342 1.4338,-5.84844 1.4338,-24.84334 V 350.0381 l 2.25,-0.45427 c 1.2375,-0.24985 3.9631,-0.68429 6.0569,-0.96541 2.3051,-0.30951 5.2111,-1.74406 7.3665,-3.63651 4.3267,-3.79895 7.7006,-5.30698 16.8266,-7.52106 9.7195,-2.35806 16.0438,-3.30256 22.6849,-3.38785 11.7524,-0.15092 16.4974,-4.43016 19.2813,-17.3889 0.9422,-4.3858 6.1,-6.08256 16.0338,-5.27468 7.3056,0.59415 8.5642,1.03323 14.5,5.05873 8.483,5.75289 16.5651,8.13059 22.5308,6.6284 2.3952,-0.6031 8.336,-1.09655 13.2019,-1.09655 10.1334,0 18.9747,-1.98369 23.3846,-5.24666 2.7028,-1.99985 4.1893,-2.248 13.2141,-2.20585 5.5927,0.0261 14.4436,0.65033 19.6686,1.38713 5.225,0.73681 10.85,1.29246 12.5,1.23478 2.7953,-0.0977 14.0495,-3.16393 19.3123,-5.26163 2.2485,-0.89625 2.2948,-0.80422 1.6767,3.33528 -0.3496,2.34132 -0.2191,5.38195 0.29,6.75695 0.6272,1.69389 0.5186,3.46734 -0.337,5.5 -1.4516,3.44888 -0.9922,22.375 0.7069,29.11918 0.8455,3.3561 0.7261,4.72189 -0.6447,7.37276 -1.339,2.58923 -1.5476,4.70891 -1.0216,10.38082 0.3635,3.91998 0.8772,7.89355 1.1416,8.83016 0.3408,1.20735 -0.6259,2.25316 -3.3218,3.5937 -5.9703,2.96875 -22.9412,7.99589 -32.62,9.66274 -4.8497,0.83519 -12.7247,2.4633 -17.5,3.61802 -4.7753,1.15472 -12.7324,2.74266 -17.6824,3.52876 -15.547,2.469 -30.7738,5.50624 -37,7.38027 -8.162,2.4567 -18.2786,3.91849 -35.5,5.12957 -7.975,0.56084 -17.875,1.88785 -22,2.94891 -4.125,1.06106 -11.1,2.57145 -15.5,3.35643 -4.4,0.78497 -12.05,2.17177 -17,3.08177 -12.0742,2.21971 -39.9875,6.40224 -50.5,7.56693 -4.675,0.51795 -13.45,1.80043 -19.5,2.84995 -15.1105,2.6213 -20.5,3.19349 -20.5,2.17648 z"
                   id="path17"
                   inkscape:label="r10"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="1391.5862"
                   y="383.25189"
                   id="text42"
                   inkscape:label="numero10"><tspan
                     sodipodi:role="line"
                     id="tspan42"
                     x="1391.5862"
                     y="383.25189">10</tspan></text>
              </g>
              <g id="g53" inkscape:label="g11">
                <path
                   style="fill:#0772d2"
                   d="m 1110,766.07662 c -6.875,-3.31948 -13.0359,-6.04469 -13.691,-6.05602 -2.7267,-0.0472 -2.1748,-2.35576 1.9758,-8.26422 2.4173,-3.44101 7.6575,-11.43138 11.6451,-17.75638 3.9875,-6.325 8.9557,-13.975 11.0404,-17 2.0848,-3.025 5.8406,-9.1 8.3463,-13.5 7.3396,-12.88856 9.389,-16.39006 16.3886,-28 8.305,-13.77515 15.4621,-25.18011 21.3938,-34.09107 2.5294,-3.79991 6.3,-9.7634 8.379,-13.25219 2.0791,-3.48879 6.6474,-10.14491 10.1518,-14.79138 3.5045,-4.64647 7.2777,-10.11701 8.3849,-12.15674 4.4441,-8.18723 10.4943,-16.77311 25.5148,-36.20862 C 1232.286,548.49394 1235,544.74786 1235,543.64597 c 0,-0.61236 3.5661,-4.49572 7.9247,-8.62968 5.9007,-5.59655 9.668,-8.25196 14.75,-10.39664 15.2399,-6.43141 17.9828,-7.87752 21.5753,-11.37486 2.0625,-2.00788 3.75,-4.30731 3.75,-5.10985 0,-2.59894 9.1864,-17.21317 11.8824,-18.90318 10.8891,-6.82594 15.6553,-13.74852 16.9669,-24.64338 0.5424,-4.50553 1.4551,-7.28801 2.8972,-8.83295 1.1579,-1.24049 2.3972,-3.4325 2.7541,-4.87114 0.8077,-3.25626 -1.0666,-10.46607 -3.6721,-14.12512 -1.0806,-1.51754 -1.8215,-2.80765 -1.6466,-2.86691 0.175,-0.0593 3.4681,-0.69076 7.3181,-1.40334 16.967,-3.14037 29.506,-5.75166 36,-7.49711 3.85,-1.0348 13.975,-2.36522 22.5,-2.95649 13.9374,-0.96666 34.0089,-3.85337 38.0425,-5.47132 1.1671,-0.46814 3.1142,2.23803 8,11.11867 3.5516,6.45557 8.0612,14.23038 10.0213,17.27737 6.5082,10.11687 11.14,19.06653 10.5983,20.47809 -0.2941,0.76657 -17.1754,9.70686 -37.5139,19.86731 -20.3384,10.16045 -38.0296,19.23121 -39.3136,20.15724 -1.284,0.92603 -7.5096,4.49888 -13.8346,7.93967 -6.325,3.44079 -14.2,7.89252 -17.5,9.89274 -3.3,2.00022 -8.2923,4.72129 -11.0941,6.04684 -5.7641,2.72712 -13.4976,11.37576 -15.4431,17.27071 -0.6579,1.99348 -0.9657,5.66922 -0.684,8.1683 0.4186,3.71411 1.2159,5.15102 4.3667,7.86933 2.12,1.82905 4.9795,3.58525 6.3545,3.90266 1.375,0.31741 6.0474,1.4861 10.3831,2.59709 l 7.8831,2.01998 23.1169,-2.19992 c 24.7797,-2.35815 36.2871,-2.20624 48.8208,0.64448 6.5313,1.48552 9.7961,3.80981 9.7961,6.97406 0,1.37074 -9.3791,5.64469 -24.838,11.31841 -11.6635,4.28073 -24.6845,10.44682 -34.2299,16.2096 -2.9877,1.80369 -11.2496,6.26716 -18.3598,9.91883 l -12.9277,6.63939 -3.9295,9.41257 c -2.1612,5.17692 -4.9932,13.05234 -6.2933,17.50094 -1.3002,4.4486 -3.9964,12.3236 -5.9916,17.5 -4.4048,11.42759 -5.9416,15.67972 -11.7145,32.41164 l -4.4853,13 -7.3652,0.62484 c -9.7635,0.82829 -26.6958,4.99939 -37.1598,9.15393 -14.0871,5.59299 -29.2518,16.14791 -46.9588,32.68434 l -7.6153,7.11181 -8.8156,0.96049 c -12.0797,1.31611 -21.7712,3.52547 -31.5542,7.19335 -7.4094,2.778 -9.6539,3.13799 -21.7615,3.49038 l -13.5,0.39291 z"
                   id="path2"
                   inkscape:label="r11"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="1262.8927"
                   y="619.42554"
                   id="text36"
                   inkscape:label="numero11"><tspan
                     sodipodi:role="line"
                     id="tspan36"
                     x="1262.8927"
                     y="619.42554">11</tspan></text>
              </g>
              <g id="g54" inkscape:label="g12">
                <path
                   style="fill:#0772d2"
                   d="m 1340.5,734.39167 c -1.65,-0.91778 -4.9232,-3.42548 -7.2737,-5.57266 -3.9037,-3.56589 -19.4582,-11.96121 -27.0915,-14.62219 -1.7242,-0.60103 -3.1192,-1.67869 -3.1002,-2.3948 0.036,-1.36039 5.5304,-17.24332 11.001,-31.80202 4.1064,-10.92815 11.63,-31.92748 13.9729,-39 5.1014,-15.39989 4.8885,-15.09959 14.023,-19.78512 4.5946,-2.35681 12.2047,-6.45246 16.9112,-9.10145 18.2427,-10.26759 24.1512,-13.1169 41.4793,-20.00293 21.6019,-8.5844 26.578,-11.29968 26.578,-14.50262 0,-3.15097 -5.4562,-10.44482 -8.7834,-11.74155 -5.5861,-2.17714 -21.6722,-4.86605 -29.0633,-4.85813 -4.2093,0.005 -11.4783,0.43637 -16.1533,0.95967 -4.675,0.5233 -14.8129,1.41633 -22.5287,1.98451 -12.8202,0.94406 -14.6214,0.86352 -20.9107,-0.93504 -9.1428,-2.6146 -14.5606,-6.36833 -14.5606,-10.08824 0,-4.20926 1.6366,-7.71751 6.0711,-13.01399 2.5257,-3.01672 5.3786,-5.226 7.7179,-5.97684 2.041,-0.65512 4.386,-1.75793 5.211,-2.4507 0.825,-0.69276 3.75,-2.45454 6.5,-3.91506 2.75,-1.46052 12.425,-6.83762 21.5,-11.94912 9.075,-5.1115 33.229,-17.58033 53.6754,-27.70851 24.6306,-12.20075 37.2007,-18.94366 37.25,-19.98186 0.1011,-2.12319 -4.0192,-9.98271 -13.0709,-24.93302 -8.9578,-14.79539 -16.2363,-27.9618 -15.7219,-28.44035 0.477,-0.44386 20.8876,-4.24795 27.3674,-5.10071 2.75,-0.36191 9.275,-1.70656 14.5,-2.98811 5.225,-1.28156 14.4544,-3.22439 20.5098,-4.31739 9.07,-1.63717 25.8456,-6.4371 33.7363,-9.65283 1.9593,-0.79847 1.8305,0.97401 -0.8355,11.49939 -0.7662,3.025 -2.2856,15.4 -3.3766,27.5 -1.3838,15.348 -2.8717,25.62837 -4.9208,34 -5.6947,23.26518 -8.1641,55.30621 -4.5418,58.92857 0.8643,0.86429 1.7788,1.57143 2.0321,1.57143 2.0246,0 9.9093,-4.49799 22.2846,-12.71259 16.2099,-10.75997 38.3674,-24.36522 38.8672,-23.86541 0.3846,0.38459 -2.6839,5.37535 -8.5271,13.86871 -10.041,14.59505 -11.7539,17.67876 -16.7299,30.11873 -6.6337,16.58399 -13.0392,31.45844 -18.7936,43.64097 -7.132,15.09921 -7.7965,16.95259 -9.2679,25.85012 -1.397,8.44788 -6.4244,21.09947 -8.3843,21.09947 -2.8072,0 -5.053,4.08385 -5.0869,9.25 -0.046,6.97177 -4.0615,16.94823 -12.0494,29.93447 C 1480.4334,680.2268 1478.2085,683 1475.0181,683 c -10.4685,0 -67.7492,23.45053 -86.359,35.35508 -11.5887,7.41319 -20.9262,12.87552 -25.3704,14.84142 -6.3148,2.79333 -18.7436,3.44517 -22.7887,1.19517 z"
                   id="path11"
                   inkscape:label="r12"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="1455.2257"
                   y="547.30066"
                   id="text37"
                   inkscape:label="numero12"><tspan
                     sodipodi:role="line"
                     id="tspan37"
                     x="1455.2257"
                     y="547.30066">12</tspan></text>
              </g>
              <g id="g55" inkscape:label="g13">
                <path
                   style="fill:#0772d2"
                   d="m 1681.5,748.55315 c -3.3,-1.28846 -9.375,-3.72452 -13.5,-5.41348 -4.5383,-1.85819 -9.3261,-3.08442 -12.1243,-3.10525 -2.5433,-0.0189 -6.5374,-0.70942 -8.8757,-1.53442 -2.8129,-0.99246 -8.0575,-1.5 -15.5,-1.5 -7.9105,0 -12.5471,-0.4814 -15.6243,-1.62223 -3.4919,-1.29458 -8.9202,-1.6585 -26.8757,-1.8018 -19.5233,-0.1558 -23.8222,-0.48459 -32.4944,-2.48519 -17.8225,-4.11151 -48.8998,-17.37678 -61.7498,-26.35773 -4.6664,-3.26141 -6.3081,-5.20826 -8.75,-10.37651 -1.6532,-3.49903 -3.0058,-6.73693 -3.0058,-7.19532 0,-0.4584 2.25,-3.637 5,-7.06357 2.75,-3.42656 5,-6.70482 5,-7.28502 0,-0.5802 2.3281,-5.08885 5.1736,-10.01923 5.8742,-10.17814 10.8264,-23.22025 10.8264,-28.51218 0,-2.84925 0.9004,-4.53646 4.4414,-8.32202 4.8124,-5.14488 6.5241,-9.61655 8.9948,-23.49832 1.0333,-5.80558 3.1689,-11.61582 7.8883,-21.46088 6.679,-13.93302 8.0662,-17.14767 17.2607,-40 2.9874,-7.425 5.8316,-14.20736 6.3205,-15.07191 0.4888,-0.86456 2.151,-4.01456 3.6937,-7 1.5427,-2.98545 5.189,-8.40286 8.1028,-12.03868 2.9138,-3.63582 5.2978,-7.03385 5.2978,-7.55116 0,-2.20818 8.2778,-13.43056 10.911,-14.79223 7.5226,-3.8901 20.3252,-22.64144 33.1943,-48.61808 7.422,-14.98162 10.0414,-22.40001 16.9233,-47.92794 2.2981,-8.525 4.8595,-17.68701 5.6918,-20.36003 2.1936,-7.04423 0.8946,-13.91229 -3.7144,-19.63997 -1.1064,-1.375 -3.5854,-6.96642 -5.5089,-12.42537 -4.0318,-11.44294 -4.3215,-16.29679 -1.9784,-33.15056 2.104,-15.13374 3.7603,-19.65104 8.7806,-23.94827 5.3581,-4.58634 7.9227,-5.15064 13.8014,-3.03671 4.366,1.57 5.2961,1.59363 10.104,0.25669 4.002,-1.11284 8.7504,-1.34713 19.4418,-0.95925 11.3684,0.41245 14.7068,0.21939 17,-0.98311 8.9655,-4.70139 13.0716,-7.12917 14.8608,-8.78658 1.104,-1.02269 3.804,-2.44724 6,-3.16566 2.9998,-0.98139 4.8204,-2.54904 7.3209,-6.30371 1.8305,-2.74861 3.9348,-5.13657 4.6762,-5.30659 1.9059,-0.43703 9.4956,4.54865 9.4956,6.23764 0,0.77188 -1.8647,2.88029 -4.1438,4.68535 -4.6987,3.72146 -7.5483,9.34994 -8.8818,17.54333 -1.5817,9.71843 -5.8324,17.22081 -13.544,23.90505 -9.0554,7.84894 -14.2851,13.30218 -16.1019,16.79022 -2.5083,4.81536 -4.3063,11.90621 -4.3177,17.02724 -0.01,2.68384 -0.983,8.4271 -2.1712,12.7628 -2.0682,7.54689 -2.0916,8.13032 -0.5486,13.68027 1.264,4.54641 1.4346,7.55446 0.7907,13.94198 -0.4516,4.47965 -0.5961,11.29055 -0.321,15.13535 0.3606,5.03905 0.055,8.10267 -1.0938,10.97435 -1.0254,2.56267 -1.7858,8.55734 -2.1317,16.80467 -0.4085,9.74176 -1.1378,14.74218 -3.0363,20.82087 -3.0266,9.69042 -3.0486,10.6169 -0.4307,18.09345 2.1208,6.05658 2.08,14.2564 -0.099,19.98865 -0.501,1.31757 -1.2039,5.25634 -1.5621,8.75281 -0.9001,8.78531 0.1561,9.00182 13.4962,2.76647 8.7194,-4.07554 27.3703,-11.90186 34.1943,-14.34864 1.4432,-0.51747 1.5504,1.77376 1.1124,23.7689 -0.2877,14.44431 -0.012,29.96013 0.6776,38.15997 1.6385,19.47823 3.0681,55.56106 3.6378,91.81839 0.8781,55.87556 0.9476,56.93516 4.3259,66 1.6399,4.4 4.4262,11.06849 6.1918,14.81887 2.667,5.66488 3.1074,7.56931 2.6025,11.2532 -1.0572,7.71291 -3.8184,11.70862 -10.5828,15.31397 -7.2238,3.85028 -25.3177,10.43374 -34.5789,12.58156 -8.8501,2.05247 -12.8538,1.86926 -19.9835,-0.91445 z"
                   id="path10"
                   inkscape:label="r13"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="1626.3456"
                   y="598.21234"
                   id="text38"
                   inkscape:label="numero13"><tspan
                     sodipodi:role="line"
                     id="tspan38"
                     x="1626.3456"
                     y="598.21234">13</tspan></text>
              </g>
              <g id="g56" inkscape:label="g14">
                <path
                   style="fill:#0772d2"
                   d="m 1808,709.3359 c -20.4535,-1.43032 -26.9738,-3.09986 -39.7744,-10.1844 -9.4938,-5.2544 -17.3682,-8.1515 -22.1561,-8.1515 -2.7068,0 -4.089,-0.52141 -4.6391,-1.75 -0.4309,-0.9625 -0.9114,-13.675 -1.0677,-28.25 -0.3693,-34.42834 -2.1878,-87.48562 -3.6503,-106.5 -0.6345,-8.25 -1.1889,-30.30907 -1.232,-49.02015 -0.043,-18.71109 -0.451,-34.62318 -0.9065,-35.36022 -0.5308,-0.85884 -1.9505,-1.15792 -3.9538,-0.83284 -3.7524,0.60893 -29.7861,10.75744 -37.8701,14.76258 -6.8094,3.37369 -6.698,3.63446 -4.0996,-9.59009 1.6119,-8.20343 1.6002,-8.55313 -0.5,-14.95059 -2.7323,-8.32321 -2.6987,-10.54632 0.2922,-19.33985 1.873,-5.50698 2.5873,-10.22379 3.0635,-20.22934 0.3414,-7.17634 1.2178,-14.73978 1.9474,-16.80766 1.8736,-5.31032 2.3203,-33.97232 0.6411,-41.13184 -1.1224,-4.78514 -1.0652,-6.34484 0.44,-12 0.9516,-3.575 2.0479,-9.92037 2.4363,-14.10081 0.877,-9.43818 3.7247,-15.55664 9.8496,-21.16228 2.5461,-2.3303 7.8785,-7.48344 11.8497,-11.45143 6.6065,-6.60113 7.4376,-7.90209 9.7751,-15.30162 1.4051,-4.44791 2.5547,-8.97833 2.5547,-10.0676 0,-3.98093 3.0781,-9.16223 8.4751,-14.2658 3.0387,-2.87353 5.5249,-5.98831 5.5249,-6.92175 0,-0.93344 -1.269,-3.11745 -2.8201,-4.85336 -2.7531,-3.08135 -5.2258,-4.59608 -32.1391,-19.68822 -12.8849,-7.22543 -13.0408,-7.35515 -13.0408,-10.85 0,-2.71546 -0.8208,-4.35792 -3.5333,-7.07046 -1.9434,-1.94334 -3.3025,-3.76417 -3.0204,-4.0463 0.2821,-0.28213 4.6846,0.86804 9.7833,2.55593 5.0987,1.6879 11.5204,3.37314 14.2704,3.745 6.1336,0.82938 6.6622,1.10796 14.8728,7.83806 5.1869,4.25162 8.0521,5.78859 13.3648,7.16929 9.1344,2.37393 18.1724,7.47652 24.3388,13.74097 11.8067,11.99437 14.313,21.50895 12.4447,47.24246 -0.7017,9.66563 -0.5276,12.16994 1.4238,20.48193 2.4015,10.22908 2.4597,8.1917 -1.1163,39.0873 -1.3472,11.63933 -0.088,18.41446 4.3642,23.48548 1.6177,1.84246 5.1611,8.50056 7.8742,14.79578 6.5925,15.29628 6.6424,18.98513 0.4399,32.51631 -2.4712,5.39112 -4.7694,11.18355 -5.1071,12.87206 -0.7356,3.67812 1.1088,9.84653 3.1822,10.64214 1.6863,0.64709 26.6789,-8.68709 51.918,-19.39021 9.35,-3.96504 18.125,-7.66666 19.5,-8.2258 2.0134,-0.81875 3.2502,-0.57281 6.3542,1.26343 4.5492,2.69117 7.6458,8.9289 7.6458,15.40162 0,3.56121 -0.6654,5.0322 -3.979,8.79663 -5.7545,6.53755 -6.1886,8.27779 -4.4826,17.97172 0.8024,4.55924 1.4595,13.21168 1.4602,19.22765 0,12.05529 -1.32,15.5484 -7.1957,19.01923 -6.5064,3.84342 -5.8472,6.98357 3.286,15.6546 5.1206,4.86142 5.9111,6.10253 5.9111,9.28014 0,2.01749 1.0983,6.27765 2.4407,9.46701 2.2858,5.43082 2.384,6.39675 1.5478,15.21987 -0.4911,5.18157 -1.5533,13.22229 -2.3604,17.86827 -1.415,8.14495 -1.3922,8.59228 0.6373,12.5 2.8895,5.56357 3.5541,19.67843 1.3289,28.22122 -1.1566,4.44017 -1.3323,6.8905 -0.627,8.74549 1.3404,3.52553 9.1783,8.27169 24.0327,14.55284 6.875,2.90707 14.1875,6.13794 16.25,7.17972 2.1805,1.10138 3.75,1.4424 3.75,0.8148 0,-0.59364 0.45,-0.80123 1,-0.46131 0.55,0.33992 1,2.66462 1,5.16601 0,3.63457 -0.3017,4.43221 -1.5021,3.97157 -0.8261,-0.31702 -8.694,-0.88387 -17.4842,-1.25967 -21.6075,-0.92377 -26.6902,0.34517 -34.2984,8.56287 -5.7982,6.2628 -7.7153,10.93491 -7.7153,18.80312 0,2.75652 -0.6976,6.68147 -1.5502,8.72211 -0.8527,2.04064 -2.0172,6.25809 -2.588,9.37212 -1.3822,7.54168 -4.2869,12.47045 -8.8658,15.04398 -3.4161,1.91992 -5.1577,2.10156 -18.6322,1.94318 -8.1751,-0.0961 -16.8888,-0.31631 -19.3638,-0.48939 z"
                   id="path12"
                   inkscape:label="r14"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="1796.0511"
                   y="537.40118"
                   id="text39"
                   inkscape:label="numero14"><tspan
                     sodipodi:role="line"
                     id="tspan39"
                     x="1796.0511"
                     y="537.40118">14</tspan></text>
              </g>
              <g id="g57" inkscape:label="g15">
                <path
                   style="fill:#0772d2"
                   d="m 1793.3177,436.42955 c 0.3187,-1.96375 2.5151,-7.45872 4.8809,-12.21105 3.9953,-8.02565 4.3014,-9.21273 4.3014,-16.67955 0,-7.27605 -0.4225,-9.03541 -4.4524,-18.53895 -2.4488,-5.775 -6.149,-12.6809 -8.2228,-15.34644 -4.7668,-6.1273 -5.3649,-9.46285 -3.9482,-22.02066 3.4869,-30.90742 3.432,-28.91903 1.0578,-38.37636 -1.9361,-7.7119 -2.1074,-10.12847 -1.4365,-20.25654 1.0679,-16.12183 0.7246,-22.45206 -1.6538,-30.5 -3.0422,-10.29343 -4.9913,-13.50445 -13.0583,-21.51262 -7.7969,-7.73993 -14.7982,-11.75194 -25.1885,-14.43388 -6.7744,-1.7486 -8.9263,-2.99876 -16.7752,-9.74576 -5.2303,-4.49592 -6.3342,-4.98972 -14,-6.26252 -4.5772,-0.75996 -10.3461,-2.11292 -12.82,-3.00658 -5.4852,-1.9815 -20.9348,-5.8651 -23.0021,-5.78208 -3.759,0.15095 -15.1225,-2.17077 -21.3096,-4.35384 -4.1985,-1.4814 -9.0406,-2.40272 -12.6279,-2.40272 -3.2,0 -7.4338,-0.675 -9.4083,-1.5 -1.9745,-0.825 -5.1074,-1.5 -6.9621,-1.5 -6.9385,0 -18.0973,-3.72752 -26.1976,-8.75111 -7.6374,-4.73657 -8.0247,-5.15432 -8.6704,-9.35345 -0.3717,-2.41749 -0.7092,-7.77045 -0.75,-11.89546 l -0.074,-7.50002 15.2552,-15.49998 c 21.0425,-21.38009 31.0567,-34.42685 39.2944,-51.193832 3.623,-7.374085 6.8449,-15.328329 7.1598,-17.676099 0.8484,-6.325735 2.7293,-7.126227 19.4936,-8.296636 17.5682,-1.226529 36.4394,-0.352633 48.0364,2.224491 12.6338,2.80751 15.2079,2.584282 24.0759,-2.087831 6.4472,-3.396709 8.8696,-4.114881 15.4169,-4.570593 9.3113,-0.648098 12.1672,0.713802 17.0937,8.151388 5.6782,8.57256 4.3809,11.568918 -8.8655,20.475783 -7.5508,5.077124 -10.9604,8.271993 -10.9604,10.270103 0,0.23553 1.35,2.126991 3,4.203246 2.4973,3.14241 3,4.68031 3,9.17734 0,6.31035 -2.674,12.33639 -6.6659,15.02169 -6.9192,4.65461 -11.0611,9.74271 -12.1723,14.95298 -1.7924,8.40498 -2.4643,20.57678 -1.3004,23.55711 1.3531,3.4646 6.2525,5.94198 18.1746,9.18992 14.2891,3.89277 20.3177,4.26077 26.964,1.64596 4.0184,-1.58092 9.4547,-2.45133 20.1807,-3.23115 l 14.6806,-1.06733 7.4827,2.72909 c 6.0522,2.20735 8.503,2.61557 12.8194,2.13528 2.9351,-0.32661 9.6901,-0.87364 15.0111,-1.21563 9.4372,-0.60656 9.8498,-0.54101 16.8222,2.67277 5.8053,2.67585 7.5097,4.00425 9.0755,7.07344 1.0603,2.07837 1.9278,5.06796 1.9278,6.64354 0,1.57558 1.125,6.17232 2.5,10.21499 3.0453,8.95359 3.072,10.3392 0.3506,18.20297 -1.9975,5.77182 -2.1032,7.43624 -1.4956,23.54211 l 0.6538,17.33117 -4.4545,4.76224 c -5.768,6.16645 -6.5018,9.56085 -6.5201,30.16151 -0.014,15.50035 0.1362,16.82409 2.4756,21.8493 3.2672,7.01843 3.1548,8.41943 -1.0098,12.58403 -1.925,1.925 -3.5,4.07361 -3.5,4.77468 0,0.70107 1.6875,3.72485 3.75,6.71951 3.6272,5.26657 3.7446,5.70884 3.5861,13.50866 -0.1879,9.24415 -1.676,13.3822 -9.4276,26.21531 -4.9125,8.13284 -8.4088,16.83694 -10.8125,26.91785 -1.1427,4.79229 -1.52,5.22418 -6.9024,7.90229 -5.9892,2.98001 -30.8313,13.27556 -40.1936,16.65783 -3.025,1.09282 -9.1485,3.53575 -13.6077,5.42874 -10.3127,4.37782 -10.8049,4.37154 -10.0746,-0.12865 z"
                   id="path16"
                   inkscape:label="r15"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="1831.4065"
                   y="241.83052"
                   id="text40"
                   inkscape:label="numero15"><tspan
                     sodipodi:role="line"
                     id="tspan40"
                     x="1831.4065"
                     y="241.83052">15</tspan></text>
              </g>
              <!-- Región 16 -->
              <g id="g58" inkscape:label="g16">
                <path
                   style="fill:#0772d2"
                   d="m 1078,752.91918 c -4.125,-1.63013 -14.1803,-5.23947 -22.3451,-8.02074 l -14.8452,-5.05687 -7.6548,1.67335 c -4.2102,0.92035 -10.3549,2.78113 -13.6549,4.13507 -8.2441,3.38245 -16.2681,4.09218 -21.90908,1.93788 -6.03707,-2.30557 -13.80136,-10.23862 -17.6275,-18.01061 -3.03452,-6.16399 -3.18421,-7.03795 -3.40709,-19.89316 -0.19334,-11.15155 -0.55931,-14.00297 -2.14472,-16.71048 -3.53576,-6.03821 -9.60791,-8.89512 -19.02206,-8.94976 -2.76281,-0.016 -5.38567,-0.8887 -8,-2.66172 -4.32273,-2.93165 -5.29763,-4.08762 -10.48872,-12.43692 -3.4136,-5.49041 -3.63453,-6.38034 -4.28503,-17.26101 -1.0249,-17.14295 -3.05578,-28.72346 -7.56971,-43.16421 -7.5525,-24.1616 -8.53326,-35.07298 -5.03354,-56 4.0676,-24.32273 3.75111,-36.68895 -1.0502,-41.03407 -1.07929,-0.97675 -1.95478,-2.26866 -1.94554,-2.87092 0.0186,-1.20975 14.09685,-8.2198 23.48319,-11.69307 3.3,-1.22112 7.62871,-3.2945 9.61937,-4.60751 1.99065,-1.31302 6.04065,-3.3039 9,-4.42419 2.95934,-1.12029 6.05563,-2.63973 6.88063,-3.37653 0.825,-0.73681 4.425,-3.06181 8,-5.16668 3.575,-2.10487 8.525,-5.31187 11,-7.12667 2.475,-1.81481 8.13488,-5.87112 12.5775,-9.01404 4.4426,-3.14291 10.2926,-7.61259 13,-9.93262 2.7074,-2.32002 7.2961,-6.24772 10.1972,-8.72822 2.901,-2.4805 7.0373,-5.40923 9.1916,-6.5083 2.1544,-1.09907 6.9327,-4.25255 10.6185,-7.00774 3.6858,-2.75519 7.2775,-5.00944 7.9816,-5.00944 0.7041,0 2.6343,-1.13946 4.2894,-2.53212 1.6551,-1.39267 6.0771,-3.91214 9.8267,-5.59881 3.7496,-1.68668 7.7175,-3.86488 8.8175,-4.84045 1.1,-0.97557 5.15,-3.00006 9,-4.49888 3.85,-1.49882 9.0644,-4.03116 11.5875,-5.62743 2.5232,-1.59627 4.9134,-2.90231 5.3117,-2.90231 0.6814,0 12.1159,-5.58553 17.6008,-8.59762 5.7996,-3.18489 10.4706,-1.68829 27.5,8.81099 2.9805,1.83757 6.8661,3.27121 9.6201,3.54941 4.2041,0.4247 4.9784,0.14301 8.5998,-3.12869 2.1888,-1.97747 4.3947,-5.04264 4.902,-6.81149 0.8688,-3.02912 1.735,-3.52832 14.9003,-8.58742 14.0643,-5.40461 49.8351,-17.23518 52.112,-17.23518 2.5996,0 4.3658,-3.17245 4.3658,-7.84186 0,-4.21752 -0.999,-6.28721 -9.75,-20.19923 -5.3625,-8.52513 -12.7875,-19.92481 -16.5,-25.33262 l -6.75,-9.8324 v -11.39694 c 0,-6.26832 0.2376,-11.39695 0.5279,-11.39695 0.9287,0 32.7639,7.01081 38.4721,8.4724 3.025,0.77455 7.6364,1.71106 10.2476,2.08112 l 4.7476,0.67285 -0.4812,9.63681 c -0.2646,5.30025 -0.7148,18.64743 -1.0003,29.66039 -0.4395,16.95009 -0.2841,20.35919 1.0123,22.21008 2.5953,3.70539 7.183,3.79978 17.218,0.35425 4.9464,-1.69835 9.2775,-3.0879 9.6247,-3.0879 0.3472,0 0.6313,9.45 0.6313,21 0,11.55 -0.2329,21 -0.5176,21 -0.2847,0 -8.9472,1.8142 -19.25,4.03155 -17.6795,3.80496 -18.8873,4.21244 -21.4875,7.25 -3.279,3.83052 -18.7449,34.16945 -18.7449,36.7713 0,3.67353 6.8564,3.64989 28,-0.0965 5.775,-1.02327 15.0449,-2.32022 20.5997,-2.88211 5.5548,-0.56189 10.7298,-1.25987 11.5,-1.55107 0.7702,-0.29119 5.8095,-1.13653 11.1986,-1.87852 l 9.7983,-1.34908 1.3497,3.23015 c 0.7423,1.77658 1.8064,3.51244 2.3647,3.85746 0.5582,0.34503 1.3188,2.42541 1.6901,4.62307 0.5744,3.40038 0.2894,4.45407 -1.9133,7.07183 -2.7913,3.31721 -3.1747,4.55042 -3.999,12.86179 -0.6777,6.83246 -3.2191,10.49202 -11.7948,16.98397 -6.451,4.88359 -13.1057,13.9545 -16.6733,22.7274 -1.9572,4.8128 -4.7237,6.76938 -15.8893,11.23776 -5.6477,2.26016 -11.9477,5.18232 -14,6.49368 -4.8444,3.09548 -18.2314,17.07089 -18.2314,19.03277 0,0.83324 -1.389,3.09696 -3.0867,5.0305 -1.6976,1.93354 -4.0601,4.86573 -5.25,6.51597 -1.1898,1.65025 -4.7521,6.27142 -7.9162,10.26928 -8.9209,11.27141 -15.6705,20.71032 -22.6528,31.67838 -3.5232,5.53427 -7.2817,10.85508 -8.3524,11.82402 -1.0707,0.96893 -2.6264,3.11276 -3.4573,4.76406 -0.8308,1.6513 -3.4267,5.92736 -5.7686,9.50236 -5.8318,8.9023 -16.5132,25.54171 -19.9001,31 -1.5358,2.475 -5.258,8.325 -8.2717,13 -3.0136,4.675 -7.2565,11.875 -9.4287,16 -4.7807,9.07895 -12.6475,22.19067 -18.5994,31 -2.4153,3.575 -9.8215,14.7125 -16.458,24.75 -6.6365,10.0375 -12.582,18.22369 -13.2123,18.19153 -0.6302,-0.0322 -4.5208,-1.39222 -8.6458,-3.02235 z"
                   id="path9"
                   sodipodi:nodetypes="sscsssssssssssssssssssssssssssssssssssssssssscsssscsssssssssssssscsssssssssssssssssssssssss"
                   inkscape:label="r16"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="1088.9445"
                   y="561.44275"
                   id="text35"
                   inkscape:label="numero16"><tspan
                     sodipodi:role="line"
                     id="tspan35"
                     x="1088.9445"
                     y="561.44275">16</tspan></text>
              </g>
              <!-- Región 17 -->
              <g id="g59" inkscape:label="g17">
                <path
                   style="fill:#0772d2"
                   d="m 1511.0272,509.75 c 0.058,-10.75779 2.6614,-31.27139 5.1724,-40.75 3.1701,-11.96685 4.5486,-21.18121 6.2833,-42 0.9412,-11.296 2.3304,-21.60359 3.3019,-24.5 1.7685,-5.27218 2.1589,-22.26387 0.6844,-29.7843 -0.5391,-2.74935 -0.2596,-4.85414 1.022,-7.69622 1.0566,-2.34313 1.4638,-4.6353 1.0154,-5.7157 -0.4118,-0.99208 -1.0938,-7.60692 -1.5157,-14.69965 -0.621,-10.44238 -0.4847,-13.57131 0.7164,-16.44608 1.2394,-2.96636 1.2752,-4.18091 0.2177,-7.3853 -1.0849,-3.2872 -1.0271,-4.33551 0.4047,-7.33785 0.9186,-1.92651 1.6703,-4.62213 1.6703,-5.99027 0,-1.36813 1.1204,-4.18057 2.4898,-6.24987 1.3694,-2.0693 2.8854,-5.87999 3.369,-8.46821 1.0788,-5.77484 2.2431,-7.23775 8.1371,-10.22447 5.4313,-2.75226 16.6187,-10.06941 17.4487,-11.41242 0.3174,-0.51361 3.6097,-1.93513 7.3163,-3.15895 3.7065,-1.22381 8.6886,-3.55593 11.0712,-5.18247 2.3827,-1.62655 6.8779,-3.85211 9.9894,-4.94569 7.319,-2.57244 8.4581,-3.20611 15.971,-8.88485 7.3826,-5.58022 11.8091,-6.67748 18.0499,-4.47424 4.112,1.45168 4.8816,1.39514 14.5,-1.06515 5.5867,-1.42901 13.9826,-3.17327 18.6576,-3.87614 4.675,-0.70286 11.2,-2.40635 14.5,-3.78553 5.9068,-2.46865 18.7748,-6.71664 20.3459,-6.71664 0.9233,0 19.5616,10.31173 25.9041,14.3315 2.3375,1.48148 4.25,3.11796 4.25,3.63664 0,2.46412 -5.3653,8.51529 -8.5082,9.59575 -1.8911,0.65016 -5.0411,2.58925 -6.9999,4.3091 -1.9588,1.71986 -4.1334,3.12701 -4.8324,3.12701 -0.699,0 -2.8209,1.15302 -4.7152,2.56228 -3.3878,2.52026 -3.6984,2.55835 -18.9443,2.32279 -10.5437,-0.1629 -16.8196,0.17575 -19.6267,1.05906 -3.56,1.12024 -4.8298,1.06496 -9.2483,-0.40261 -6.2721,-2.08325 -8.9434,-1.53556 -16.125,3.30603 -4.6513,3.13574 -5.8678,4.62956 -7.8832,9.68019 -3.222,8.0745 -6.3989,28.97083 -5.8489,38.47226 0.5259,9.08627 4.4006,20.93623 9.829,30.06011 4.7367,7.96112 4.8648,10.65736 1.0164,21.38955 -1.5877,4.42769 -3.3822,10.75034 -3.9879,14.05034 -2.8282,15.41088 -8.1113,30.49411 -16.6654,47.57992 -10.0806,20.13474 -13.8121,26.3826 -21.9611,36.77034 -5.4349,6.92799 -6.567,7.84019 -12,9.66835 -9.379,3.15601 -17.4499,7.69848 -38.9989,21.9496 C 1517.1069,515.29356 1512.7605,518 1511.5572,518 c -0.3158,0 -0.5543,-3.7125 -0.53,-8.25 z"
                   id="path14"
                   inkscape:label="r17"
                   class="region-path" />
                <text
                   xml:space="preserve"
                   style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:48px;font-family:Century;-inkscape-font-specification:Century;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#ffffff;pointer-events:none"
                   x="1572.6056"
                   y="373.35239"
                   id="text43"
                   inkscape:label="numero17"><tspan
                     sodipodi:role="line"
                     id="tspan43"
                     x="1572.6056"
                     y="373.35239">17</tspan></text>
              </g>
            </g>
          </svg>
        </div>
      </section>
    </div>
  </main>

  <!-- ======= ÚLTIMOS EVENTOS ======= -->
  <section class="events-section" id="eventos">
    <div class="events__inner">
      <div class="events__header">
        <div class="events__icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14,2 14,8 20,8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10,9 9,9 8,9"></polyline>
          </svg>
        </div>
        <h2 class="events__title">ÚLTIMOS EVENTOS</h2>
      </div>

      <div class="events__container">
        <div class="events__carousel" id="eventsCarousel">
          <!-- Los eventos se cargarán dinámicamente aquí -->
          <div class="event-card active" style="display: flex; align-items: center; justify-content: center; min-height: 300px;">
            <div style="text-align: center; padding: 2rem; color: #b8c5d1;">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin: 0 auto 1rem; animation: spin 1s linear infinite;">
                <circle cx="12" cy="12" r="10" stroke-opacity="0.25"></circle>
                <path d="M12 2 A10 10 0 0 1 22 12" stroke-linecap="round"></path>
              </svg>
              <p>Cargando eventos...</p>
            </div>
          </div>
        </div>

        <!-- Indicadores -->
        <div class="events__indicators">
          <!-- Los indicadores se generarán dinámicamente -->
        </div>
      </div>
    </div>
  </section>

  <!-- ======= CALENDARIO DE ACTIVIDADES ======= -->
  {% if user.is_authenticated %}
  <section class="calendar-section" id="calendario" style="margin-top: 40px;">
    <div class="calendar__inner">
      <div class="calendar__header">
        <div class="calendar__title">
          <h2>Calendario de actividades</h2>
          <p class="calendar__subtitle">Consulta eventos, avances y finalizaciones</p>
        </div>
        <div class="calendar__nav">
          <button class="cal-add-btn" id="calAddReminderTop">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            Añadir recordatorio
          </button>
          <button class="cal-btn" id="calPrev" aria-label="Mes anterior">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
          </button>
          <div class="calendar__current" id="calCurrent"></div>
          <button class="cal-btn" id="calNext" aria-label="Mes siguiente">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
          </button>
        </div>
      </div>

      <div class="calendar" id="calendar">
        <div class="calendar__weekdays" id="calWeekdays"></div>
        <div class="calendar__grid" id="calGrid" role="grid" aria-label="Calendario"></div>
      </div>
    </div>
  </section>
  {% endif %}
  
  <!-- Modal de recordatorio -->
  <div class="reminder-modal" id="reminderModal" aria-hidden="true">
    <div class="reminder__panel" role="dialog" aria-modal="true">
      <div class="reminder__header">
        <h3 class="reminder__title" id="reminderModalTitle">Añadir recordatorio</h3>
        <button class="reminder__close" id="reminderModalClose" aria-label="Cerrar">×</button>
      </div>
      <div class="reminder__body">
        <div class="form-row two">
          <div>
            <label class="form-label">Fecha</label>
            <input type="date" id="reminderDate" class="form-input">
          </div>
          <div>
            <label class="form-label">Hora</label>
            <input type="time" id="reminderTime" class="form-input" step="60">
          </div>
        </div>
        <div class="form-row">
          <label class="form-label">Elegir evento</label>
          <select id="reminderEventSelect" class="form-select"></select>
        </div>
        <div class="form-row">
          <label class="form-label">Descripción del recordatorio <span style="color:#ff5d5d">*</span></label>
          <textarea id="reminderDescription" class="form-textarea" placeholder="Notas del recordatorio..."></textarea>
          <div id="reminderDescriptionError" style="display:none;color:#ff5d5d;font-size:0.85rem;margin-top:5px;">Este campo es obligatorio</div>
        </div>
        <div class="form-row">
          <label class="form-label">Personal involucrado <span style="color:#ff5d5d">*</span></label>
          <div class="collaborators-checklist" id="reminderOwnersChecklist">
            <!-- Los checkboxes se generarán dinámicamente aquí -->
          </div>
          <div id="reminderOwnersError" style="display:none;color:#ff5d5d;font-size:0.85rem;margin-top:5px;">Este campo es obligatorio</div>
        </div>
        <div class="form-actions">
          <button class="btn-secondary" id="reminderCancelBtn">Cancelar</button>
          <button class="btn-primary" id="reminderSaveBtn">Guardar recordatorio</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
<!-- Script para carga de eventos dinámicos -->
<script src="{% static 'js/index.js' %}?v=3"></script>

<script>

  /* ========== INTERACTIVE MAP ========== */
  // ====== Tooltip de regiones (como en mapa-completo) ======
  const regionNames = {
    1: "BARRIO EL CENTRO", 2: "ALDEA MOCOHÁN", 3: "CASERÍO LOS PINOS", 4: "ALDEA EBEN-EZER",
    5: "CASERÍO SUQUINAY II", 6: "CASERÍO SAN LUIS PANZAL", 7: "ALDEA PANIMÁ", 8: "CASERÍO CENTRO PANCHISIVIC",
    9: "ALDEA CHANTEL CHICOY", 10: "ALDEA RIBACÓ", 11: "SAN MARCOS SACSAMANÍ", 12: "ALDEA SACSAMANÍ",
    13: "ALDEA LA PINADA", 14: "CASERÍO CENTRO HELVETIA", 15: "ALDEA MATANZAS", 16: "CASERÍO NUEVO AMANECER PANCOC", 17: "CASERÍO SIERRA LINDA"
  };

  let currentTooltip = null;

  const CALENDAR_DEBUG_ENABLED = (() => {
    try {
      return Boolean(window && window.localStorage && window.localStorage.getItem('WEBMAGA_DEBUG'));
    } catch (err) {
      return false;
    }
  })();
  const calendarDebugLog = (...args) => { if (CALENDAR_DEBUG_ENABLED) console.log(...args); };
  const calendarDebugWarn = (...args) => { if (CALENDAR_DEBUG_ENABLED) console.warn(...args); };
  function createTooltip(){
    if(currentTooltip) return currentTooltip;
    const t = document.createElement('div');
    t.className = 'region-tooltip';
    document.body.appendChild(t);
    currentTooltip = t; return t;
  }
  function showTooltip(regionNumber, event){
    const tooltip = createTooltip();
    const txt = regionNames[regionNumber];
    if(!txt) return;
    tooltip.textContent = txt; tooltip.classList.add('visible');
    const rect = event.target.getBoundingClientRect();
    const tt = tooltip.getBoundingClientRect();
    let left = rect.left + rect.width/2 - tt.width/2;
    let top = rect.top - tt.height - 12;
    if(left < 10) left = 10;
    if(left + tt.width > window.innerWidth - 10) left = window.innerWidth - tt.width - 10;
    if(top < 10) top = rect.bottom + 12;
    tooltip.style.left = left + 'px';
    tooltip.style.top = top + 'px';
  }
  function hideTooltip(){ if(currentTooltip){ currentTooltip.classList.remove('visible'); } }

  // Seleccionar grupos de regiones del SVG (por inkscape:label="gN")
  const regionGroups = () => {
    const svgRoot = document.querySelector('.map-svg');
    if(!svgRoot) return [];
    const byInkscape = Array.from(svgRoot.querySelectorAll('g[inkscape\\:label]')).filter(g=>/^g\d+$/i.test(g.getAttribute('inkscape:label')));
    const byClass = Array.from(svgRoot.querySelectorAll('g.region-group'));
    return Array.from(new Set([...byInkscape, ...byClass]));
  };

  // Mantener compatibilidad con handlers existentes
  const regionPaths = document.querySelectorAll('.region-path');
  
  // Función para manejar el hover en las regiones
  const handleRegionHover = (event) => {
    const path = event.target;
    // Buscar el grupo padre para obtener inkscape:label (gN)
    const group = path.closest('g[inkscape\\:label]');
    const label = group ? group.getAttribute('inkscape:label') : null;
    let regionNumber = null;
    if (label && /^g\d+$/i.test(label)) {
      regionNumber = parseInt(label.slice(1), 10);
    } else {
      const rLabel = path.getAttribute('inkscape:label');
      if (rLabel && /^r\d+$/i.test(rLabel)) {
        regionNumber = parseInt(rLabel.slice(1), 10);
      } else if (path.dataset.region) {
        regionNumber = parseInt(path.dataset.region, 10);
      }
    }
    
    // Agregar efecto visual adicional si es necesario
    path.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
    if(regionNumber){ showTooltip(regionNumber, event); }
    
    calendarDebugLog(`Hovering over region: ${regionNumber}`);
  };

  const handleRegionLeave = (event) => {
    const path = event.target;
    // El CSS ya maneja la transición de vuelta al estado normal
  };

  const handleRegionClick = (event) => {
    const path = event.target;
    // Determinar número de región desde el grupo padre o el propio path
    let regionNumber = null;
    const group = path.closest('g[inkscape\\:label]');
    const label = group ? group.getAttribute('inkscape:label') : null;
    if (label && /^g\d+$/i.test(label)) {
      regionNumber = parseInt(label.slice(1), 10);
    } else {
      const rLabel = path.getAttribute('inkscape:label');
      if (rLabel && /^r\d+$/i.test(rLabel)) {
        regionNumber = parseInt(rLabel.slice(1), 10);
      }
    }
    
    // Redirigir a la página del mapa completo
    const mapaUrl = window.DJANGO_URLS?.mapaCompleto || "{% url 'webmaga:mapa-completo' %}";
    if (regionNumber) {
      window.location.href = `${mapaUrl}?region=${regionNumber}`;
    } else {
      window.location.href = mapaUrl;
    }
    
    calendarDebugLog(`Redirigiendo al mapa completo desde región: ${regionNumber}`);
  };

  // Agregar event listeners a paths y grupos
  regionPaths.forEach(path => {
    path.addEventListener('mouseenter', handleRegionHover);
    path.addEventListener('mousemove', handleRegionHover);
    path.addEventListener('mouseleave', (e)=>{ hideTooltip(); handleRegionLeave(e); });
    path.addEventListener('click', handleRegionClick);
    path.style.cursor = 'pointer';
  });
  regionGroups().forEach(g=>{
    g.addEventListener('mouseenter', (e)=>{
      const label = g.getAttribute('inkscape:label');
      const num = parseInt(label.slice(1),10);
      showTooltip(num, e);
    });
    g.addEventListener('mousemove', (e)=>{
      const label = g.getAttribute('inkscape:label');
      const num = parseInt(label.slice(1),10);
      showTooltip(num, e);
    });
    g.addEventListener('mouseleave', hideTooltip);
  });

  // Función para inicializar el mapa interactivo
  const initializeInteractiveMap = () => {
    const mapContainer = document.querySelector('.interactive-map');
    const svg = document.querySelector('.map-svg');
    
    if (mapContainer && svg) {
      // Asegurar que el SVG sea responsive
      const makeResponsive = () => {
        const containerWidth = mapContainer.offsetWidth;
        const svgWidth = 1920; // Ancho original del SVG
        const svgHeight = 1080; // Alto original del SVG
        
        // Mantener la proporción
        const scale = containerWidth / svgWidth;
        const newHeight = svgHeight * scale;
        
        svg.style.width = '100%';
        svg.style.height = `${newHeight}px`;
      };

      // Aplicar responsive al cargar y al redimensionar
      makeResponsive();
      window.addEventListener('resize', makeResponsive);
    }
  };

  // Inicializar el mapa cuando el DOM esté listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeInteractiveMap);
  } else {
    initializeInteractiveMap();
  }

  // Ocultar tooltip al hacer scroll o resize
  window.addEventListener('scroll', hideTooltip);
  window.addEventListener('resize', hideTooltip);

  /* ================= CALENDARIO DE ACTIVIDADES ================ */
  // Verificar si el usuario está autenticado antes de inicializar el calendario
  var isUserAuthenticated = {% if user.is_authenticated %}true{% else %}false{% endif %};
  
  // Cargar información del usuario actual
  var CURRENT_USER = null;
  var USER_API = (window.DJANGO_URLS && window.DJANGO_URLS.usuario) || '/api/usuario/';
  
  async function loadCurrentUser() {
    try {
      const res = await fetch(USER_API);
      if (res.ok) {
        const userData = await res.json();
        CURRENT_USER = {
          userId: userData.userId,
          username: userData.username,
          email: userData.email,
          rol: userData.rol,
          collaboratorId: userData.collaboratorId,
          collaboratorName: userData.collaboratorName,
          isAdmin: userData.isAdmin
        };
        window.CURRENT_USER = CURRENT_USER;
        calendarDebugLog('✅ Usuario actual cargado:', CURRENT_USER);
      } else {
        console.warn('⚠️ No se pudo cargar información del usuario');
      }
    } catch (e) {
      console.error('❌ Error al cargar usuario:', e);
    }
  }
  
  // API para eventos del calendario (tabla: actividades)
  var CAL_API = (window.DJANGO_URLS && window.DJANGO_URLS.calendarEvents) || '/api/calendar-events/';
  // API para lista de eventos
  var EVENTS_LIST_API = (window.DJANGO_URLS && window.DJANGO_URLS.eventsList) || '/api/events-list/';
  // API para avances de eventos (SOLO tabla: eventos_cambios_colaboradores)
  // Esta API consulta exclusivamente la tabla eventos_cambios_colaboradores
  var AVANCES_API = (window.DJANGO_URLS && window.DJANGO_URLS.avances) || '/api/avances/';
  var calWeekdays = ['Lun','Mar','Mié','Jue','Vie','Sáb','Dom'];
  var calWeekdaysContainer = document.getElementById('calWeekdays');
  var calGrid = document.getElementById('calGrid');
  var calCurrent = document.getElementById('calCurrent');
  var calPrev = document.getElementById('calPrev');
  var calNext = document.getElementById('calNext');
  
  // Si no está autenticado, ocultar el calendario
  if (!isUserAuthenticated) {
    var calendarSection = document.getElementById('calendario');
    if (calendarSection) {
      calendarSection.style.display = 'none';
    }
  }

  // Modal elementos (detalle del día)
  const modal = document.createElement('div');
  modal.className = 'cal-modal';
  modal.innerHTML = `
    <div class="cal-modal__panel" role="dialog" aria-modal="true">
      <div class="cal-modal__header">
        <h3 class="cal-modal__title" id="calModalTitle">Eventos del día</h3>
        <div style="display:flex;align-items:center;gap:8px">
          <button class="cal-add-btn" id="calAddReminderDay">Añadir recordatorio</button>
          <button class="cal-modal__close" id="calModalClose" aria-label="Cerrar">×</button>
        </div>
      </div>
      <div class="cal-modal__body" id="calModalBody"></div>
    </div>`;
  document.body.appendChild(modal);
  const calModalClose = modal.querySelector('#calModalClose');
  const calModalBody = modal.querySelector('#calModalBody');
  const calModalTitle = modal.querySelector('#calModalTitle');

  function openCalModal(dateLabel, events, avances = null){
    calendarDebugLog('🔵 Abriendo modal del día:', dateLabel, 'con eventos:', events?.length || 0, 'y avances:', avances?.length || 0);
    calModalTitle.textContent = `Eventos — ${dateLabel}`;
    
    // Limpiar contenido anterior COMPLETAMENTE
    calModalBody.innerHTML = '';
    
    // Preparar contenedor para eventos, avances y recordatorios
    let eventsSection = null;
    let avancesSection = null;
    let remindersSection = null;
    
    // Mostrar eventos primero (síncrono)
    if(events && events.length > 0){
      eventsSection = document.createElement('div');
      eventsSection.className = 'modal-section';
      const eventsHeader = document.createElement('h4');
      eventsHeader.textContent = 'Eventos';
      eventsHeader.style.cssText = 'margin:0 0 10px 0;color:#eef5ff;font-weight:800;font-size:1rem';
      eventsSection.appendChild(eventsHeader);
      
      events.forEach(ev => {
          const card = document.createElement('div');
          card.className = 'event-card';
        card.setAttribute('data-item-type', 'event');
        // Asegurar que la tarjeta sea visible y no afectada por estilos del carrusel
        card.style.position = 'relative';
        card.style.width = '100%';
        card.style.maxWidth = '100%';
        card.style.height = 'auto';
        card.style.opacity = '1';
        card.style.transform = 'none';
        card.style.zIndex = 'auto';
        card.style.display = 'block';
        card.style.marginLeft = '0';
        card.style.marginRight = '0';
        card.style.boxSizing = 'border-box';
        card.style.overflowWrap = 'break-word';
        card.style.wordWrap = 'break-word';
          card.innerHTML = `
          <h4 class="event-card__title">${ev.name || 'Evento'}</h4>
          <div class="event-card__meta">${ev.date || ''} ${ev.status ? '· ' + ev.status : ''}</div>
          <div class="event-card__desc">${ev.description || ''}</div>
          ${ev.owners ? `<div class="event-card__meta" style="margin-top:6px">Encargados: ${ev.owners}</div>` : ''}
        `;
        eventsSection.appendChild(card);
        calendarDebugLog(`✅ Evento agregado: ${ev.name || 'Evento'}`);
      });
      
      calModalBody.appendChild(eventsSection);
      calendarDebugLog(`✅ ${events.length} eventos agregados al modal`);
    }
    
    // Mostrar avances si se proporcionaron (SOLO de eventos_cambios_colaboradores)
    if(avances && avances.length > 0){
      // Eliminar duplicados por ID primero
      const avancesSinDuplicados = eliminarDuplicadosAvances(avances);
      
      // Filtrar solo avances válidos de eventos_cambios_colaboradores
      const avancesValidos = avancesSinDuplicados.filter(av => {
        // Debe tener descripcion_cambio (descripcion) y fecha_cambio (fecha) de eventos_cambios_colaboradores
        return (av.descripcion || av.descripcion_cambio) && (av.fecha || av.fecha_cambio);
      });
      
      if(avancesValidos.length > 0){
      avancesSection = document.createElement('div');
      avancesSection.className = 'modal-section';
      const avancesHeader = document.createElement('h4');
      avancesHeader.textContent = 'Avances';
      avancesHeader.style.cssText = 'margin:0 0 10px 0;color:#eef5ff;font-weight:800;font-size:1rem';
      avancesSection.appendChild(avancesHeader);
      
        avancesValidos.forEach(av => {
        const card = document.createElement('div');
        card.className = 'event-card';
        card.setAttribute('data-item-type', 'avance');
        card.style.position = 'relative';
        card.style.width = '100%';
        card.style.maxWidth = '100%';
        card.style.height = 'auto';
        card.style.opacity = '1';
        card.style.transform = 'none';
        card.style.zIndex = 'auto';
        card.style.display = 'block';
        card.style.marginLeft = '0';
        card.style.marginRight = '0';
        card.style.boxSizing = 'border-box';
        card.style.overflowWrap = 'break-word';
        card.style.wordWrap = 'break-word';
        card.style.borderLeft = '3px solid #ffc107';
          
              // Asegurar que los campos estén correctamente mapeados desde eventos_cambios_colaboradores
              const eventoNombre = av.evento_nombre || 'Sin evento';
              const fecha = av.fecha || (av.fecha_cambio ? av.fecha_cambio.split('T')[0] : '');
              const hora = av.hora || (av.fecha_cambio ? av.fecha_cambio.split('T')[1]?.split(':').slice(0,2).join(':') : '');
              const descripcion = av.descripcion || av.descripcion_cambio || '';
              const responsable = av.responsable || 'Sistema';
              
        card.innerHTML = `
            <h4 class="event-card__title">${eventoNombre}</h4>
            <div class="event-card__meta">${fecha}${hora ? ' · ' + hora : ''}</div>
            <div class="event-card__desc">${descripcion}</div>
            ${responsable ? `<div class="event-card__meta" style="margin-top:6px">Responsable: ${responsable}</div>` : ''}
        `;
        avancesSection.appendChild(card);
          calendarDebugLog(`✅ Avance de eventos_cambios_colaboradores agregado: ${eventoNombre}`);
      });
      
      if(eventsSection){
        avancesSection.style.marginTop = '20px';
      }
      calModalBody.appendChild(avancesSection);
        calendarDebugLog(`✅ ${avancesValidos.length} avances de eventos_cambios_colaboradores agregados al modal`);
      }
    }
    
    // Cargar avances del día si no se proporcionaron (SOLO de eventos_cambios_colaboradores)
    if(!avances){
      fetchDayAvances(dateLabel).then(avancesData => {
        if(avancesData && avancesData.length > 0){
          const dateISO = parseLabelToISO(dateLabel);
          
          // Eliminar duplicados por ID primero
          const avancesSinDuplicados = eliminarDuplicadosAvances(avancesData);
          
          // Filtrar solo avances válidos de eventos_cambios_colaboradores
          const dayAvances = avancesSinDuplicados.filter(av => {
            // Debe tener fecha y descripción (campos obligatorios de eventos_cambios_colaboradores)
            if(!av.fecha && !av.fecha_cambio) return false;
            if(!av.descripcion && !av.descripcion_cambio) return false;
            
            // Verificar que la fecha coincida con el día
            const avanceDate = (av.fecha || av.fecha_cambio || '').split('T')[0];
            return avanceDate === dateISO;
          });
          
          if(dayAvances.length > 0){
            if(!avancesSection){
              avancesSection = document.createElement('div');
              avancesSection.className = 'modal-section';
              const avancesHeader = document.createElement('h4');
              avancesHeader.textContent = 'Avances';
              avancesHeader.style.cssText = 'margin:0 0 10px 0;color:#eef5ff;font-weight:800;font-size:1rem';
              avancesSection.appendChild(avancesHeader);
              
              if(eventsSection){
                avancesSection.style.marginTop = '20px';
              }
              calModalBody.appendChild(avancesSection);
            }
            
            dayAvances.forEach(av => {
      const card = document.createElement('div');
      card.className = 'event-card';
              card.setAttribute('data-item-type', 'avance');
              card.style.position = 'relative';
              card.style.width = '100%';
              card.style.height = 'auto';
              card.style.opacity = '1';
              card.style.transform = 'none';
              card.style.zIndex = 'auto';
              card.style.display = 'block';
              card.style.borderLeft = '3px solid #ffc107';
              
              // Asegurar que los campos estén correctamente mapeados desde eventos_cambios_colaboradores
              const eventoNombre = av.evento_nombre || 'Sin evento';
              const fecha = av.fecha || (av.fecha_cambio ? av.fecha_cambio.split('T')[0] : '');
              const hora = av.hora || (av.fecha_cambio ? av.fecha_cambio.split('T')[1]?.split(':').slice(0,2).join(':') : '');
              const descripcion = av.descripcion || av.descripcion_cambio || '';
              const responsable = av.responsable || 'Sistema';
              
      card.innerHTML = `
                <h4 class="event-card__title">${eventoNombre}</h4>
                <div class="event-card__meta">${fecha}${hora ? ' · ' + hora : ''}</div>
                <div class="event-card__desc">${descripcion}</div>
                ${responsable ? `<div class="event-card__meta" style="margin-top:6px">Responsable: ${responsable}</div>` : ''}
              `;
              avancesSection.appendChild(card);
              calendarDebugLog(`✅ Avance de eventos_cambios_colaboradores agregado al modal: ${eventoNombre}`);
            });
          }
        }
      }).catch(error => {
        console.error('❌ Error al cargar avances de eventos_cambios_colaboradores:', error);
      });
    }
    
    // Cargar y mostrar recordatorios (asíncrono)
    fetchDayReminders(dateLabel).then(reminders => {
    calendarDebugLog('📋 Recordatorios recibidos en openCalModal:', reminders);
      
      if(reminders && reminders.length > 0){
        calendarDebugLog(`📝 Procesando ${reminders.length} recordatorios para mostrar`);
        
        // Filtrar recordatorios que coincidan con la fecha del día seleccionado
        const dateISO = parseLabelToISO(dateLabel);
        calendarDebugLog(`🔍 Filtrando recordatorios para fecha: ${dateISO}`);
        
        // Filtrar recordatorios que pertenezcan al día seleccionado
        const dayReminders = reminders.filter(r => {
          if(!r.date){
            return false;
          }
          // Comparar fechas sin considerar hora
          const reminderDate = r.date.split('T')[0];
          const isMatch = reminderDate === dateISO;
          if(!isMatch){
            calendarDebugLog(`⚠️ Recordatorio filtrado: fecha ${reminderDate} no coincide con ${dateISO}`);
          }
          return isMatch;
        });
        
        calendarDebugLog(`✅ ${dayReminders.length} recordatorios después del filtro de fecha (de ${reminders.length} totales)`);
        
        if(dayReminders.length === 0){
          calendarDebugLog('⚠️ No hay recordatorios para este día después del filtro');
          if(calModalBody.children.length === 0){
            const noContentMsg = document.createElement('p');
            noContentMsg.style.cssText = 'color:#a8b2c2;text-align:center;padding:20px;font-style:italic';
            noContentMsg.textContent = 'Sin eventos ni recordatorios para este día.';
            calModalBody.appendChild(noContentMsg);
          }
          return;
        }
        
        // Crear sección de recordatorios solo si hay recordatorios
        remindersSection = document.createElement('div');
        remindersSection.className = 'modal-section';
        const remindersHeader = document.createElement('h4');
        remindersHeader.textContent = 'Recordatorios';
        remindersHeader.style.cssText = 'margin:0 0 10px 0;color:#eef5ff;font-weight:800;font-size:1rem';
        
        // Agregar header de recordatorios siempre que haya recordatorios
        remindersSection.appendChild(remindersHeader);
        
        // Agregar sección de recordatorios al modal (después de eventos o avances si existen)
        if(eventsSection || avancesSection){
          remindersSection.style.marginTop = '20px';
        }
        calModalBody.appendChild(remindersSection);
        
        // Forzar reflow para asegurar que el header se muestre
        remindersHeader.offsetHeight;
        
        // Separar recordatorios pasados y futuros
        const now = new Date();
        const remindersPassed = [];
        const remindersFuture = [];
        
        dayReminders.forEach(r => {
          // Verificar si el recordatorio ya pasó
          if(r.date && r.time){
            const reminderDateTime = new Date(`${r.date}T${r.time || '00:00'}`);
            if(reminderDateTime < now){
              remindersPassed.push(r);
            } else {
              remindersFuture.push(r);
            }
          } else {
            // Si no tiene hora, considerar como futuro
            remindersFuture.push(r);
          }
        });
        
        // Mostrar recordatorios futuros primero
        if(remindersFuture.length > 0){
          calendarDebugLog(`✅ Renderizando ${remindersFuture.length} recordatorios futuros`);
          remindersFuture.forEach((r, index) => {
            calendarDebugLog(`🎯 Renderizando recordatorio FUTURO ${index + 1}/${remindersFuture.length}:`, r);
            try{
              const card = createReminderCard(r, dateLabel, false);
              if(card){
                if(remindersSection){
                  remindersSection.appendChild(card);
                } else {
      calModalBody.appendChild(card);
                }
                // Forzar reflow para asegurar renderizado
                card.offsetHeight;
                calendarDebugLog(`✅ Recordatorio futuro ${index + 1} agregado al DOM`);
              } else {
                calendarDebugWarn(`⚠️ createReminderCard retornó null para recordatorio:`, r);
              }
            }catch(e){
              console.error(`❌ Error al renderizar recordatorio futuro:`, e, r);
            }
          });
        }
        
        // Luego mostrar recordatorios pasados
        if(remindersPassed.length > 0){
          calendarDebugLog(`✅ Renderizando ${remindersPassed.length} recordatorios pasados`);
          
          if(remindersFuture.length > 0){
            const divider = document.createElement('div');
            divider.style.cssText = 'margin:12px 0;padding-top:12px;border-top:1px solid #ffffff1a';
            divider.innerHTML = '<p style="color:#a8b2c2;font-size:0.85rem;margin:0;font-weight:700">Recordatorios pasados</p>';
            if(remindersSection){
              remindersSection.appendChild(divider);
            } else {
              calModalBody.appendChild(divider);
            }
          }
          
          remindersPassed.forEach((r, index) => {
            calendarDebugLog(`🎯 Renderizando recordatorio PASADO ${index + 1}/${remindersPassed.length}:`, r);
            try{
              const card = createReminderCard(r, dateLabel, true);
              if(card){
                if(remindersSection){
                  remindersSection.appendChild(card);
                } else {
                  calModalBody.appendChild(card);
                }
                // Forzar reflow para asegurar renderizado
                card.offsetHeight;
                calendarDebugLog(`✅ Recordatorio pasado ${index + 1} agregado al DOM`);
              } else {
                calendarDebugWarn(`⚠️ createReminderCard retornó null para recordatorio:`, r);
              }
            }catch(e){
              console.error(`❌ Error al renderizar recordatorio pasado:`, e, r);
            }
          });
        }
        
        calendarDebugLog(`✅ Total de recordatorios agregados al modal: ${remindersFuture.length + remindersPassed.length}`);
        
        // Forzar reflow completo del modal
        calModalBody.offsetHeight;
        
        // Verificar que los elementos estén en el DOM
        const reminderCards = calModalBody.querySelectorAll('.event-card[data-reminder-id]');
        const eventCards = calModalBody.querySelectorAll('.event-card[data-item-type="event"]');
        const avanceCards = calModalBody.querySelectorAll('.event-card[data-item-type="avance"]');
        calendarDebugLog(`✅ Verificación: ${eventCards.length} eventos, ${avanceCards.length} avances y ${reminderCards.length} recordatorios en el DOM`);
        
        // Scroll al inicio de los recordatorios si hay muchos
        if(remindersFuture.length > 0 && remindersHeader){
          setTimeout(() => {
            remindersHeader.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          }, 150);
        }
      } else {
        calendarDebugLog('⚠️ No hay recordatorios para mostrar');
        // Si no hay recordatorios ni eventos, mostrar mensaje
        if(calModalBody.children.length === 0){
          const noContentMsg = document.createElement('p');
          noContentMsg.style.cssText = 'color:#a8b2c2;text-align:center;padding:20px;font-style:italic';
          noContentMsg.textContent = 'Sin eventos ni recordatorios para este día.';
          calModalBody.appendChild(noContentMsg);
        }
      }
    }).catch(error => {
      console.error('❌ Error al cargar recordatorios:', error);
      // Si no hay contenido en el modal, mostrar mensaje de error
      if(calModalBody.children.length === 0){
        const errorMsg = document.createElement('p');
        errorMsg.style.cssText = 'color:#ef4444;text-align:center;padding:20px';
        errorMsg.textContent = 'Error al cargar los recordatorios.';
        calModalBody.appendChild(errorMsg);
      }
    });
    
    // Abrir modal DESPUÉS de iniciar la carga (pero antes de que termine)
    modal.classList.add('open');
    modal.setAttribute('aria-hidden','false');
    
    // Botón de añadir recordatorio desde el modal
    const addReminderBtn = modal.querySelector('#calAddReminderDay');
    if(addReminderBtn){
      // Remover listener anterior si existe
      const newBtn = addReminderBtn.cloneNode(true);
      addReminderBtn.parentNode.replaceChild(newBtn, addReminderBtn);
      newBtn.addEventListener('click', () => openReminderModal(dateLabel));
    }
  }
  function closeCalModal(){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); }
  calModalClose.addEventListener('click', closeCalModal);
  modal.addEventListener('click', (e)=>{ if(e.target === modal) closeCalModal(); });

  // Función helper para crear tarjeta de recordatorio
  function createReminderCard(r, dateLabel, isPast){
    try{
      const card = document.createElement('div');
      card.className = 'event-card';
      card.setAttribute('data-reminder-id', r.id);
      
      // Verificar permisos de eliminación
      // Admin puede eliminar todos, usuarios normales solo los suyos
      const isAdmin = window.CURRENT_USER?.isAdmin === true || window.CURRENT_USER?.rol === 'admin';
      const currentUserId = window.CURRENT_USER?.userId || window.CURRENT_USER?.id || null;
      
      // Siempre mostrar botón de eliminar para admins o para el creador
      const canDelete = isAdmin || (r.created_by === currentUserId);
      
      // Si es admin, mostrar quién creó el recordatorio
      let creatorInfo = '';
      if(isAdmin && r.created_by){
        const creatorName = r.created_by_name || r.created_by_username || 'Usuario desconocido';
        creatorInfo = `<div class="event-card__meta" style="font-size:11px;color:#a8b2c2;margin-top:4px">Creado por: ${creatorName}</div>`;
      }
      
      const pastStyle = isPast ? 'opacity:0.7;' : '';
      const pastBadge = isPast ? '<span class="past-badge" style="background:#6c757d;color:#fff;padding:2px 6px;border-radius:4px;font-size:10px;display:inline-block;white-space:nowrap;vertical-align:middle">Pasado</span>' : '';
      
      // Asegurar que la tarjeta tenga estilos correctos para el modal
      card.style.position = 'relative';
      card.style.width = '100%';
      card.style.maxWidth = '100%';
      card.style.height = 'auto';
      card.style.opacity = '1';
      card.style.transform = 'none';
      card.style.marginBottom = '12px';
      card.style.marginLeft = '0';
      card.style.marginRight = '0';
      card.style.boxSizing = 'border-box';
      card.style.overflowWrap = 'break-word';
      card.style.wordWrap = 'break-word';
      
      // Debug: verificar datos del recordatorio
      calendarDebugLog('🔍 Creando tarjeta de recordatorio con datos:', {
        id: r.id,
        time: r.time,
        event_name: r.event_name,
        description: r.description,
        owners_text: r.owners_text,
        canDelete: canDelete
      });
      
      // Estructura HTML mejorada para recordatorios
      const reminderContent = document.createElement('div');
      reminderContent.className = 'reminder-card-content';
      reminderContent.style.cssText = `display:flex;justify-content:space-between;align-items:flex-start;gap:12px;width:100%;${pastStyle}`;
      
      // Contenedor de información (izquierda)
      const infoContainer = document.createElement('div');
      infoContainer.className = 'reminder-card-info';
      infoContainer.style.cssText = 'flex:1;min-width:0;display:flex;flex-direction:column;gap:6px;overflow:visible';
      
      // Meta información (hora, evento, badge)
      const metaDiv = document.createElement('div');
      metaDiv.className = 'event-card__meta reminder-meta';
      metaDiv.style.cssText = 'display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;gap:8px;line-height:1.4;margin-bottom:0';
      
      const timeSpan = document.createElement('span');
      timeSpan.textContent = r.time || 'Sin hora';
      timeSpan.style.cssText = 'white-space:nowrap;flex-shrink:0';
      metaDiv.appendChild(timeSpan);
      
      if(r.event_name){
        const eventSpan = document.createElement('span');
        eventSpan.textContent = `· ${r.event_name}`;
        eventSpan.style.cssText = 'white-space:nowrap;flex-shrink:0';
        metaDiv.appendChild(eventSpan);
      }
      
      if(isPast && pastBadge){
        metaDiv.insertAdjacentHTML('beforeend', pastBadge);
      }
      
      infoContainer.appendChild(metaDiv);
      
      // Descripción
      if(r.description){
        const descDiv = document.createElement('div');
        descDiv.className = 'event-card__desc';
        descDiv.textContent = r.description;
        descDiv.style.cssText = 'margin-top:0;line-height:1.5;word-break:break-word;overflow-wrap:break-word;white-space:normal';
        infoContainer.appendChild(descDiv);
      }
      
      // Involucrados
      if(r.owners_text){
        const ownersDiv = document.createElement('div');
        ownersDiv.className = 'event-card__meta';
        ownersDiv.textContent = `👥 Involucrados: ${r.owners_text}`;
        ownersDiv.style.cssText = 'margin-top:0;font-size:0.85rem;line-height:1.4;white-space:normal;word-break:break-word';
        infoContainer.appendChild(ownersDiv);
      }
      
      // Información del creador
      if(creatorInfo){
        infoContainer.insertAdjacentHTML('beforeend', creatorInfo);
      }
      
      reminderContent.appendChild(infoContainer);
      
      // Botón de eliminar (derecha)
      let deleteBtn = null;
      if(canDelete){
        deleteBtn = document.createElement('button');
        deleteBtn.className = 'btn-danger reminder-delete-btn';
        deleteBtn.setAttribute('data-rid', r.id);
        deleteBtn.textContent = '🗑️ Eliminar';
        deleteBtn.title = 'Eliminar recordatorio';
        deleteBtn.style.cssText = 'flex-shrink:0;flex-grow:0;padding:8px 14px;font-size:0.875rem;white-space:nowrap;align-self:flex-start;height:auto;min-width:100px;max-width:110px';
        
        // Agregar listener de eliminación directamente al botón
        deleteBtn.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          
          if(confirm('¿Estás seguro de que deseas eliminar este recordatorio?')){
            calendarDebugLog('🗑️ Eliminando recordatorio:', r.id);
            deleteReminder(r.id, dateLabel);
          }
        });
        
        reminderContent.appendChild(deleteBtn);
      }
      
      card.appendChild(reminderContent);
      
      return card;
    }catch(e){
      console.error('❌ Error en createReminderCard:', e, r);
      return null;
    }
  }

  let viewYear, viewMonth; // 0-indexed month
  function startOfMonth(date){ return new Date(date.getFullYear(), date.getMonth(), 1); }
  function endOfMonth(date){ return new Date(date.getFullYear(), date.getMonth()+1, 0); }
  function fmtISO(d){ 
    // Usar fecha local en lugar de UTC para evitar problemas con días 31
    const year = d.getFullYear();
    const month = pad(d.getMonth() + 1);
    const day = pad(d.getDate());
    return `${year}-${month}-${day}`;
  }
  function pad(n){ return n < 10 ? '0'+n : ''+n; }

  // Render encabezados de semana
  function renderWeekdays(){
    if(!calWeekdaysContainer) return;
    calWeekdaysContainer.innerHTML = '';
    calWeekdays.forEach(d => {
      const el = document.createElement('div'); el.textContent = d; calWeekdaysContainer.appendChild(el);
    });
  }

  // Cargar datos de eventos
  function normalizeEvent(raw){
    // fecha
    const date = raw.date || raw.fecha || raw.fecha_actividad || raw.creado_en?.slice(0,10);
    // nombre
    const name = raw.name || raw.nombre || raw.actividad || 'Evento';
    // descripcion
    const description = raw.description || raw.descripcion || raw.descripcion_cambio || '';
    // estado/status
    const status = raw.status || raw.estado || (raw.completado ? 'completado' : undefined);
    // encargados: preferir cadena preconstruida; si no, combinar campos
    const ownersFromView = raw.encargados || raw.encargados_texto;
    const ownersCombo = [
      raw.responsable,
      raw.colaborador,
      raw.colaborador_nombre,
      raw.usuarios_asignados,
      raw.colaboradores_asignados
    ].filter(Boolean).join(', ');
    const owners = ownersFromView || ownersCombo || '';
    return { date, name, description, owners, status };
  }

  async function fetchMonthEvents(year, month){
    const start = fmtISO(new Date(year, month, 1));
    const end = fmtISO(new Date(year, month+1, 0));
    try{
      const url = `${CAL_API}?start=${start}&end=${end}`;
      const res = await fetch(url);
      if(!res.ok) throw new Error('Error al cargar eventos');
      const data = await res.json();
      const list = Array.isArray(data) ? data : (data.results || []);
      // Mostrar todos los eventos sin importar estado (en_progreso, completado, planificado, cancelado)
      return list.map(normalizeEvent).filter(ev => {
        // Solo verificar que tenga fecha, sin filtrar por estado
        return ev.date !== null && ev.date !== undefined;
      });
    }catch(e){
      console.warn('No se pudieron cargar eventos del calendario:', e);
      return [];
    }
  }

  function groupByDate(events){
    const map = new Map();
    events.forEach(ev=>{
      if(!ev || !ev.date) return;
      if(!map.has(ev.date)) map.set(ev.date, []);
      map.get(ev.date).push(ev);
    });
    return map;
  }

  function monthLabel(y, m){
    const meses = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
    return `${meses[m]} ${y}`;
  }

  async function renderCalendar(year, month){
    if(!calGrid || !calCurrent) return;
    calGrid.innerHTML = '';
    calCurrent.textContent = monthLabel(year, month);

    const first = startOfMonth(new Date(year, month, 1));
    const last = endOfMonth(new Date(year, month, 1));
    const firstWeekday = (first.getDay() + 6) % 7; // lunes=0
    const daysInMonth = last.getDate();

    const events = await fetchMonthEvents(year, month);
    const byDate = groupByDate(events);
    
    // Cargar recordatorios del mes
    const monthStart = fmtISO(new Date(year, month, 1));
    const monthEnd = fmtISO(new Date(year, month+1, 0));
    const remindersByDate = await fetchMonthReminders(monthStart, monthEnd);
    
    // Cargar avances del mes
    const avancesByDate = await fetchMonthAvances(monthStart, monthEnd);

    for(let i=0;i<firstWeekday;i++){
      const cell = document.createElement('div');
      cell.className = 'cal-cell';
      cell.setAttribute('aria-disabled','true');
      calGrid.appendChild(cell);
    }
    const today = new Date();
    const todayKey = `${today.getFullYear()}-${pad(today.getMonth()+1)}-${pad(today.getDate())}`;
    const now = new Date();
    
    for(let d=1; d<=daysInMonth; d++){
      const key = `${year}-${pad(month+1)}-${pad(d)}`;
      const cell = document.createElement('div');
      cell.className = 'cal-cell' + (key===todayKey ? ' is-today' : '');
      cell.setAttribute('role','gridcell');
      cell.setAttribute('tabindex','0');
      cell.innerHTML = `<div class="cal-cell__date">${d}</div><div class="cal-cell__events"></div>`;
      const list = cell.querySelector('.cal-cell__events');
      
      // Mostrar TODOS los eventos del día sin importar estado (en_progreso, completado, planificado, cancelado)
      const dayEvents = byDate.get(key) || [];
      const itemsToShow = [];
      
      // Agregar eventos (máximo 2) - todos los eventos sin filtrar por estado
      dayEvents.slice(0, 2).forEach(ev => {
        itemsToShow.push({ type: 'event', data: ev });
      });
      
      // Agregar avances del día (SOLO de eventos_cambios_colaboradores)
      // Máximo 1 si ya hay 2 eventos
      // Los avances provienen exclusivamente de la tabla eventos_cambios_colaboradores
      // Eliminar duplicados por ID antes de usar
      const avancesDelDia = avancesByDate.get(key) || [];
      const dayAvances = eliminarDuplicadosAvances(avancesDelDia).filter(av => {
        // Validar que sea un avance válido de eventos_cambios_colaboradores
        // Debe tener descripcion_cambio (descripcion) y fecha_cambio (fecha)
        // Estos son campos obligatorios de la tabla eventos_cambios_colaboradores
        return (av.descripcion || av.descripcion_cambio) && (av.fecha || av.fecha_cambio);
      });
      
      if(itemsToShow.length < 2){
        dayAvances.slice(0, 2 - itemsToShow.length).forEach(av => {
          itemsToShow.push({ type: 'avance', data: av });
        });
      }
      
      // Agregar recordatorios del día
      const dayReminders = remindersByDate.get(key) || [];
      calendarDebugLog(`📋 Día ${key}: ${dayReminders.length} recordatorio(s) encontrado(s)`);
      const futureReminders = dayReminders.filter(r => {
        if(r.date && r.time){
          const reminderDateTime = new Date(`${r.date}T${r.time || '00:00'}`);
          return reminderDateTime >= now;
        }
        return true; // Si no tiene hora, considerarlo futuro
      });
      
      // Agregar hasta 2 recordatorios futuros (respetando el límite de 2 items totales)
      const reminderSlots = 2 - itemsToShow.length;
      futureReminders.slice(0, Math.max(0, reminderSlots)).forEach(r => {
        itemsToShow.push({ type: 'reminder', data: r, isPast: false });
      });
      
      // Si no hay eventos ni avances, mostrar también recordatorios pasados
      if(itemsToShow.length === 0 && dayReminders.length > 0){
        const pastReminders = dayReminders.filter(r => {
          if(r.date && r.time){
            const reminderDateTime = new Date(`${r.date}T${r.time || '00:00'}`);
            return reminderDateTime < now;
          }
          return false;
        });
        pastReminders.slice(0, 1).forEach(r => {
          itemsToShow.push({ type: 'reminder', data: r, isPast: true });
        });
      }
      
      // Renderizar items
      itemsToShow.forEach(item => {
        if(item.type === 'event'){
          const ev = item.data;
        const pill = document.createElement('div');
        // Determinar el tipo de punto según el estado
        let typeDot = 'cal-dot--event'; // verde por defecto (para planificado, en_progreso, etc.)
        if(ev.status === 'completado' || ev.status === 'finalizado'){
          typeDot = 'cal-dot--finish'; // rojo para completados
        } else if(ev.status === 'en_progreso'){
          typeDot = 'cal-dot--event'; // verde para en progreso
        } else if(ev.status === 'planificado'){
          typeDot = 'cal-dot--event'; // verde para planificado
        } else if(ev.status === 'cancelado'){
          typeDot = 'cal-dot--event'; // verde para cancelado
        }
        const mine = ev._involvesUser === true;
          pill.className = 'cal-pill cal-pill--event' + (mine ? ' cal-pill--mine' : '');
          const eventName = ev.name || 'Evento';
          const initial = eventName.charAt(0).toUpperCase() + '.';
          pill.innerHTML = `<span class="cal-dot ${typeDot}"></span><span class="cal-pill__text">${eventName}</span><span class="cal-pill__short">${initial}</span>`;
          pill.setAttribute('data-type', 'event');
        list.appendChild(pill);
        } else if(item.type === 'avance'){
          const av = item.data;
          const pill = document.createElement('div');
          pill.className = 'cal-pill cal-pill--avance';
          const eventName = av.evento_nombre || 'Sin evento';
          const avanceText = `Avance ${eventName}`;
          const initial = eventName.charAt(0).toUpperCase();
          const avanceShort = `A. ${initial}`;
          pill.innerHTML = `<span class="cal-dot cal-dot--avance"></span><span class="cal-pill__text">${avanceText}</span><span class="cal-pill__short">${avanceShort}</span>`;
          pill.setAttribute('data-type', 'avance');
          list.appendChild(pill);
        } else if(item.type === 'reminder'){
          const r = item.data;
          const pill = document.createElement('div');
          pill.className = 'cal-pill cal-pill--reminder-item' + (item.isPast ? ' cal-pill--reminder-past' : '');
          const eventName = r.event_name || 'Sin evento';
          const reminderText = `Recordatorio ${eventName}`;
          const initial = eventName.charAt(0).toUpperCase();
          const reminderShort = `R. ${initial}`;
          pill.innerHTML = `<span class="cal-dot ${item.isPast ? 'cal-dot--reminder-past' : 'cal-dot--reminder'}"></span><span class="cal-pill__text">${reminderText}</span><span class="cal-pill__short">${reminderShort}</span>`;
          pill.setAttribute('data-type', 'reminder');
          list.appendChild(pill);
        }
      });
      
      // Mostrar "más" si hay más elementos
      const totalItems = dayEvents.length + dayReminders.length + dayAvances.length;
      if(totalItems > itemsToShow.length){
        const more = document.createElement('div');
        more.className = 'cal-pill';
        more.innerHTML = `<span class="cal-dot cal-dot--event"></span><span>+${totalItems - itemsToShow.length} más</span>`;
        list.appendChild(more);
      }
      
      cell.addEventListener('click', ()=>{
        openCalModal(`${pad(d)}/${pad(month+1)}/${year}`, dayEvents, dayAvances);
      });
      calGrid.appendChild(cell);
    }
  }
  
  // Función para cargar recordatorios de un mes (optimizada con llamadas en paralelo)
  async function fetchMonthReminders(startDate, endDate){
    const remindersMap = new Map();
    try{
      // Parsear fechas de forma segura (formato YYYY-MM-DD)
      const [startYear, startMonth, startDay] = startDate.split('-').map(Number);
      const [endYear, endMonth, endDay] = endDate.split('-').map(Number);
      
      // Crear objetos Date en hora local para evitar problemas con UTC
      const start = new Date(startYear, startMonth - 1, startDay);
      const end = new Date(endYear, endMonth - 1, endDay);
      
      // Calcular número de días incluyendo el último día
      const daysDiff = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
      
      // Crear array de promesas para llamadas en paralelo
      const promises = [];
      const dateKeys = [];
      
      // Iterar día por día usando el mes y año original para evitar problemas
      for(let i = 0; i < daysDiff; i++){
        const d = new Date(startYear, startMonth - 1, startDay + i);
        const dateKey = fmtISO(d);
        const dateLabel = `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()}`;
        dateKeys.push(dateKey);
        promises.push(
          fetchDayReminders(dateLabel).catch(e => {
            console.warn(`Error al cargar recordatorios para ${dateKey}:`, e);
            return [];
          })
        );
      }
      
      // Ejecutar todas las llamadas en paralelo
      const results = await Promise.all(promises);
      
      // Mapear resultados - agrupar por fecha real del recordatorio
      results.forEach((reminders, index) => {
        if(reminders && reminders.length > 0){
          // Para cada recordatorio, usar su fecha real para mapearlo
          reminders.forEach(r => {
            if(!r.date) return;
            // Extraer solo la fecha (sin hora) del recordatorio
            const reminderDate = r.date.split('T')[0];
            // Usar la fecha real del recordatorio como clave
            if(!remindersMap.has(reminderDate)){
              remindersMap.set(reminderDate, []);
            }
            remindersMap.get(reminderDate).push(r);
            calendarDebugLog(`📍 Recordatorio mapeado: ${r.event_name || 'Sin nombre'} → fecha ${reminderDate}`);
          });
        }
      });
      
      calendarDebugLog(`✅ Recordatorios del mes cargados: ${remindersMap.size} días con recordatorios`);
      // Log para debugging: mostrar todas las fechas con recordatorios
      remindersMap.forEach((reminders, dateKey) => {
        calendarDebugLog(`  📅 ${dateKey}: ${reminders.length} recordatorio(s)`);
      });
    }catch(e){
      console.warn('Error al cargar recordatorios del mes:', e);
    }
    return remindersMap;
  }
  
  // Función para cargar avances de un mes (optimizada con llamadas en paralelo)
  // IMPORTANTE: SOLO datos de la tabla eventos_cambios_colaboradores
  // Esta función usa fetchDayAvances que consulta exclusivamente eventos_cambios_colaboradores
  async function fetchMonthAvances(startDate, endDate){
    const avancesMap = new Map();
    try{
      // Parsear fechas de forma segura (formato YYYY-MM-DD)
      const [startYear, startMonth, startDay] = startDate.split('-').map(Number);
      const [endYear, endMonth, endDay] = endDate.split('-').map(Number);
      
      // Crear objetos Date en hora local para evitar problemas con UTC
      const start = new Date(startYear, startMonth - 1, startDay);
      const end = new Date(endYear, endMonth - 1, endDay);
      
      // Calcular número de días incluyendo el último día
      const daysDiff = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
      
      // Crear array de promesas para llamadas en paralelo
      const promises = [];
      const dateKeys = [];
      
      // Iterar día por día usando el mes y año original para evitar problemas
      for(let i = 0; i < daysDiff; i++){
        const d = new Date(startYear, startMonth - 1, startDay + i);
        const dateKey = fmtISO(d);
        const dateLabel = `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()}`;
        dateKeys.push(dateKey);
        // fetchDayAvances consulta SOLO eventos_cambios_colaboradores
        promises.push(
          fetchDayAvances(dateLabel).catch(e => {
            console.warn(`Error al cargar avances de eventos_cambios_colaboradores para ${dateKey}:`, e);
            return [];
          })
        );
      }
      
      // Ejecutar todas las llamadas en paralelo
      const results = await Promise.all(promises);
      
      // Mapear resultados - agrupar por fecha real del avance (SOLO de eventos_cambios_colaboradores)
      // Usar Set para evitar duplicados por ID
      const avancesIdsAgregados = new Set();
      results.forEach((avances, index) => {
        if(avances && avances.length > 0){
          // Para cada avance, validar que sea de eventos_cambios_colaboradores y usar su fecha real
          avances.forEach(av => {
            // Validar que tenga ID (requerido para evitar duplicados)
            if(!av.id) return;
            
            // Validar que tenga los campos obligatorios de eventos_cambios_colaboradores
            // descripcion_cambio es obligatorio en la tabla
            if(!av.descripcion && !av.descripcion_cambio) return;
            // fecha_cambio es obligatorio en la tabla
            if(!av.fecha && !av.fecha_cambio) return;
            
            // Evitar duplicados: si ya se agregó este avance, saltarlo
            if(avancesIdsAgregados.has(av.id)){
              calendarDebugLog(`⚠️ Avance duplicado omitido (ID: ${av.id}):`, av.evento_nombre || 'Sin nombre');
              return;
            }
            
            // Extraer solo la fecha (sin hora) del avance
            const avanceDate = (av.fecha || av.fecha_cambio || '').split('T')[0];
            if(!avanceDate) return;
            
            // Marcar este avance como agregado
            avancesIdsAgregados.add(av.id);
            
            // Usar la fecha real del avance como clave
            if(!avancesMap.has(avanceDate)){
              avancesMap.set(avanceDate, []);
            }
            
            // Verificar que el avance no esté ya en el array de esa fecha (evitar duplicados)
            const avancesDelDia = avancesMap.get(avanceDate);
            const yaExiste = avancesDelDia.some(a => a.id === av.id);
            if(!yaExiste){
            avancesMap.get(avanceDate).push(av);
              calendarDebugLog(`📍 Avance de eventos_cambios_colaboradores mapeado: ${av.evento_nombre || 'Sin nombre'} → fecha ${avanceDate}`);
            } else {
              calendarDebugLog(`⚠️ Avance duplicado omitido en mapeo mensual (ID: ${av.id}):`, av.evento_nombre || 'Sin nombre');
            }
          });
        }
      });
      
      // Eliminar duplicados finales en cada fecha del mapa
      avancesMap.forEach((avances, fecha) => {
        const avancesUnicos = eliminarDuplicadosAvances(avances);
        if(avancesUnicos.length !== avances.length){
          calendarDebugLog(`⚠️ Duplicados eliminados para fecha ${fecha}: ${avances.length - avancesUnicos.length} duplicado(s)`);
          avancesMap.set(fecha, avancesUnicos);
        }
      });
      
      calendarDebugLog(`✅ Avances de eventos_cambios_colaboradores del mes cargados: ${avancesMap.size} días con avances`);
    }catch(e){
      console.warn('Error al cargar avances de eventos_cambios_colaboradores del mes:', e);
    }
    return avancesMap;
  }
  
  // Función helper para eliminar duplicados de avances por ID
  // IMPORTANTE: Esta función asegura que cada avance se muestre solo una vez
  function eliminarDuplicadosAvances(avances){
    if(!avances || avances.length === 0) return [];
    const avancesUnicos = [];
    const idsVistos = new Set();
    
    avances.forEach(av => {
      if(!av || !av.id) return;
      if(idsVistos.has(av.id)){
        calendarDebugLog(`⚠️ Avance duplicado eliminado (ID: ${av.id}):`, av.evento_nombre || 'Sin nombre');
        return;
      }
      idsVistos.add(av.id);
      avancesUnicos.push(av);
    });
    
    return avancesUnicos;
  }
  
  // Función para cargar avances de un día específico
  // IMPORTANTE: SOLO datos de la tabla eventos_cambios_colaboradores
  // Esta función consulta la API /api/avances/ que devuelve exclusivamente registros de eventos_cambios_colaboradores
  // Estructura de eventos_cambios_colaboradores:
  //   - id (UUID)
  //   - actividad_id (UUID) → referencia a actividades
  //   - colaborador_id (UUID) → referencia a colaboradores
  //   - descripcion_cambio (TEXT) → descripción del cambio
  //   - fecha_cambio (TIMESTAMPTZ) → fecha y hora del cambio
  //   - creado_en (TIMESTAMPTZ) → timestamp de creación
  async function fetchDayAvances(dateLabel){
    try{
      const dateISO = parseLabelToISO(dateLabel);
      calendarDebugLog('🔍 Buscando avances (SOLO eventos_cambios_colaboradores) para fecha:', dateLabel, '→ ISO:', dateISO);
      
      // Llamar a la API que consulta SOLO eventos_cambios_colaboradores
      const res = await fetch(`${AVANCES_API}?date=${dateISO}`);
      
      if(!res.ok){
        console.warn('⚠️ Error al obtener avances de eventos_cambios_colaboradores:', res.status, res.statusText);
        return [];
      }
      
      const data = await res.json();
      const avances = Array.isArray(data) ? data : (data.results || []);
      
      calendarDebugLog('📥 Datos brutos recibidos de api_avances (eventos_cambios_colaboradores):', avances);
      
      // Validar que los avances tengan la estructura correcta de eventos_cambios_colaboradores
      // La API devuelve campos mapeados: id, actividad_id, evento_nombre, fecha, hora, descripcion, responsable
      // Estos campos provienen exclusivamente de eventos_cambios_colaboradores
      const avancesValidados = avances.filter(av => {
        // Validar que tenga los campos obligatorios de eventos_cambios_colaboradores
        // El campo descripcion_cambio es obligatorio en la tabla
        const tieneDescripcion = av.descripcion || av.descripcion_cambio;
        // El campo fecha_cambio es obligatorio en la tabla
        const tieneFecha = av.fecha || av.fecha_cambio;
        const esValido = tieneDescripcion && tieneFecha;
        
        if(!esValido){
          calendarDebugLog('⚠️ Avance filtrado (no tiene estructura de eventos_cambios_colaboradores):', av);
        }
        
        return esValido;
      }).map(av => {
        // Asegurar que los campos estén correctamente mapeados desde eventos_cambios_colaboradores
        // El backend ya devuelve: id, actividad_id, evento_nombre, fecha, hora, descripcion, responsable
        return {
          id: av.id, // id de eventos_cambios_colaboradores
          actividad_id: av.actividad_id, // actividad_id de eventos_cambios_colaboradores
          evento_nombre: av.evento_nombre || 'Sin evento', // nombre de la actividad relacionada
          fecha: av.fecha || (av.fecha_cambio ? av.fecha_cambio.split('T')[0] : null), // fecha_cambio convertida
          hora: av.hora || (av.fecha_cambio ? av.fecha_cambio.split('T')[1]?.split(':').slice(0,2).join(':') : ''), // hora de fecha_cambio
          descripcion: av.descripcion || av.descripcion_cambio || '', // descripcion_cambio
          responsable: av.responsable || 'Sistema' // colaborador_nombre
        };
      });
      
      calendarDebugLog(`✅ Avances de eventos_cambios_colaboradores validados: ${avancesValidados.length} de ${avances.length} totales`);
      
      // Eliminar duplicados por ID antes de retornar
      const avancesSinDuplicados = eliminarDuplicadosAvances(avancesValidados);
      
      if(avancesSinDuplicados.length !== avancesValidados.length){
        calendarDebugLog(`⚠️ Duplicados eliminados: ${avancesValidados.length - avancesSinDuplicados.length} avance(s) duplicado(s)`);
      }
      
      if(avancesSinDuplicados.length > 0){
        calendarDebugLog('📋 Estructura de avances validados (eventos_cambios_colaboradores):', avancesSinDuplicados[0]);
      }
      return avancesSinDuplicados;
    }catch(e){
      console.error('❌ Error en fetchDayAvances (eventos_cambios_colaboradores):', e);
      return [];
    }
  }

  async function initCalendar(){
    // Solo inicializar si el usuario está autenticado
    if(!isUserAuthenticated){
      return;
    }
    
    // Cargar información del usuario antes de inicializar
    if(!CURRENT_USER){
      await loadCurrentUser();
    }
    
    renderWeekdays();
    const now = new Date();
    viewYear = now.getFullYear();
    viewMonth = now.getMonth();
    renderCalendar(viewYear, viewMonth);
    if(calPrev) calPrev.addEventListener('click', ()=>{ viewMonth--; if(viewMonth<0){ viewMonth=11; viewYear--; } renderCalendar(viewYear, viewMonth); });
    if(calNext) calNext.addEventListener('click', ()=>{ viewMonth++; if(viewMonth>11){ viewMonth=0; viewYear++; } renderCalendar(viewYear, viewMonth); });
    document.getElementById('calAddReminderTop')?.addEventListener('click', ()=>{
      const today = new Date();
      const label = `${pad(today.getDate())}/${pad(today.getMonth()+1)}/${today.getFullYear()}`;
      openReminderModal(label);
    });
  }

  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', () => {
      if(isUserAuthenticated){
        initCalendar();
      }
    });
  } else {
    if(isUserAuthenticated){
      initCalendar();
    }
  }

  /* ======== Recordatorios y resaltado: helpers ======== */
  const REM_API = (window.DJANGO_URLS && window.DJANGO_URLS.reminders) || '/api/reminders/';
  const COLLAB_API = (window.DJANGO_URLS && window.DJANGO_URLS.collaborators) || '/api/collaborators/';

  // CSRF helper para POST/DELETE en Django
  function getCookie(name){
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if(parts.length === 2) return parts.pop().split(';').shift();
    return null;
  }
  const CSRF_TOKEN = getCookie('csrftoken');

  function parseLabelToISO(label){ 
    // Formato esperado: DD/MM/YYYY
    const parts = label.split('/');
    if(parts.length === 3){
      const [dd, mm, yyyy] = parts;
      return `${yyyy}-${mm}-${dd}`;
    }
    return label; // Si ya está en formato ISO, devolverlo
  }
  
  async function fetchDayReminders(dateLabel){ 
    try{ 
      const dateISO = parseLabelToISO(dateLabel);
      calendarDebugLog('🔍 Buscando recordatorios para fecha:', dateLabel, '→ ISO:', dateISO);
      const res = await fetch(`${REM_API}?date=${dateISO}`);
      
      if(!res.ok){
        console.warn('⚠️ Error al obtener recordatorios:', res.status, res.statusText);
        return [];
      }
      
      const data = await res.json();
      const reminders = Array.isArray(data) ? data : (data.results || []);
      calendarDebugLog('✅ Recordatorios encontrados:', reminders.length, reminders);
      return reminders;
    }catch(e){ 
      console.error('❌ Error en fetchDayReminders:', e);
      return []; 
    } 
  }
  async function deleteReminder(id, dateLabel){ 
    try{ 
      const res = await fetch(`${REM_API}${id}/`, { 
        method:'DELETE',
        headers: {
          'X-CSRFToken': CSRF_TOKEN || ''
        },
        credentials: 'same-origin'
      }); 
      if(res.ok){ 
        // Cerrar el modal del día
        closeCalModal();
        
        // Recargar todo el calendario para actualizar las píldoras inmediatamente
        renderCalendar(viewYear, viewMonth);
        
        // Reabrir el modal del día con datos actualizados
        setTimeout(async () => {
          const dateISO = parseLabelToISO(dateLabel);
          const events = await fetchMonthEvents(viewYear, viewMonth);
          const byDate = groupByDate(events);
          const dayEvents = byDate.get(dateISO) || [];
          openCalModal(dateLabel, dayEvents);
        }, 300);
      } else {
        console.warn('Error al eliminar recordatorio:', res.status);
        alert('No se pudo eliminar el recordatorio.');
      }
    }catch(e){ 
      console.warn('Delete reminder failed', e);
      alert('Error al eliminar el recordatorio.');
    }
  }
  async function prepareReminderForm(defaultDateLabel){
    // Cargar información del usuario si no está cargada
    if(!CURRENT_USER){
      await loadCurrentUser();
    }
    
    const isAdmin = CURRENT_USER?.isAdmin === true;
    const collaboratorId = CURRENT_USER?.collaboratorId;
    
    // Resetear completamente el formulario
    const dateInput = document.getElementById('reminderDate');
    const timeInput = document.getElementById('reminderTime');
    const descInput = document.getElementById('reminderDescription');
    
    // Limpiar fecha - usar defaultDateLabel si está disponible, sino dejar vacío
    if(dateInput){
      if(defaultDateLabel){
        dateInput.value = parseLabelToISO(defaultDateLabel);
      } else {
        dateInput.value = '';
      }
    }
    
    // Resetear hora al valor por defecto
    if(timeInput){
      timeInput.value = '08:00';
    }
    
    // Limpiar descripción y resetear estilos de error
    if(descInput){
      descInput.value = '';
      descInput.style.border = '';
    }
    const descError = document.getElementById('reminderDescriptionError');
    if(descError){
      descError.style.display = 'none';
    }
    
    // Limpiar y cargar eventos disponibles
    const eventSelect = document.getElementById('reminderEventSelect');
    if(eventSelect){
      // Limpiar completamente el select
      eventSelect.innerHTML = '';
      
      // Agregar opción por defecto y seleccionarla
      const defOption = document.createElement('option');
      defOption.value = '';
      defOption.textContent = '-- Selecciona un evento --';
      defOption.selected = true;
      eventSelect.appendChild(defOption);
      
      // Usar una función named para poder remover el listener si es necesario
      async function handleEventSelectChange() {
        const selectedOption = eventSelect.options[eventSelect.selectedIndex];
        const selectedEventId = selectedOption ? selectedOption.getAttribute('data-id') : null;
        await loadCollaboratorsForEvent(selectedEventId);
      }
      
      // Remover listener anterior si existe (usar una propiedad para rastrear)
      if(eventSelect._changeHandler){
        eventSelect.removeEventListener('change', eventSelect._changeHandler);
      }
      
      // Agregar nuevo listener y guardar referencia
      eventSelect._changeHandler = handleEventSelectChange;
      eventSelect.addEventListener('change', handleEventSelectChange);
      
      try{
        const res = await fetch(EVENTS_LIST_API);
        if(res.ok){
          const evs = await res.json();
          // Usar Set para evitar duplicados por ID y nombre
          const seenIds = new Set();
          const seenNames = new Set();
          
          if(Array.isArray(evs)){
            evs.forEach(e => {
              // Validar que tenga ID y nombre
              if(!e || !e.id || !e.name) return;
              
              // Evitar duplicados por ID
              if(seenIds.has(e.id)) return;
              
              seenIds.add(e.id);
              seenNames.add(e.name);
              
              const opt = document.createElement('option');
              opt.value = e.name;
              opt.setAttribute('data-id', e.id);
              opt.textContent = e.name;
              eventSelect.appendChild(opt);
            });
          }
        }
      }catch(e){
        console.warn('Error al cargar eventos:', e);
      }
    }
    
    // Limpiar checklist de colaboradores (se cargará cuando se seleccione un evento)
    const ownersChecklist = document.getElementById('reminderOwnersChecklist');
    if(ownersChecklist){
      ownersChecklist.innerHTML = '';
      const emptyMsg = document.createElement('p');
      emptyMsg.style.cssText = 'color:#a8b2c2;text-align:center;padding:12px;font-size:0.9rem';
      emptyMsg.textContent = 'Selecciona un evento para ver los colaboradores disponibles';
      ownersChecklist.appendChild(emptyMsg);
    }
  }
  
  // Función para cargar colaboradores de un evento específico
  async function loadCollaboratorsForEvent(eventId){
    const ownersChecklist = document.getElementById('reminderOwnersChecklist');
    if(!ownersChecklist) return;
    
    // Limpiar checklist
    ownersChecklist.innerHTML = '';
    
    if(!eventId){
      const emptyMsg = document.createElement('p');
      emptyMsg.style.cssText = 'color:#a8b2c2;text-align:center;padding:12px;font-size:0.9rem';
      emptyMsg.textContent = 'Selecciona un evento para ver los colaboradores disponibles';
      ownersChecklist.appendChild(emptyMsg);
      return;
    }
    
    try{
      // Cargar información del usuario si no está cargada
      if(!CURRENT_USER){
        await loadCurrentUser();
      }
      
      const isAdmin = CURRENT_USER?.isAdmin === true || CURRENT_USER?.rol === 'admin';
      const collaboratorId = CURRENT_USER?.collaboratorId;
      
      // Si es usuario personal (no admin), solo mostrar su propio colaborador
      if(!isAdmin && collaboratorId){
        const COLLAB_API = (window.DJANGO_URLS && window.DJANGO_URLS.collaborators) || '/api/collaborators/';
        const res = await fetch(`${COLLAB_API}?evento_id=${eventId}`);
        
        if(!res.ok){
          throw new Error('Error al cargar colaboradores');
        }
        
        const collabs = await res.json();
        
        // Buscar solo el colaborador del usuario
        const userCollaborator = Array.isArray(collabs) ? collabs.find(c => (c.id || '') === collaboratorId) : null;
        
        if(userCollaborator){
          const cid = userCollaborator.id || '';
          if(cid){
            const checkboxDiv = document.createElement('div');
            checkboxDiv.className = 'collaborator-checkbox';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = `collab-${cid}`;
            checkbox.value = cid;
            checkbox.name = 'collaborators';
            checkbox.checked = true;
            checkbox.disabled = true;
            checkboxDiv.style.opacity = '0.7';
            
            const label = document.createElement('label');
            label.htmlFor = `collab-${cid}`;
            const nombre = userCollaborator.name || userCollaborator.nombre || 'Colaborador';
            const puesto = userCollaborator.puesto || '';
            const username = userCollaborator.username || '';
            
            // Mostrar nombre con username si existe
            let displayName = nombre;
            if(username){
              displayName = `${nombre} (${username})`;
            }
            label.textContent = puesto ? `${displayName} (${puesto})` : displayName;
            
            checkboxDiv.appendChild(checkbox);
            checkboxDiv.appendChild(label);
            ownersChecklist.appendChild(checkboxDiv);
          }
        } else {
          const emptyMsg = document.createElement('p');
          emptyMsg.style.cssText = 'color:#a8b2c2;text-align:center;padding:12px;font-size:0.9rem';
          emptyMsg.textContent = 'No estás asignado a este evento';
          ownersChecklist.appendChild(emptyMsg);
        }
        return; // Salir de la función para usuarios personales
      }
      
      // Si es admin, cargar todos los colaboradores del evento
      const COLLAB_API = (window.DJANGO_URLS && window.DJANGO_URLS.collaborators) || '/api/collaborators/';
      const res = await fetch(`${COLLAB_API}?evento_id=${eventId}`);
      
      if(!res.ok){
        throw new Error('Error al cargar colaboradores');
      }
      
      const collabs = await res.json();
      
      if(Array.isArray(collabs) && collabs.length > 0){
        collabs.forEach(c => {
          const cid = c.id || '';
          if(!cid) return;
          
          const checkboxDiv = document.createElement('div');
          checkboxDiv.className = 'collaborator-checkbox';
          
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.id = `collab-${cid}`;
          checkbox.value = cid;
          checkbox.name = 'collaborators';
          checkbox.checked = false;
          
          // Agregar listener para ocultar error cuando se selecciona un checkbox
          checkbox.addEventListener('change', () => {
            const ownerCheckboxes = document.querySelectorAll('#reminderOwnersChecklist input[type="checkbox"]:checked');
            const selectedCount = ownerCheckboxes.length;
            const ownersError = document.getElementById('reminderOwnersError');
            
            if(selectedCount > 0){
              if(ownersError){
                ownersError.style.display = 'none';
              }
              if(ownersChecklist){
                ownersChecklist.style.border = '';
                ownersChecklist.style.borderRadius = '';
                ownersChecklist.style.padding = '';
              }
            }
          });
          
          const label = document.createElement('label');
          label.htmlFor = `collab-${cid}`;
          const nombre = c.name || c.nombre || 'Colaborador';
          const puesto = c.puesto || '';
          const username = c.username || '';
          
          // Mostrar nombre con username si existe
          let displayName = nombre;
          if(username){
            displayName = c.displayName || `${nombre} (${username})`;
          }
          label.textContent = puesto ? `${displayName} (${puesto})` : displayName;
          
          checkboxDiv.appendChild(checkbox);
          checkboxDiv.appendChild(label);
          ownersChecklist.appendChild(checkboxDiv);
        });
      } else {
        const emptyMsg = document.createElement('p');
        emptyMsg.style.cssText = 'color:#a8b2c2;text-align:center;padding:12px;font-size:0.9rem';
        emptyMsg.textContent = 'No hay colaboradores asignados a este evento';
        ownersChecklist.appendChild(emptyMsg);
      }
    }catch(e){
      console.warn('Error al cargar colaboradores:', e);
      const errorMsg = document.createElement('p');
      errorMsg.style.cssText = 'color:#ff5d5d;text-align:center;padding:12px;font-size:0.9rem';
      errorMsg.textContent = 'Error al cargar colaboradores';
      ownersChecklist.appendChild(errorMsg);
    }
  }
  
  function openReminderModal(dateLabel){ 
    const m = document.getElementById('reminderModal'); 
    document.getElementById('reminderModalTitle').textContent='Añadir recordatorio'; 
    m.classList.add('open'); 
    m.setAttribute('aria-hidden','false'); 
    prepareReminderForm(dateLabel);
    
    // Agregar listener al textarea de descripción para ocultar error cuando se escribe
    const descInput = document.getElementById('reminderDescription');
    if(descInput){
      // Remover listener anterior si existe
      const newDescInput = descInput.cloneNode(true);
      descInput.parentNode.replaceChild(newDescInput, descInput);
      
      newDescInput.addEventListener('input', () => {
        const descError = document.getElementById('reminderDescriptionError');
        if(newDescInput.value.trim().length > 0){
          if(descError){
            descError.style.display = 'none';
          }
          newDescInput.style.border = '';
        }
      });
    }
  }
  function closeReminderModal(){ 
    const m = document.getElementById('reminderModal'); 
    m.classList.remove('open'); 
    m.setAttribute('aria-hidden','true'); 
    // Resetear el formulario al cerrar también
    prepareReminderForm(null);
  }
  document.getElementById('reminderModalClose')?.addEventListener('click', closeReminderModal);
  document.getElementById('reminderCancelBtn')?.addEventListener('click', closeReminderModal);
  document.getElementById('reminderSaveBtn')?.addEventListener('click', async ()=>{
    const date = (document.getElementById('reminderDate')).value;
    const time = (document.getElementById('reminderTime')).value || '08:00';
    const eventSelect = (document.getElementById('reminderEventSelect'));
    const eventName = eventSelect ? eventSelect.value : '';
    const descInput = document.getElementById('reminderDescription');
    const desc = descInput ? descInput.value.trim() : '';
    // Obtener colaboradores seleccionados desde checkboxes
    const ownerCheckboxes = document.querySelectorAll('#reminderOwnersChecklist input[type="checkbox"]:checked');
    const owners = Array.from(ownerCheckboxes).map(cb => cb.value).filter((v,i,a)=>v && a.indexOf(v)===i);
    
    // Validar descripción (obligatoria)
    const descError = document.getElementById('reminderDescriptionError');
    let hasErrors = false;
    
    if(!desc || desc.length === 0){
      // Mostrar error de descripción
      if(descError){
        descError.style.display = 'block';
      }
      if(descInput){
        descInput.style.border = '1px solid #ff5d5d';
      }
      hasErrors = true;
    } else {
      // Ocultar error de descripción si existe
      if(descError){
        descError.style.display = 'none';
      }
      if(descInput){
        descInput.style.border = '';
      }
    }
    
    // Validar que se haya seleccionado al menos un colaborador
    const ownersError = document.getElementById('reminderOwnersError');
    const ownersChecklist = document.getElementById('reminderOwnersChecklist');
    
    if(!owners || owners.length === 0){
      // Mostrar error
      if(ownersError){
        ownersError.style.display = 'block';
      }
      if(ownersChecklist){
        ownersChecklist.style.border = '1px solid #ff5d5d';
        ownersChecklist.style.borderRadius = '4px';
        ownersChecklist.style.padding = '8px';
      }
      hasErrors = true;
    } else {
      // Ocultar error si existe
      if(ownersError){
        ownersError.style.display = 'none';
      }
      if(ownersChecklist){
        ownersChecklist.style.border = '';
        ownersChecklist.style.borderRadius = '';
        ownersChecklist.style.padding = '';
      }
    }
    
    // Si hay errores, mostrar mensaje y hacer scroll al primer error
    if(hasErrors){
      const errorMessages = [];
      if(!desc || desc.length === 0){
        errorMessages.push('descripción');
      }
      if(!owners || owners.length === 0){
        errorMessages.push('personal involucrado');
      }
      
      // Scroll al primer campo con error
      if(!desc || desc.length === 0){
        descInput?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      } else if(!owners || owners.length === 0){
        ownersChecklist?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
      
      alert(`Por favor, completa los siguientes campos obligatorios: ${errorMessages.join(', ')}.`);
      return;
    }
    
    try{
      const res = await fetch(REM_API, {
        method:'POST',
        headers:{
          'Content-Type':'application/json',
          'X-CSRFToken': CSRF_TOKEN || ''
        },
        credentials: 'same-origin',
        body: JSON.stringify({ date, time, event_name: eventName, description: desc, owners })
      });
      if(res.ok){
        const result = await res.json();
        calendarDebugLog('✅ Recordatorio guardado exitosamente:', result);
        closeReminderModal();
        // Cerrar el modal del día si está abierto
        closeCalModal();
        // Recargar el calendario para mostrar el nuevo recordatorio
        renderCalendar(viewYear, viewMonth);
        // Mostrar mensaje de éxito
        alert('Recordatorio guardado exitosamente');
      } else {
        const t = await res.text();
        console.warn('Save reminder failed', res.status, t);
        alert('No se pudo guardar el recordatorio. Verifique los datos e intente nuevamente.');
      }
    }catch(e){ console.warn('Save reminder error', e); alert('Error de red al guardar recordatorio.'); }
  });

  // Resaltado de eventos para el usuario actual
  const _normalize = normalizeEvent;
  normalizeEvent = function(raw){
    const ev = _normalize(raw);
    const currentUser = window.CURRENT_USER || CURRENT_USER || { userId:null, collaboratorId:null, isAdmin:false };
    const userId = currentUser.userId;
    const collabId = currentUser.collaboratorId || currentUser.colaboradorId || currentUser.collaborator_id;
    const idsUsuarios = raw.usuarios_asignados_ids || raw.usuarios_ids || [];
    const idsColabs = raw.colaboradores_asignados_ids || raw.colaboradores_ids || [];
    const rId = raw.responsable_id; const cId = raw.colaborador_id;
    ev._involvesUser = Boolean((userId && (rId===userId || (Array.isArray(idsUsuarios)&&idsUsuarios.includes(userId)))) || (collabId && (cId===collabId || (Array.isArray(idsColabs)&&idsColabs.includes(collabId)))));
    return ev;
  }
  /* ========== FUNCIONALIDAD DE SCROLL AUTOMÁTICO ========== */
  
  // Función para hacer scroll suave a una sección
  function scrollToSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
      // Calcular la posición considerando el header fijo
      const headerHeight = document.querySelector('.topbar').offsetHeight + 
                          document.querySelector('.nav').offsetHeight;
      const sectionTop = section.offsetTop - headerHeight - 20; // 20px de margen adicional
      
      window.scrollTo({
        top: sectionTop,
        behavior: 'smooth'
      });

      // Agregar efecto de resaltado temporal
      section.classList.add('scroll-highlight');
      
      // Remover el efecto después de 3 segundos
      setTimeout(() => {
        section.classList.remove('scroll-highlight');
      }, 3000);
    }
  }

  // Función para manejar el scroll automático desde URL
  function handleUrlAnchor() {
    const hash = window.location.hash;
    if (hash) {
      // Remover el # del hash
      const sectionId = hash.substring(1);
      
      // Esperar un poco para que la página se cargue completamente
      setTimeout(() => {
        scrollToSection(sectionId);
      }, 300);
    }
  }

  // Manejar anclas de URL al cargar la página
  document.addEventListener('DOMContentLoaded', function() {
    handleUrlAnchor();
  });

  // Escuchar cambios en el hash de la URL
  window.addEventListener('hashchange', function() {
    handleUrlAnchor();
  });

  // También manejar el caso cuando la página se carga directamente con hash
  window.addEventListener('load', function() {
    handleUrlAnchor();
  });
</script>

<script src="{% static 'js/proyectos.js' %}?v=21"></script>
{% endblock %}
```
</script>
</script>