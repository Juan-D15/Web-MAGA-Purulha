{% extends 'base.html' %}
{% load static %}
{% block title %}Gestión de Eventos — MAGA Purulhá{% endblock %}
{% block extra_css %}
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/styles.css' %}?v=2">
  <link rel="stylesheet" href="{% static 'css/gestioneseventos.css' %}?v=13">
  <link rel="stylesheet" href="{% static 'css/proyectos.css' %}">
  <link rel="stylesheet" href="{% static 'css/login-modal.css' %}">
{% endblock %}
{% block nav_gestioneseventos %}active{% endblock %}
{% block content %}
  <!-- ======= MAIN CONTENT ======= -->
  <main class="gestiones-main">
    <div class="gestiones-container">
      <!-- Vista Principal con Tarjetas -->
      <div id="mainView" class="main-view">
        <!-- Tarjetas Principales -->
        <div class="main-cards">
          <div class="main-card" id="createEventCard">
            <div class="card-icon">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </div>
            <h3 class="card-title">Crear Evento</h3>
            <p class="card-description">Crear un nuevo evento de capacitación, entrega o proyecto de ayuda</p>
            <button class="card-button" id="openCreateEventBtn">
              <span>Crear Nuevo</span>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"></path>
              </svg>
            </button>
          </div>

          <div class="main-card" id="manageEventCard">
            <div class="card-icon">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
            </div>
            <h3 class="card-title">Editar y Eliminar Evento</h3>
            <p class="card-description">Gestionar eventos existentes, editar información o eliminar eventos del sistema</p>
            <button class="card-button" id="openManageEventBtn">
              <span>Gestionar</span>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"></path>
              </svg>
            </button>
          </div>

        </div>

        <!-- Sección de Cambios Recientes -->
        <section class="recent-changes-section">
          <div class="changes-container">
            <h2 class="changes-title">Cambios Recientes</h2>
            <div class="changes-log" id="changesLog">
              <div class="change-item" style="text-align: center; color: #6c757d; padding: 20px;">
                <div class="spinner" style="border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid #007bff; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 10px;"></div>
                <p>Cargando cambios recientes...</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Botones de Acción Rápida -->
        <div class="action-buttons-section">
          <a href="{% url 'webmaga:gestionusuarios' %}" class="action-button">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <span>Gestión de Usuarios</span>
          </a>
          <a href="{% url 'webmaga:reportes-index' %}" class="action-button">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14,2 14,8 20,8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10,9 9,9 8,9"></polyline>
            </svg>
            <span>Generar Reporte</span>
          </a>
        </div>
      </div>

      <!-- Vista de Crear Evento -->
      <div id="createEventView" class="create-event-view" style="display: none;">
        <div class="view-header">
          <button class="btn-back" id="backFromCreateBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M12 19l-7-7 7-7"></path>
            </svg>
            Volver
          </button>
          <h2 class="view-title">Crear Nuevo Evento</h2>
        </div>

        <div class="form-container">
          <form id="eventForm" class="event-form" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Nombre del Evento -->
            <div class="form-group">
              <label for="eventName" class="form-label">Nombre del Evento *</label>
              <input type="text" id="eventName" name="nombre" class="form-input" placeholder="Ingrese el nombre del evento" required>
            </div>

            <!-- Imagen de Portada -->
            <div class="form-group">
              <label class="form-label">Imagen de Portada</label>
              <div class="file-upload" id="coverUploadContainer">
                <input type="file" id="coverFileInput" accept="image/*" class="file-input">
                <label for="coverFileInput" class="file-label" style="flex-direction: column; gap: 6px;">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="14" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="7.5" r="1.5"></circle>
                    <path d="M21 15l-5-5L5 21"></path>
                  </svg>
                  <span>Seleccionar imagen (PNG, JPG)</span>
                  <small style="color: #6c757d;">Solo se admite una imagen; reemplaza la actual al volver a seleccionar.</small>
                </label>
              </div>
              <div id="coverPreviewWrapper" style="display: none; align-items: center; gap: 16px; margin-top: 12px;">
                <img id="coverImagePreview" src="" alt="Portada del evento" style="max-width: 220px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                <button type="button" id="coverRemoveBtn" class="btn-danger btn-cover-remove" style="display: none;">
                  Eliminar
                </button>
              </div>
            </div>

            <!-- Tipo de Evento -->
            <div class="form-group">
              <label for="eventType" class="form-label">Tipo de Evento *</label>
              <select id="eventType" name="tipo_actividad_id" class="form-select" required>
                <option value="">Seleccione un tipo de evento</option>
                {% for tipo in tipos_actividad %}
                  <option value="{{ tipo.id }}">{{ tipo.nombre }}</option>
                {% endfor %}
              </select>
            </div>
            
            <!-- Regiones y Comunidades -->
            <div class="form-group">
              <label class="form-label">Regiones y Comunidades *</label>
              <div class="community-selector">
                <button type="button" id="addCommunityBtn" class="beneficiary-label" style="display: inline-flex; align-items: center; gap: 8px;">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 5 17 10"/>
                    <line x1="12" y1="5" x2="12" y2="19"/>
                  </svg>
                  <span>Agregar Región / Comunidad</span>
                </button>

                <div id="communitiesSection" style="margin-top: 16px; display: none;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                    <h4 style="margin: 0; font-size: 0.95rem; color: #ffffff; font-weight: 600;">Comunidades seleccionadas</h4>
                    <div id="communityCount" style="font-size: 0.9rem; color: #007bff; font-weight: 600;"></div>
                  </div>
                  <div id="communitiesContainer"></div>
                </div>
              </div>
            </div>
            
            <!-- Fecha -->
            <div class="form-group">
              <label for="fecha" class="form-label">Fecha del Evento *</label>
              <input type="date" id="fecha" name="fecha" class="form-input" required>
            </div>
            
            <!-- Estado -->
            <div class="form-group">
              <label for="estado" class="form-label">Estado *</label>
              <select id="estado" name="estado" class="form-select" required>
                <option value="planificado" selected>Planificado</option>
                <option value="en_progreso">En Progreso</option>
                <option value="completado">Completado</option>
              </select>
            </div>


            <!-- Personal a Cargo -->
            <div class="form-group">
              <label class="form-label">Personal a Cargo</label>
              <div class="personnel-selector">
                <div class="personnel-search">
                  <input type="text" id="personnelSearch" class="form-input" placeholder="Buscar personal...">
                  <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                  </svg>
                </div>
                <div class="personnel-list" id="personnelList">
                  <!-- El personal se cargará dinámicamente -->
                </div>
                <div class="selected-personnel" id="selectedPersonnel">
                  <span class="selected-count">0 personal seleccionado</span>
                </div>
              </div>
            </div>

            <!-- Descripción del Evento -->
            <div class="form-group">
              <label for="eventDescription" class="form-label">Descripción del Evento *</label>
              <textarea id="eventDescription" name="descripcion" class="form-textarea" rows="5" placeholder="Describa los detalles del evento, objetivos, metodología, etc." required></textarea>
            </div>

            <!-- Beneficiarios (PRIMERO) -->
            <div class="form-group">
              <label for="beneficiaries" class="form-label">Beneficiarios del Evento</label>
              
              <!-- Área de agregar beneficiarios -->
              <div class="beneficiary-upload">
                <button type="button" id="addBeneficiaryBtn" class="beneficiary-label">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="8.5" cy="7" r="4"></circle>
                    <line x1="20" y1="8" x2="20" y2="14"></line>
                    <line x1="23" y1="11" x2="17" y2="11"></line>
                  </svg>
                  <span>Agregar Beneficiario</span>
                </button>
              </div>
              
              <!-- Área de beneficiarios agregados (separada) -->
              <div id="beneficiariesSection" style="margin-top: 16px; display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                  <h4 style="margin: 0; font-size: 0.95rem; color: #ffffff; font-weight: 600;">Beneficiarios Agregados</h4>
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <div id="beneficiaryCount" style="font-size: 0.9rem; color: #007bff; font-weight: 600;"></div>
                    <button type="button" id="toggleBeneficiariesListBtn" class="beneficiaries-toggle-btn" title="Ocultar/Mostrar lista">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="18 15 12 9 6 15"></polyline>
                      </svg>
                    </button>
                  </div>
                </div>
                <!-- Buscador de beneficiarios -->
                <div class="beneficiaries-search-container" style="margin-bottom: 12px;">
                  <div class="beneficiaries-search-wrapper">
                    <svg class="beneficiaries-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="11" cy="11" r="8"></circle>
                      <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input type="text" id="beneficiariesSearchInput" class="beneficiaries-search-input" placeholder="Buscar por nombre, DPI o teléfono...">
                    <button type="button" id="beneficiariesSearchClearBtn" class="beneficiaries-search-clear-btn" style="display: none;" title="Limpiar búsqueda">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                      </svg>
                    </button>
                  </div>
                </div>
                <!-- Filtros de beneficiarios -->
                <div class="beneficiaries-filters">
                  <div class="beneficiaries-filter">
                    <label for="beneficiariesFilterType" class="form-label">Tipo de beneficiario</label>
                    <select id="beneficiariesFilterType" class="form-select">
                      <option value="">Todos los tipos</option>
                      <option value="individual">Individual</option>
                      <option value="familia">Familia</option>
                      <option value="institucion">Institución</option>
                      <option value="otro">Otro</option>
                    </select>
                  </div>
                  <div class="beneficiaries-filter">
                    <label for="beneficiariesFilterRegion" class="form-label">Región</label>
                    <select id="beneficiariesFilterRegion" class="form-select">
                      <option value="">Todas las regiones</option>
                    </select>
                  </div>
                  <div class="beneficiaries-filter">
                    <label for="beneficiariesFilterCommunity" class="form-label">Comunidad</label>
                    <select id="beneficiariesFilterCommunity" class="form-select">
                      <option value="">Todas las comunidades</option>
                    </select>
                  </div>
                </div>
                <!-- Contenedor con scroll limitado -->
                <div id="beneficiariesContainerWrapper" class="beneficiaries-container-wrapper">
                  <div id="beneficiariesContainer"></div>
                </div>
              </div>
            </div>

            <!-- Datos Rápidos del Proyecto (DESPUÉS) -->
            <div class="form-group">
              <label class="form-label">Datos del Proyecto</label>
              <div class="beneficiary-upload">
                <button type="button" id="addQuickDataBtn" class="beneficiary-label">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="12" y1="18" x2="12" y2="12"></line>
                    <line x1="9" y1="15" x2="15" y2="15"></line>
                  </svg>
                  <span>Agregar dato del proyecto</span>
                </button>
              </div>

              <div id="quickDataSection" style="display: none; margin-top: 14px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 6px; border-bottom: 1px solid rgba(255, 255, 255, 0.08);">
                  <h4 style="margin: 0; color: #ffffff; font-size: 0.95rem; font-weight: 600;">Datos Registrados</h4>
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <span id="quickDataCount" style="color: #0d6efd; font-size: 0.85rem; font-weight: 600;"></span>
                    <button type="button" id="toggleProjectDataListBtn" class="beneficiaries-toggle-btn" title="Ocultar/Mostrar lista">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="18 15 12 9 6 15"></polyline>
                      </svg>
                    </button>
                  </div>
                </div>
                <div id="projectDataContainerWrapper" class="beneficiaries-container-wrapper">
                  <div id="quickDataContainer" style="display: flex; flex-direction: column; gap: 10px;"></div>
                </div>
              </div>
            </div>
            
            <!-- Evidencias -->
            <div class="form-group">
              <label for="evidences" class="form-label">Evidencias (Fotos y Documentos)</label>
              
              <!-- Área de carga de archivos -->
              <div class="file-upload">
                <input type="file" id="evidences" name="evidences" multiple accept="image/*,application/pdf,.doc,.docx" class="file-input">
                <label for="evidences" class="file-label">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14,2 14,8 20,8"></polyline>
                  </svg>
                  <span>Seleccionar archivos (múltiples)</span>
                </label>
              </div>
              
              <!-- Área de archivos seleccionados (separada) -->
              <div id="filesSection" style="margin-top: 16px; display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                  <h4 style="margin: 0; font-size: 0.95rem; color: #b8c5d1; font-weight: 600;">Archivos Seleccionados</h4>
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <div id="fileCount" style="font-size: 0.9rem; color: #007bff; font-weight: 600;"></div>
                    <button type="button" id="toggleEvidencesListBtn" class="beneficiaries-toggle-btn" title="Ocultar/Mostrar lista">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="18 15 12 9 6 15"></polyline>
                      </svg>
                    </button>
                  </div>
                </div>
                <div id="evidencesContainerWrapper" class="beneficiaries-container-wrapper">
                  <div class="file-preview" id="filePreview"></div>
                </div>
              </div>
            </div>

            <!-- Botones de Acción -->
            <div class="form-actions">
              <button type="submit" class="btn-primary btn-create-event">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Crear Evento
              </button>
              <button type="button" id="viewNewEventBtn" class="btn-secondary btn-view-event" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
                Ver Evento Nuevo
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Vista de Gestionar Eventos -->
      <div id="manageEventView" class="manage-event-view" style="display: none;">
        <div class="view-header">
          <button class="btn-back" id="backFromManageBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M12 19l-7-7 7-7"></path>
            </svg>
            Volver
          </button>
          <h2 class="view-title">Gestionar Eventos</h2>
        </div>

        <!-- Buscador de eventos -->
        <div class="event-search-container">
          <div class="event-search-wrapper">
            <svg class="event-search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input type="text" id="eventSearchInput" class="event-search-input" placeholder="Buscar evento por nombre...">
            <button type="button" id="eventSearchClearBtn" class="event-search-clear-btn" style="display: none;" title="Limpiar búsqueda">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>

        <div class="events-list-container">
          <h3 class="events-list-title">Eventos Existentes</h3>
          <p class="events-list-description">Gestionar eventos creados anteriormente</p>
          
          <div class="events-list" id="eventsList">
            <!-- Los eventos se cargarán dinámicamente desde la base de datos -->
            <div style="text-align: center; padding: 60px 20px; color: #6c757d;">
              <div style="margin-bottom: 20px;">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.5;">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="12" y1="8" x2="12" y2="12"></line>
                  <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
              </div>
              <p style="font-size: 1.1rem; margin: 0;">Cargando eventos...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Modal de Confirmación de Eliminación -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Confirmar Eliminación</h3>
        <button class="modal-close" id="closeModal">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p class="modal-message">¿Estás seguro de que deseas eliminar este evento?</p>
        <p class="modal-submessage">Para realizar este proceso, ingrese sus credenciales de administrador.</p>
        
        <div class="modal-form">
          <div class="form-group">
            <label for="adminUsername" class="form-label">Usuario</label>
            <input type="text" id="adminUsername" name="adminUsername" class="form-input" placeholder="Ingrese su usuario">
          </div>
          <div class="form-group">
            <label for="adminPassword" class="form-label">Contraseña</label>
            <input type="password" id="adminPassword" name="adminPassword" class="form-input" placeholder="Ingrese su contraseña">
          </div>
          <div id="credentialError" class="error-message" style="display: none;">
            Credenciales incorrectas. Intente nuevamente.
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" id="cancelDeleteBtn" class="btn-secondary">Cancelar</button>
        <button type="button" id="confirmDeleteBtn" class="btn-danger" style="display: none;">Confirmar Eliminación</button>
      </div>
    </div>
  </div>

  <!-- Vista de Edición de Evento (Pantalla Completa) -->
  <div id="editEventView" class="edit-event-view" style="display: none;">
    <div class="edit-event-container">
      <!-- Header de Edición -->
      <div class="edit-event-header">
        <div class="edit-event-title">
          <h2>Editar Evento</h2>
          <p id="editEventName">Nombre del Evento</p>
        </div>
        <div class="edit-event-actions">
          <button type="button" id="applyChangesBtn" class="btn-primary btn-apply-changes">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            Aplicar Cambios
          </button>
          <button type="button" id="backFromEditBtn" class="btn-secondary btn-back-edit">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M12 19l-7-7 7-7"></path>
            </svg>
            Volver
          </button>
        </div>
      </div>

      <!-- Formulario de Edición -->
      <div class="edit-event-content">
        <form id="editEventForm" class="edit-event-form">
          <!-- Nombre del Evento -->
          <div class="form-group">
            <label for="editEventName" class="form-label">Nombre del Evento</label>
            <input type="text" id="editEventName" name="editEventName" class="form-input" required>
          </div>

          <!-- Tipo de Evento -->
          <div class="form-group">
            <label for="editEventType" class="form-label">Tipo de Evento</label>
            <select id="editEventType" name="editEventType" class="form-select" required>
              <option value="">Seleccione un tipo de evento</option>
              <option value="capacitacion">Capacitación</option>
              <option value="entrega">Entrega</option>
              <option value="proyecto-ayuda">Proyecto de Ayuda</option>
              <option value="otro">Otro</option>
            </select>
          </div>

          <!-- Comunidades Afectadas -->
          <div class="form-group">
            <label class="form-label">Comunidades Afectadas</label>
            <div class="communities-selector">
              <div class="communities-search">
                <input type="text" id="editCommunitySearch" class="form-input" placeholder="Buscar comunidad...">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
              </div>
              <div class="communities-list" id="editCommunitiesList">
                <!-- Las comunidades se cargarán dinámicamente -->
              </div>
              <div class="selected-communities" id="editSelectedCommunities">
                <span class="selected-count">0 comunidades seleccionadas</span>
              </div>
            </div>
          </div>

          <!-- Personal a Cargo -->
          <div class="form-group">
            <label class="form-label">Personal a Cargo</label>
            <div class="personnel-selector">
              <div class="personnel-search">
                <input type="text" id="editPersonnelSearch" class="form-input" placeholder="Buscar personal...">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
              </div>
              <div class="personnel-list" id="editPersonnelList">
                <!-- El personal se cargará dinámicamente -->
              </div>
              <div class="selected-personnel" id="editSelectedPersonnel">
                <span class="selected-count">0 personal seleccionado</span>
              </div>
            </div>
          </div>

          <!-- Descripción del Evento -->
          <div class="form-group">
            <label for="editEventDescription" class="form-label">Descripción del Evento</label>
            <textarea id="editEventDescription" name="editEventDescription" class="form-textarea" rows="5" required></textarea>
          </div>

          <!-- Beneficiarios -->
          <div class="form-group">
            <label class="form-label">Beneficiarios</label>
            <div class="beneficiaries-container" id="editBeneficiariesContainer">
              <!-- Los beneficiarios se cargarán dinámicamente -->
            </div>
            <button type="button" id="editAddBeneficiaryBtn" class="btn-add-beneficiary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Agregar Beneficiario
            </button>
          </div>

          <!-- Evidencias -->
          <div class="form-group">
            <label for="editEvidences" class="form-label">Evidencias (Fotos y Documentos)</label>
            <div class="file-upload">
              <input type="file" id="editEvidences" name="editEvidences" multiple accept="image/*,application/pdf,.doc,.docx" class="file-input">
              <label for="editEvidences" class="file-label">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14,2 14,8 20,8"></polyline>
                </svg>
                <span>Seleccionar archivos</span>
              </label>
              <div class="file-preview" id="editFilePreview"></div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmación para Volver -->
  <div id="backConfirmModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Confirmar Acción</h3>
        <button class="modal-close" id="closeBackModal">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p class="modal-message">¿Estás seguro de que deseas volver sin guardar los cambios?</p>
        <p class="modal-submessage">Los cambios realizados se perderán si no se aplican.</p>
      </div>
      <div class="modal-footer">
        <button type="button" id="cancelBackBtn" class="btn-secondary">Cancelar</button>
        <button type="button" id="confirmBackBtn" class="btn-danger">Volver sin Guardar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmación para Aplicar Cambios -->
  <div id="applyConfirmModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Confirmar Cambios</h3>
        <button class="modal-close" id="closeApplyModal">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p class="modal-message">¿Estás seguro de que deseas aplicar estos cambios al evento?</p>
        <p class="modal-submessage">Esta acción actualizará permanentemente la información del evento.</p>
      </div>
      <div class="modal-footer">
        <button type="button" id="cancelApplyBtn" class="btn-secondary">Cancelar</button>
        <button type="button" id="confirmApplyBtn" class="btn-primary">Aplicar Cambios</button>
      </div>
    </div>
  </div>

  <!-- Modal para Agregar Comunidades -->
  <div id="addCommunityModal" class="modal">
    <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
      <div class="modal-header">
        <h3 class="modal-title">Agregar Comunidades</h3>
        <button class="modal-close" id="closeCommunityModal" type="button">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body" style="padding: 24px; display: flex; flex-direction: column; gap: 20px; max-height: calc(90vh - 140px); overflow: visible;">
        <div style="display: flex; flex-direction: column; gap: 20px; flex-shrink: 0;">
          <div class="form-group" style="display: flex !important; flex-direction: column !important; gap: 8px !important; width: 100% !important; flex-shrink: 0 !important; min-height: auto !important; margin: 0 !important;">
            <label for="community_region_select" class="form-label community-region-label" style="display: none;">Región</label>
            <select id="community_region_select" class="form-select community-region-select" style="display: none;">
              <option value="">Todas las regiones</option>
            </select>
          </div>
          <div class="form-group" style="display: flex !important; flex-direction: column !important; gap: 8px !important; width: 100% !important; flex-shrink: 0 !important; min-height: auto !important; margin: 0 !important;">
            <label for="community_search_input" class="form-label" style="display: block !important; font-weight: 600 !important; color: #ffffff !important; font-size: 15px !important; margin: 0 0 8px 0 !important; visibility: visible !important; opacity: 1 !important;">Buscar comunidad</label>
            <input type="text" id="community_search_input" class="form-input" placeholder="Buscar por nombre o código" style="width: 100% !important; padding: 12px 16px !important; border: 1px solid rgba(255, 255, 255, 0.15) !important; border-radius: 8px !important; background: #ffffff !important; color: #1b2333 !important; font-size: 16px !important; display: block !important; visibility: visible !important; opacity: 1 !important; height: auto !important; min-height: 44px !important;">
          </div>
        </div>
        <div id="community_list_container" style="display: grid !important; gap: 8px !important; flex: 1 !important; overflow-y: auto !important; min-height: 200px !important; max-height: calc(90vh - 350px) !important; padding-right: 8px;"></div>
      </div>
      <div class="modal-footer">
        <button type="button" id="cancelCommunityBtn" class="btn-secondary">Cancelar</button>
        <button type="button" id="confirmCommunityBtn" class="btn-primary">Agregar seleccionadas</button>
      </div>
    </div>
  </div>

  <!-- Modal para Agregar Beneficiario -->
  <div id="addBeneficiaryModal" class="modal">
    <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
      <div class="modal-header">
        <h3 class="modal-title">Agregar Beneficiario</h3>
        <button class="modal-close" id="closeBeneficiaryModal" type="button">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body" style="position: relative; z-index: 0;">
        <div class="benef-mode-toggle" style="display:flex; gap:8px; margin-bottom:16px;">
          <button type="button" class="benef-mode-btn active" data-mode="nuevo" style="flex:1; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.1); background:rgba(76, 175, 80, 0.2); color:#ffffff; font-weight:700; cursor:pointer;">Registrar nuevo</button>
          <button type="button" class="benef-mode-btn" data-mode="existente" style="flex:1; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.1); background:rgba(255,255,255,0.05); color:#ffffff; font-weight:700; cursor:pointer;">Buscar existente</button>
        </div>

        <div id="benef_nuevo_section">
        <div class="beneficiaries-search-container" style="margin-bottom: 16px;">
          <div class="beneficiaries-search-wrapper">
            <svg class="beneficiaries-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input type="text" id="benef_nuevo_catalog_input" class="beneficiaries-search-input" placeholder="Ej: Barrio Las Moras o Región 1" autocomplete="off">
            <button type="button" id="benef_nuevo_catalog_clear" class="beneficiaries-search-clear-btn" style="display: none;" title="Limpiar búsqueda">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
            <ul id="benef_nuevo_catalog_suggestions" class="input-suggestions"></ul>
          </div>
        </div>

        <form id="beneficiaryForm">
          <div class="form-row">
            <div class="form-group" style="flex: 1;">
              <label for="benef_region_select" class="form-label">Región *</label>
              <select id="benef_region_select" class="form-select" required>
                <option value="">Seleccione una región</option>
              </select>
            </div>
            <div class="form-group" style="flex: 1;">
              <label for="benef_comunidad_select" class="form-label">Comunidad *</label>
              <select id="benef_comunidad_select" class="form-select" required>
                <option value="">Seleccione una comunidad</option>
              </select>
              <small style="color: #6c757d;">Selecciona la comunidad a la que pertenece el beneficiario.</small>
            </div>
          </div>

          <!-- Tipo de Beneficiario -->
          <div class="form-group">
            <label for="benef_tipo" class="form-label">Tipo de Beneficiario *</label>
            <select id="benef_tipo" class="form-select" required>
              <option value="">Seleccione un tipo</option>
              <option value="individual">Individual</option>
              <option value="familia">Familia</option>
              <option value="institución">Institución</option>
              <option value="otro">Otro</option>
            </select>
          </div>

          <!-- Campos para Individual -->
          <div id="campos_individual" style="display: none;">
            <div class="form-group">
              <label for="benef_ind_nombre" class="form-label">Nombre *</label>
              <input type="text" id="benef_ind_nombre" class="form-input" pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+" placeholder="Ej: Juan" required>
              <small style="color: #6c757d;">Solo letras y espacios</small>
            </div>
            <div class="form-group">
              <label for="benef_ind_apellido" class="form-label">Apellido *</label>
              <input type="text" id="benef_ind_apellido" class="form-input" pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+" placeholder="Ej: Pérez García" required>
              <small style="color: #6c757d;">Solo letras y espacios</small>
            </div>
            <div class="form-group">
              <label for="benef_ind_dpi" class="form-label">DPI</label>
              <input type="text" id="benef_ind_dpi" class="form-input" maxlength="13" pattern="[0-9]{13}" placeholder="Ej: 1234567890101">
              <small style="color: #6c757d;">Debe tener exactamente 13 números</small>
            </div>
            <div class="form-group">
              <label for="benef_ind_fecha_nac" class="form-label">Fecha de Nacimiento</label>
              <input type="date" id="benef_ind_fecha_nac" class="form-input">
            </div>
            <div class="form-group">
              <label for="benef_ind_genero" class="form-label">Género *</label>
              <select id="benef_ind_genero" class="form-select" required>
                <option value="">Seleccione</option>
                <option value="masculino">Masculino</option>
                <option value="femenino">Femenino</option>
                <option value="otro">Otro</option>
              </select>
            </div>
            <div class="form-group">
              <label for="benef_ind_telefono" class="form-label">Teléfono</label>
              <input type="tel" id="benef_ind_telefono" class="form-input" maxlength="8" pattern="[0-9]{8}" placeholder="Ej: 55123456">
              <small style="color: #6c757d;">Debe tener exactamente 8 números</small>
            </div>
          </div>

          <!-- Campos para Familia -->
          <div id="campos_familia" style="display: none;">
            <div class="form-group">
              <label for="benef_fam_nombre" class="form-label">Nombre de la Familia *</label>
              <input type="text" id="benef_fam_nombre" class="form-input" placeholder="Ej: Familia González" required>
            </div>
            <div class="form-group">
              <label for="benef_fam_jefe" class="form-label">Jefe de Familia *</label>
              <input type="text" id="benef_fam_jefe" class="form-input" pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+" placeholder="Ej: Pedro González Ramírez" required>
              <small style="color: #6c757d;">Solo letras y espacios</small>
            </div>
            <div class="form-group">
              <label for="benef_fam_dpi" class="form-label">DPI del Jefe de Familia</label>
              <input type="text" id="benef_fam_dpi" class="form-input" maxlength="13" pattern="[0-9]{13}" placeholder="Ej: 4567890123104">
              <small style="color: #6c757d;">Debe tener exactamente 13 números</small>
            </div>
            <div class="form-group">
              <label for="benef_fam_telefono" class="form-label">Teléfono</label>
              <input type="tel" id="benef_fam_telefono" class="form-input" maxlength="8" pattern="[0-9]{8}" placeholder="Ej: 55456789">
              <small style="color: #6c757d;">Debe tener exactamente 8 números</small>
            </div>
            <div class="form-group">
              <label for="benef_fam_miembros" class="form-label">Número de Miembros *</label>
              <input type="number" id="benef_fam_miembros" class="form-input" min="1" max="999" placeholder="Ej: 5" required>
              <small style="color: #6c757d;">Número positivo (máximo 999)</small>
            </div>
          </div>

          <!-- Campos para Institución -->
          <div id="campos_institucion" style="display: none;">
            <div class="form-group">
              <label for="benef_inst_nombre" class="form-label">Nombre de la Institución *</label>
              <input type="text" id="benef_inst_nombre" class="form-input" placeholder="Ej: Escuela Rural Mixta" required>
            </div>
            <div class="form-group">
              <label for="benef_inst_tipo" class="form-label">Tipo de Institución *</label>
              <select id="benef_inst_tipo" class="form-select">
                <option value="">Seleccione</option>
                <option value="escuela">Escuela</option>
                <option value="cooperativa">Cooperativa</option>
                <option value="asociación">Asociación</option>
                <option value="ONG">ONG</option>
                <option value="iglesia">Iglesia</option>
                <option value="otro">Otro</option>
              </select>
            </div>
            <div class="form-group">
              <label for="benef_inst_representante" class="form-label">Representante Legal *</label>
              <input type="text" id="benef_inst_representante" class="form-input" pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+" placeholder="Ej: Carmen Ramírez" required>
              <small style="color: #6c757d;">Solo letras y espacios</small>
            </div>
            <div class="form-group">
              <label for="benef_inst_dpi_rep" class="form-label">DPI del Representante</label>
              <input type="text" id="benef_inst_dpi_rep" class="form-input" maxlength="13" pattern="[0-9]{13}" placeholder="Ej: 7890123456107">
              <small style="color: #6c757d;">Debe tener exactamente 13 números</small>
            </div>
            <div class="form-group">
              <label for="benef_inst_telefono" class="form-label">Teléfono</label>
              <input type="tel" id="benef_inst_telefono" class="form-input" maxlength="8" pattern="[0-9]{8}" placeholder="Ej: 55789012">
              <small style="color: #6c757d;">Debe tener exactamente 8 números</small>
            </div>
            <div class="form-group">
              <label for="benef_inst_email" class="form-label">Email</label>
              <input type="email" id="benef_inst_email" class="form-input" pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" placeholder="Ej: contacto@institucion.org">
              <small style="color: #6c757d;">Formato: ejemplo@dominio.com</small>
            </div>
            <div class="form-group">
              <label for="benef_inst_num_beneficiarios" class="form-label">Número de Beneficiarios Directos *</label>
              <input type="number" id="benef_inst_num_beneficiarios" class="form-input" min="1" max="99999" placeholder="Ej: 150" required>
              <small style="color: #6c757d;">Número positivo (máximo 99999)</small>
            </div>
          </div>

          <!-- Campos para Otro -->
          <div id="campos_otro" style="display: none;">
            <div class="form-group">
              <label for="benef_otro_nombre" class="form-label">Nombre/Descripción *</label>
              <input type="text" id="benef_otro_nombre" class="form-input" placeholder="Ej: Grupo Comunitario" required>
            </div>
            <div class="form-group">
              <label for="benef_otro_tipo_desc" class="form-label">Especifique el Tipo *</label>
              <input type="text" id="benef_otro_tipo_desc" class="form-input" placeholder="Ej: Grupo juvenil, Comité local, etc." required>
            </div>
            <div class="form-group">
              <label for="benef_otro_contacto" class="form-label">Persona de Contacto *</label>
              <input type="text" id="benef_otro_contacto" class="form-input" pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+" placeholder="Ej: Nombre del responsable" required>
              <small style="color: #6c757d;">Solo letras y espacios</small>
            </div>
            <div class="form-group">
              <label for="benef_otro_telefono" class="form-label">Teléfono</label>
              <input type="tel" id="benef_otro_telefono" class="form-input" maxlength="8" pattern="[0-9]{8}" placeholder="Ej: 55901234">
              <small style="color: #6c757d;">Debe tener exactamente 8 números</small>
            </div>
            <div class="form-group">
              <label for="benef_otro_descripcion" class="form-label">Descripción Adicional *</label>
              <textarea id="benef_otro_descripcion" class="form-textarea" rows="3" placeholder="Información adicional sobre este beneficiario" required></textarea>
            </div>
          </div>
        </form>
        </div>

        <div id="benef_existente_section" style="display:none;">
          <div class="form-group" style="display: grid; gap: 14px;">
            <label class="form-label" style="margin-bottom: 0;">Filtros de búsqueda</label>
            <div style="display: grid; gap: 10px;">
              <div class="suggestions-wrapper">
                <label for="benef_search_catalog_input" class="form-label">Buscar comunidad o región</label>
                <input type="text" id="benef_search_catalog_input" class="form-input form-input-suggestive" placeholder="Ej: Barrio Las Moras o Región 1" autocomplete="off" style="width: 100%;">
                <ul id="benef_search_catalog_suggestions" class="input-suggestions"></ul>
              </div>
              <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <div style="flex: 1 1 220px;">
                  <label for="benef_search_region" class="form-label">Región</label>
                  <select id="benef_search_region" class="form-select">
                    <option value="">Todas las regiones</option>
                  </select>
                </div>
                <div style="flex: 1 1 220px;">
                  <label for="benef_search_comunidad" class="form-label">Comunidad</label>
                  <select id="benef_search_comunidad" class="form-select">
                    <option value="">Todas las comunidades</option>
                  </select>
                </div>
                <div style="flex: 1 1 220px;">
                  <label for="benef_search_tipo" class="form-label">Tipo de beneficiario</label>
                  <select id="benef_search_tipo" class="form-select">
                    <option value="">Todos los tipos</option>
                    <option value="individual">Individual</option>
                    <option value="familia">Familia</option>
                    <option value="institución">Institución</option>
                    <option value="otro">Otro</option>
                  </select>
                </div>
              </div>
              <div>
                <label for="benef_search_input" class="form-label">Buscar beneficiario</label>
                <input type="text" id="benef_search_input" class="form-input" placeholder="Ingresa nombre, DPI, comunidad o tipo... (opcional)">
              </div>
            </div>
            <small style="color:#b8c5d1;">Puedes combinar filtros o escribir en el buscador para refinar los resultados.</small>
          </div>
          <div id="benef_search_status" style="display:none; color:#b8c5d1; font-size:0.9rem; margin-bottom:10px;"></div>
          <div id="benef_search_results" class="benef-search-results" style="display:grid; gap:10px;"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" id="cancelBeneficiaryBtn" class="btn-secondary">Cancelar</button>
        <button type="button" id="saveBeneficiaryBtn" class="btn-primary">Agregar Beneficiario</button>
      </div>
    </div>
  </div>

  <!-- Modal para Ver Detalles del Beneficiario -->
  <div id="beneficiaryDetailsModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
      <div class="modal-header">
        <h3 class="modal-title">Detalles del Beneficiario</h3>
        <button class="modal-close" id="closeBeneficiaryDetailsModal" type="button">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body" style="padding: 24px;">
        <div id="beneficiaryDetailsContent">
          <!-- El contenido se cargará dinámicamente -->
          <div style="text-align: center; padding: 40px; color: #6c757d;">
            <div style="margin-bottom: 16px;">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.5;">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
            </div>
            <p>Cargando detalles del beneficiario...</p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" id="closeBeneficiaryDetailsBtn" class="btn-secondary">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmación de Eliminación -->
  <div id="confirmDeleteModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3 class="modal-title">⚠️ Confirmar Eliminación</h3>
        <button class="modal-close" id="closeConfirmDeleteModal" type="button">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p style="color: var(--text-primary); margin-bottom: 1.5rem; font-size: 1rem;">
          Estás a punto de eliminar el evento: <strong id="deleteEventName"></strong>
        </p>
        <p style="color: var(--danger); margin-bottom: 1.5rem; font-size: 0.95rem;">
          Esta acción requiere autorización de administrador. Por favor, ingresa tus credenciales:
        </p>
        
        <form id="confirmDeleteForm">
          <div class="form-group">
            <label for="delete_username" class="form-label">Usuario *</label>
            <input type="text" id="delete_username" class="form-input" placeholder="Tu usuario" required autocomplete="username">
          </div>
          
          <div class="form-group">
            <label for="delete_password" class="form-label">Contraseña *</label>
            <input type="password" id="delete_password" class="form-input" placeholder="Tu contraseña" required autocomplete="current-password">
          </div>
          
          <div id="deleteErrorMessage" style="display: none; color: var(--danger); padding: 0.75rem; background: rgba(244, 67, 54, 0.1); border-radius: 6px; margin-top: 1rem; font-size: 0.9rem;"></div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" id="cancelDeleteBtn" class="btn-secondary">Cancelar</button>
        <button type="button" id="executeDeleteBtn" class="btn-danger">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
          Eliminar Evento
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Datos del Proyecto (con tarjetas predefinidas y personalizadas) -->
  <div id="quickDataModal" class="modal" style="display: none;">
    <div class="modal-content edit-data-modal" style="max-width: 800px;">
      <div class="modal-header">
        <h3 class="modal-title">Editar Datos del Proyecto</h3>
        <button class="modal-close" id="closeQuickDataModal">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <!-- Pestañas -->
        <div class="edit-data-tabs">
          <button class="tab-btn active" data-tab="predefined">Tarjetas Predefinidas</button>
          <button class="tab-btn" data-tab="custom">Crear Personalizada</button>
        </div>

        <!-- Pestaña de Tarjetas Predefinidas -->
        <div class="tab-content active" id="predefined-tab-event">
          <div class="search-container">
            <input type="text" id="cardSearchEvent" class="form-input" placeholder="Buscar tarjetas...">
          </div>
          
          <div class="category-filter">
            <label for="categoryFilterEvent" class="form-label">Filtrar por categoría:</label>
            <select id="categoryFilterEvent" class="form-select">
              <option value="">Todas las categorías</option>
              <option value="General">General</option>
              <option value="Financiero">Financiero</option>
              <option value="Físico">Físico</option>
              <option value="Institucional">Institucional</option>
              <option value="Educativo">Educativo</option>
              <option value="Social">Social</option>
              <option value="Recursos">Recursos</option>
              <option value="Temporal">Temporal</option>
              <option value="Técnico">Técnico</option>
              <option value="Evaluación">Evaluación</option>
              <option value="Ambiental">Ambiental</option>
            </select>
          </div>

          <div class="predefined-cards-grid" id="predefinedCardsGridEvent">
            <!-- Las tarjetas predefinidas se cargarán aquí dinámicamente -->
          </div>
        </div>

        <!-- Pestaña de Crear Personalizada -->
        <div class="tab-content" id="custom-tab-event">
          <div class="form-group">
            <label for="customIconEvent" class="form-label">Emoji/Icono</label>
            <input type="text" id="customIconEvent" class="form-input" placeholder="Ej: 🌱" maxlength="2">
          </div>
          <div class="form-group">
            <label for="customLabelEvent" class="form-label">Título de la Tarjeta</label>
            <input type="text" id="customLabelEvent" class="form-input" placeholder="Ej: Sostenibilidad">
          </div>
          <div class="form-group">
            <label for="customValueEvent" class="form-label">Valor/Dato</label>
            <input type="text" id="customValueEvent" class="form-input" placeholder="Ej: 5 años">
          </div>
          <button type="button" id="addCustomCardBtnEvent" class="btn-primary">Agregar Tarjeta Personalizada</button>
        </div>

        <!-- Tarjetas Seleccionadas -->
        <div class="selected-cards-section">
          <h4 class="section-title">Tarjetas Seleccionadas</h4>
          <div class="selected-cards-container" id="selectedCardsContainerEvent">
            <!-- Las tarjetas seleccionadas se mostrarán aquí -->
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" id="cancelQuickDataBtn" class="btn-secondary">Cancelar</button>
        <button type="button" id="saveQuickDataBtn" class="btn-primary">Guardar Cambios</button>
      </div>
    </div>
  </div>

  <!-- Modal para editar fecha de comunidad -->
  <div id="editCommunityDateModal" class="modal">
    <div class="modal-content" style="max-width: 420px;">
      <div class="modal-header">
        <h3 class="modal-title">Editar fecha de agregación</h3>
        <button class="modal-close" id="closeEditCommunityDateModal" type="button">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body" style="display:flex; flex-direction:column; gap:16px;">
        <p style="color:#94a3b8; font-size:0.95rem;">Selecciona la nueva fecha en formato YYYY-MM-DD.</p>
        <div class="form-group">
          <label for="community_date_input" class="form-label">Fecha</label>
          <input type="date" id="community_date_input" class="form-input">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" id="cancelEditCommunityDateBtn" class="btn-secondary">Cancelar</button>
        <button type="button" id="confirmEditCommunityDateBtn" class="btn-primary">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Detalles del Cambio -->
  <div id="changeDetailsModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3 class="modal-title">Detalles del Cambio</h3>
        <button class="modal-close" onclick="cerrarDetallesCambio()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div style="margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; flex-wrap: wrap;">
            <div class="change-time">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              <span id="changeDetailsDate">-</span>
            </div>
            <span id="changeDetailsEliminado" class="label-eliminado" style="display: none;">ELIMINADO</span>
          </div>
          <h4 style="color: var(--text-primary); margin: 0 0 8px 0; font-size: 1.1rem; font-weight: 600;" id="changeDetailsTitle">-</h4>
          <p style="color: var(--text-secondary); margin: 0 0 16px 0; font-size: 0.9rem;">
            <strong>Responsable:</strong> <span id="changeDetailsResponsible">-</span>
          </p>
        </div>
        <div style="background: rgba(255, 255, 255, 0.03); padding: 16px; border-radius: 8px; border-left: 3px solid var(--text-accent);">
          <p style="color: var(--text-primary); margin: 0; line-height: 1.6; white-space: pre-wrap;" id="changeDetailsDescription">-</p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-secondary" onclick="cerrarDetallesCambio()">Cerrar</button>
      </div>
    </div>
  </div>

{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/gestioneseventos.js' %}?v=17"></script>
{% endblock %}