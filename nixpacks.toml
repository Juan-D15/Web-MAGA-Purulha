[phases.setup]
nixPkgs = ["python3", "postgresql_16.dev", "gcc", "pkg-config", "cairo.dev", "pango", "gdk-pixbuf", "gobject-introspection", "glib", "libffi", "python3Packages.pycairo"]

[phases.install]
cmds = [
  "python -m venv --copies /opt/venv && . /opt/venv/bin/activate && grep -v 'xhtml2pdf' requirements.txt > /tmp/req_temp.txt && pip install -r /tmp/req_temp.txt && PYCAIRO_DIR=$(find /nix/store -type d -path '*/python3.12-pycairo*/lib/python3.12/site-packages' 2>/dev/null | head -1) && if [ -n \"$PYCAIRO_DIR\" ]; then cp -r \"$PYCAIRO_DIR\"/* /opt/venv/lib/python3.12/site-packages/ 2>/dev/null; fi && pip install xhtml2pdf==0.2.17 --no-build-isolation || pip install xhtml2pdf==0.2.17"
]