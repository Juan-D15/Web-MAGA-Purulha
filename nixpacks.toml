[phases.setup]
nixPkgs = ["python3", "postgresql_16.dev", "gcc", "pkg-config", "cairo.dev", "pango", "gdk-pixbuf", "gobject-introspection", "glib", "libffi", "python3Packages.pycairo"]

[phases.install]
cmds = [
  "python -m venv --copies /opt/venv && . /opt/venv/bin/activate && grep -v 'xhtml2pdf' requirements.txt > /tmp/req_temp.txt && pip install -r /tmp/req_temp.txt && PYCAIRO_DIR=$(find /nix/store -type d -path '*/python3.12-pycairo*/lib/python3.12/site-packages' 2>/dev/null | head -1) && if [ -n \"$PYCAIRO_DIR\" ]; then cp -r \"$PYCAIRO_DIR\"/* /opt/venv/lib/python3.12/site-packages/ 2>/dev/null; pip show pycairo > /dev/null 2>&1 || pip install --no-deps --force-reinstall --no-build-isolation pycairo || true; fi && PKG_CONFIG=$(which pkg-config) && export PKG_CONFIG_PATH=$(pkg-config --variable pc_path pkg-config 2>/dev/null || echo ''):$PKG_CONFIG_PATH && CAIRO_PC=$(find /nix/store -name 'cairo.pc' 2>/dev/null | head -1) && if [ -n \"$CAIRO_PC\" ]; then export PKG_CONFIG_PATH=$(dirname \"$CAIRO_PC\"):$PKG_CONFIG_PATH; fi && pip install xhtml2pdf==0.2.17 || pip install xhtml2pdf==0.2.17 --no-build-isolation"
]